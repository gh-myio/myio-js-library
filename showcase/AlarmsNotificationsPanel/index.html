<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RFC-0152 Phase 4: Alarms Notifications Panel - Showcase</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #f1f5f9;
      min-height: 100vh;
    }

    body.light-mode {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      color: #1e293b;
    }

    .showcase-header {
      padding: 24px 32px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(0, 0, 0, 0.2);
    }

    body.light-mode .showcase-header {
      background: rgba(255, 255, 255, 0.8);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .showcase-header h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .showcase-header p {
      font-size: 14px;
      opacity: 0.7;
    }

    .controls-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      padding: 16px 32px;
      background: rgba(0, 0, 0, 0.15);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    body.light-mode .controls-bar {
      background: rgba(255, 255, 255, 0.6);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-group label {
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      opacity: 0.7;
    }

    .control-group select,
    .control-group button {
      padding: 8px 12px;
      font-size: 13px;
      font-weight: 500;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.1);
      color: inherit;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    body.light-mode .control-group select,
    body.light-mode .control-group button {
      border-color: rgba(0, 0, 0, 0.15);
      background: rgba(255, 255, 255, 0.8);
    }

    .control-group select:hover,
    .control-group button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .control-group button.primary {
      background: #8b5cf6;
      border-color: #8b5cf6;
      color: white;
    }

    .control-group button.primary:hover {
      background: #7c3aed;
    }

    .main-container {
      display: flex;
      height: calc(100vh - 140px);
    }

    .alarms-container {
      flex: 1;
      padding: 24px 32px;
      overflow: hidden;
    }

    .alarms-wrapper {
      height: 100%;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
    }

    body.light-mode .alarms-wrapper {
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
    }

    /* Fix footer to bottom of card */
    .alarm-card {
      height: 100%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .alarm-card-footer {
      margin-top: auto;
      flex-wrap: wrap;
    }
    
    /* Mobile layout fix for buttons */
    @media (max-width: 480px) {
      .alarm-card-footer {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
      }
      .alarm-card-footer .btn:last-child:nth-child(odd) {
        grid-column: 1 / -1;
      }
    }

    /* Ensure component fills the wrapper */
    .alarms-wrapper > div {
      height: 100%;
      width: 100%;
    }

    .event-log {
      width: 320px;
      background: rgba(0, 0, 0, 0.2);
      border-left: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
    }

    body.light-mode .event-log {
      background: rgba(255, 255, 255, 0.8);
      border-left: 1px solid rgba(0, 0, 0, 0.05);
    }

    .event-log-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    body.light-mode .event-log-header {
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .event-log-header strong {
      font-size: 14px;
    }

    .event-log-header button {
      padding: 4px 8px;
      font-size: 11px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      background: transparent;
      color: inherit;
      cursor: pointer;
      opacity: 0.7;
    }

    .event-log-header button:hover {
      opacity: 1;
    }

    .event-log-content {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, monospace;
    }

    .event-item {
      padding: 8px 10px;
      margin-bottom: 6px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      border-left: 3px solid #8b5cf6;
    }

    body.light-mode .event-item {
      background: rgba(0, 0, 0, 0.05);
    }

    .event-item .event-type {
      font-weight: 600;
      color: #8b5cf6;
      display: block;
      margin-bottom: 4px;
    }

    .event-item .event-time {
      font-size: 10px;
      opacity: 0.5;
      margin-left: 8px;
    }

    .event-item .event-data {
      font-size: 11px;
      opacity: 0.7;
      white-space: pre-wrap;
      word-break: break-all;
    }

    @media (max-width: 1200px) {
      .event-log {
        display: none;
      }
    }
  </style>
</head>
<body>
  <header class="showcase-header">
    <h1>RFC-0152 Phase 4: Alarms Notifications Panel</h1>
    <p>Painel centralizado de alarmes com visualizacao em lista e dashboard com KPIs e graficos</p>
  </header>

  <div class="controls-bar">
    <div class="control-group">
      <label>Tema:</label>
      <select id="themeSelect">
        <option value="dark" selected>Dark</option>
        <option value="light">Light</option>
      </select>
    </div>

    <div class="control-group">
      <label>Tab:</label>
      <select id="tabSelect">
        <option value="list" selected>Lista</option>
        <option value="dashboard">Dashboard</option>
      </select>
    </div>

    <div class="control-group">
      <label>Alarmes:</label>
      <select id="alarmCountSelect">
        <option value="5">5 alarmes</option>
        <option value="10" selected>10 alarmes</option>
        <option value="25">25 alarmes</option>
        <option value="50">50 alarmes</option>
        <option value="100">100 alarmes</option>
      </select>
    </div>

    <div class="control-group">
      <button id="refreshBtn" class="primary">Atualizar Dados</button>
    </div>

    <div class="control-group">
      <button id="clearFiltersBtn">Limpar Filtros</button>
    </div>

    <div class="control-group">
      <button id="toggleLoadingBtn">Toggle Loading</button>
    </div>
  </div>

  <div class="main-container">
    <div class="alarms-container">
      <div class="alarms-wrapper" id="alarmsContainer"></div>
    </div>

    <div class="event-log">
      <div class="event-log-header">
        <strong>Event Log</strong>
        <button id="clearLogBtn">Clear</button>
      </div>
      <div class="event-log-content" id="eventLogContent"></div>
    </div>
  </div>

  <script src="../../dist/myio-js-library.umd.js"></script>
  <script>
    // =====================================================================
    // Mock Data Generator
    // =====================================================================

    const SEVERITIES = ['CRITICAL', 'HIGH', 'MEDIUM', 'LOW', 'INFO'];
    const STATES = ['OPEN', 'ACK', 'SNOOZED', 'ESCALATED', 'CLOSED'];
    const CUSTOMERS = [
      'Shopping Aricanduva',
      'Shopping Eldorado',
      'Shopping Morumbi',
      'Shopping Iguatemi',
      'Shopping Villa Lobos',
      'Shopping Cidade Jardim',
    ];
    const SOURCES = [
      'CHILLER-01', 'CHILLER-02', 'FANCOIL-03', 'FANCOIL-04',
      'ELV-01', 'ELV-02', 'ESC-01', 'ESC-02',
      'MEDIDOR-01', 'MEDIDOR-02', 'HIDROMETRO-01', 'TERMOSTATO-01',
    ];
    const TITLES = [
      'Falha de comunicacao com dispositivo',
      'Temperatura fora da faixa configurada',
      'Consumo de energia acima do limite',
      'Manutencao preventiva necessaria',
      'Sensor desconectado',
      'Vazamento detectado',
      'Sobrecarga no circuito',
      'Falha no sistema de refrigeracao',
      'Nivel de agua abaixo do minimo',
      'Dispositivo offline por mais de 24h',
    ];

    function generateMockAlarms(count) {
      const alarms = [];
      const now = Date.now();
      const oneWeekAgo = now - 7 * 24 * 60 * 60 * 1000;

      for (let i = 0; i < count; i++) {
        const severity = SEVERITIES[Math.floor(Math.random() * SEVERITIES.length)];
        const state = STATES[Math.floor(Math.random() * STATES.length)];
        const firstOccurrence = new Date(oneWeekAgo + Math.random() * (now - oneWeekAgo));
        const lastOccurrence = new Date(firstOccurrence.getTime() + Math.random() * (now - firstOccurrence.getTime()));
        const customerIndex = Math.floor(Math.random() * CUSTOMERS.length);

        const alarm = {
          id: `ALM-${String(i + 1).padStart(6, '0')}`,
          customerId: `cust-${customerIndex + 1}`,
          customerName: CUSTOMERS[customerIndex],
          source: SOURCES[Math.floor(Math.random() * SOURCES.length)],
          severity,
          state,
          title: TITLES[Math.floor(Math.random() * TITLES.length)],
          description: 'Descricao detalhada do alarme com informacoes sobre o problema detectado.',
          tags: {
            tipo: ['comunicacao', 'temperatura', 'energia', 'manutencao'][Math.floor(Math.random() * 4)],
            zona: `zona-${Math.floor(Math.random() * 5) + 1}`,
            prioridade: severity.toLowerCase(),
          },
          firstOccurrence: firstOccurrence.toISOString(),
          lastOccurrence: lastOccurrence.toISOString(),
          occurrenceCount: Math.floor(Math.random() * 50) + 1,
        };

        // Add state-specific fields
        if (state === 'ACK') {
          alarm.acknowledgedAt = new Date().toISOString();
          alarm.acknowledgedBy = 'operador@myio.com.br';
        }

        if (state === 'SNOOZED') {
          const snoozedUntil = new Date(now + 4 * 60 * 60 * 1000); // 4 hours from now
          alarm.snoozedUntil = snoozedUntil.toISOString();
        }

        if (state === 'CLOSED') {
          alarm.closedAt = new Date().toISOString();
          alarm.closedBy = 'admin@myio.com.br';
          alarm.closedReason = 'Problema resolvido apos manutencao corretiva.';
        }

        alarms.push(alarm);
      }

      return alarms;
    }

    function generateTrendData() {
      const data = [];
      const now = new Date();

      for (let i = 6; i >= 0; i--) {
        const date = new Date(now);
        date.setDate(date.getDate() - i);

        data.push({
          label: date.toLocaleDateString('pt-BR', { weekday: 'short' }),
          timestamp: date.getTime(),
          total: Math.floor(Math.random() * 30) + 5,
        });
      }

      return data;
    }

    // =====================================================================
    // Event Logging
    // =====================================================================

    function logEvent(type, data) {
      const logContent = document.getElementById('eventLogContent');
      const timestamp = new Date().toLocaleTimeString('pt-BR');

      const item = document.createElement('div');
      item.className = 'event-item';

      let dataStr = '';
      if (data !== undefined) {
        if (typeof data === 'object') {
          dataStr = JSON.stringify(data, null, 2);
          if (dataStr.length > 200) {
            dataStr = dataStr.substring(0, 200) + '...';
          }
        } else {
          dataStr = String(data);
        }
      }

      item.innerHTML = `
        <span class="event-type">${type}<span class="event-time">${timestamp}</span></span>
        ${dataStr ? `<span class="event-data">${dataStr}</span>` : ''}
      `;

      logContent.insertBefore(item, logContent.firstChild);
    }

    // =====================================================================
    // Component Instance
    // =====================================================================

    let alarmsPanel = null;
    let currentTheme = 'dark';
    let currentTab = 'list';
    let currentCount = 10;

    function initComponent() {
      const container = document.getElementById('alarmsContainer');
      container.innerHTML = '';

      const alarms = generateMockAlarms(currentCount);

      logEvent('init', { count: alarms.length, theme: currentTheme, tab: currentTab });

      alarmsPanel = MyIOLibrary.createAlarmsNotificationsPanelComponent({
        container,
        themeMode: currentTheme,
        initialTab: currentTab,
        alarms,
        enableDebugMode: true,
        onAlarmClick: (alarm) => {
          logEvent('alarm-click', { id: alarm.id, title: alarm.title, severity: alarm.severity });
        },
        onAcknowledge: (alarmId) => {
          logEvent('acknowledge', { alarmId });
        },
        onTabChange: (tab) => {
          logEvent('tab-change', { tab });
          document.getElementById('tabSelect').value = tab;
        },
        onFilterChange: (filters) => {
          logEvent('filter-change', filters);
        },
      });

      console.log('AlarmsNotificationsPanel component created:', alarmsPanel);
    }

    // =====================================================================
    // Controls
    // =====================================================================

    document.getElementById('themeSelect').addEventListener('change', (e) => {
      currentTheme = e.target.value;
      document.body.classList.toggle('light-mode', currentTheme === 'light');
      if (alarmsPanel) {
        alarmsPanel.setThemeMode(currentTheme);
        logEvent('theme-change', { theme: currentTheme });
      }
    });

    document.getElementById('tabSelect').addEventListener('change', (e) => {
      currentTab = e.target.value;
      if (alarmsPanel) {
        alarmsPanel.setActiveTab(currentTab);
      }
    });

    document.getElementById('alarmCountSelect').addEventListener('change', (e) => {
      currentCount = parseInt(e.target.value, 10);
      if (alarmsPanel) {
        const newAlarms = generateMockAlarms(currentCount);
        alarmsPanel.updateAlarms(newAlarms);
        logEvent('alarms-updated', { count: currentCount });
      }
    });

    document.getElementById('refreshBtn').addEventListener('click', () => {
      if (alarmsPanel) {
        const newAlarms = generateMockAlarms(currentCount);
        alarmsPanel.updateAlarms(newAlarms);
        logEvent('refresh', { count: currentCount });
      }
    });

    document.getElementById('clearFiltersBtn').addEventListener('click', () => {
      if (alarmsPanel) {
        alarmsPanel.clearFilters();
        logEvent('filters-cleared');
      }
    });

    document.getElementById('toggleLoadingBtn').addEventListener('click', () => {
      if (alarmsPanel) {
        const isCurrentlyLoading = alarmsPanel.element.querySelector('.alarms-loading-overlay.active');
        alarmsPanel.setLoading(!isCurrentlyLoading);
        logEvent('loading-toggle', { loading: !isCurrentlyLoading });
      }
    });

    document.getElementById('clearLogBtn').addEventListener('click', () => {
      document.getElementById('eventLogContent').innerHTML = '';
    });

    // =====================================================================
    // Initialize
    // =====================================================================

    initComponent();
  </script>
</body>
</html>
