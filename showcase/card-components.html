<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Components - MYIO JS Library Showcase</title>
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-600: #4b5563;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gray-900);
            color: var(--gray-100);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            padding: 32px 20px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .breadcrumb {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 8px;
        }

        .breadcrumb a {
            color: white;
            text-decoration: none;
        }

        .breadcrumb a:hover { text-decoration: underline; }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 20px;
        }

        .section {
            background: var(--gray-800);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .section h2 {
            font-size: 1.25rem;
            color: var(--gray-100);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-desc {
            color: var(--gray-600);
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Domain tabs */
        .domain-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .domain-tab {
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid transparent;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .domain-tab.energy {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border-color: rgba(59, 130, 246, 0.3);
        }
        .domain-tab.energy:hover, .domain-tab.energy.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
        }

        .domain-tab.water {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border-color: rgba(34, 197, 94, 0.3);
        }
        .domain-tab.water:hover, .domain-tab.water.active {
            background: rgba(34, 197, 94, 0.3);
            border-color: #22c55e;
        }

        .domain-tab.temperature {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
            border-color: rgba(249, 115, 22, 0.3);
        }
        .domain-tab.temperature:hover, .domain-tab.temperature.active {
            background: rgba(249, 115, 22, 0.3);
            border-color: #f97316;
        }

        /* Cards grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .card-wrapper {
            min-height: 200px;
        }

        .domain-section {
            margin-bottom: 32px;
        }

        .domain-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--gray-700);
        }

        .domain-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .domain-icon.energy { background: rgba(59, 130, 246, 0.2); }
        .domain-icon.water { background: rgba(34, 197, 94, 0.2); }
        .domain-icon.temperature { background: rgba(249, 115, 22, 0.2); }

        .domain-title {
            font-size: 18px;
            font-weight: 600;
        }

        .domain-title.energy { color: #60a5fa; }
        .domain-title.water { color: #4ade80; }
        .domain-title.temperature { color: #fb923c; }

        .control-panel {
            background: var(--gray-700);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .control-panel h3 {
            font-size: 14px;
            color: var(--gray-400);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .control-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: flex-end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .control-group label {
            font-size: 12px;
            color: var(--gray-400);
        }

        .control-group select, .control-group input {
            padding: 8px 12px;
            border: 1px solid var(--gray-600);
            border-radius: 6px;
            font-size: 14px;
            min-width: 150px;
            background: var(--gray-800);
            color: var(--gray-100);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-primary {
            background: #f59e0b;
            color: white;
        }

        .btn-primary:hover { background: #d97706; }

        .btn-secondary {
            background: var(--gray-600);
            color: var(--gray-100);
        }

        .btn-secondary:hover { background: var(--gray-500); }

        .btn-energy {
            background: #3b82f6;
            color: white;
        }
        .btn-energy:hover { background: #2563eb; }

        .btn-water {
            background: #22c55e;
            color: white;
        }
        .btn-water:hover { background: #16a34a; }

        .btn-temperature {
            background: #f97316;
            color: white;
        }
        .btn-temperature:hover { background: #ea580c; }

        .event-log {
            background: var(--gray-900);
            color: #86efac;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--gray-700);
        }

        .event-log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .code-example {
            background: var(--gray-900);
            color: #e5e7eb;
            padding: 16px 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            overflow-x: auto;
            border: 1px solid var(--gray-700);
        }

        .code-example .comment { color: #6b7280; }
        .code-example .keyword { color: #c084fc; }
        .code-example .string { color: #86efac; }
        .code-example .function { color: #60a5fa; }
        .code-example .number { color: #fbbf24; }

        .status-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 16px;
            padding: 12px;
            background: var(--gray-700);
            border-radius: 8px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--gray-300);
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-dot.power_on { background: #3b82f6; }
        .status-dot.standby { background: #22c55e; }
        .status-dot.warning { background: #f59e0b; }
        .status-dot.failure { background: #ef4444; }
        .status-dot.offline { background: #6b7280; }
        .status-dot.no_info { background: #f97316; }
    </style>
    <script src="../dist/myio-js-library.umd.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="breadcrumb">
                <a href="index.html">Showcase</a> / Card Components
            </div>
            <h1>renderCardComponentHeadOffice - Multi-Domain Test</h1>
        </div>
    </header>

    <div class="container">
        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 12px 16px; margin-bottom: 20px; font-size: 13px; color: #60a5fa;">
            <strong>Tooltip Features:</strong> Hover sobre os cards de temperatura/energia para ver as tooltips premium.
            <br>üìå <strong>PIN:</strong> Fixa a tooltip na tela (cria um clone independente) |
            ‚¨ú <strong>Maximizar:</strong> Expande para tela cheia |
            ‚úï <strong>Fechar:</strong> Fecha a tooltip |
            üñêÔ∏è <strong>Arrastar:</strong> Mova pelo header |
            ‚è±Ô∏è <strong>Delay:</strong> 1.5s antes de fechar
        </div>

        <!-- Energy Cards Section -->
        <section class="section">
            <div class="domain-header">
                <div class="domain-icon energy">‚ö°</div>
                <h2 class="domain-title energy">Energy Domain</h2>
            </div>

            <div class="control-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label>Consumo (kWh)</label>
                        <input type="number" id="energyValue" value="156.8" step="0.1">
                    </div>
                    <div class="control-group">
                        <label>Potencia (W)</label>
                        <input type="number" id="energyPower" value="2450" step="100">
                    </div>
                    <div class="control-group">
                        <label>Status</label>
                        <select id="energyStatus">
                            <option value="power_on">Power On</option>
                            <option value="standby">Standby</option>
                            <option value="warning">Warning</option>
                            <option value="failure">Failure</option>
                            <option value="offline">Offline</option>
                        </select>
                    </div>
                    <button class="btn btn-energy" onclick="updateEnergyCards()">Atualizar</button>
                </div>
            </div>

            <div class="cards-grid" id="energyCardsGrid"></div>
        </section>

        <!-- Water Cards Section -->
        <section class="section">
            <div class="domain-header">
                <div class="domain-icon water">üíß</div>
                <h2 class="domain-title water">Water Domain</h2>
            </div>

            <div class="control-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label>Consumo (m¬≥)</label>
                        <input type="number" id="waterValue" value="45.2" step="0.1">
                    </div>
                    <div class="control-group">
                        <label>Pulsos (L)</label>
                        <input type="number" id="waterPulses" value="1250" step="10">
                    </div>
                    <div class="control-group">
                        <label>Status</label>
                        <select id="waterStatus">
                            <option value="power_on">Em Operacao</option>
                            <option value="standby">Standby</option>
                            <option value="warning">Alerta</option>
                            <option value="failure">Falha</option>
                            <option value="offline">Offline</option>
                        </select>
                    </div>
                    <button class="btn btn-water" onclick="updateWaterCards()">Atualizar</button>
                </div>
            </div>

            <div class="cards-grid" id="waterCardsGrid"></div>
        </section>

        <!-- Temperature Cards Section -->
        <section class="section">
            <div class="domain-header">
                <div class="domain-icon temperature">üå°Ô∏è</div>
                <h2 class="domain-title temperature">Temperature Domain</h2>
            </div>

            <div class="control-panel">
                <h3>Controles de Temperatura</h3>
                <div class="control-row">
                    <div class="control-group">
                        <label>Temperatura (¬∞C)</label>
                        <input type="number" id="tempValue" value="24.5" step="0.1">
                    </div>
                    <div class="control-group">
                        <label>Temp Min (¬∞C)</label>
                        <input type="number" id="tempMin" value="20" step="0.5">
                    </div>
                    <div class="control-group">
                        <label>Temp Max (¬∞C)</label>
                        <input type="number" id="tempMax" value="26" step="0.5">
                    </div>
                    <div class="control-group">
                        <label>Ult. Telemetria</label>
                        <input type="datetime-local" id="tempLastActivity">
                    </div>
                    <div class="control-group">
                        <label>Status</label>
                        <select id="tempStatus">
                            <option value="power_on">Em Operacao</option>
                            <option value="standby">Standby</option>
                            <option value="warning">Alerta</option>
                            <option value="failure">Falha</option>
                            <option value="offline">Offline</option>
                        </select>
                    </div>
                    <button class="btn btn-temperature" onclick="updateTempCards()">Atualizar</button>
                </div>
                <div style="margin-top: 12px; font-size: 12px; color: var(--gray-400);">
                    <strong>Cores do fundo:</strong> üîµ Azul (abaixo da faixa) | üü¢ Verde (na faixa) | üî¥ Vermelho (acima da faixa)
                </div>
            </div>

            <div class="cards-grid" id="tempCardsGrid"></div>
        </section>

        <!-- Event Log -->
        <section class="section">
            <div class="event-log-header">
                <h2>Event Log</h2>
                <button class="btn btn-sm btn-secondary" onclick="clearLog()">Limpar</button>
            </div>
            <div class="event-log" id="eventLog">Aguardando eventos...\n</div>

            <div class="status-legend">
                <div class="status-item"><span class="status-dot power_on"></span> Power On / Em Operacao</div>
                <div class="status-item"><span class="status-dot standby"></span> Standby</div>
                <div class="status-item"><span class="status-dot warning"></span> Warning / Alerta</div>
                <div class="status-item"><span class="status-dot failure"></span> Failure / Falha</div>
                <div class="status-item"><span class="status-dot offline"></span> Offline</div>
                <div class="status-item"><span class="status-dot no_info"></span> No Info</div>
            </div>
        </section>

        <!-- Code Examples -->
        <section class="section">
            <h2>Exemplo de Uso por Dominio</h2>

            <h3 style="color: #60a5fa; margin: 16px 0 8px;">Energy</h3>
            <div class="code-example">
<span class="keyword">const</span> energyEntity = {
    entityId: <span class="string">'elv-001'</span>,
    labelOrName: <span class="string">'Elevador Social'</span>,
    val: <span class="number">156.8</span>,                     <span class="comment">// Consumo em kWh</span>
    instantaneousPower: <span class="number">450</span>,         <span class="comment">// Potencia em W (usado no tooltip)</span>
    operationHours: <span class="number">'8.5h'</span>,          <span class="comment">// Tempo de operacao</span>
    domain: <span class="string">'energy'</span>,
    deviceStatus: <span class="string">'power_on'</span>,
    <span class="comment">// Power ranges para tooltip visual</span>
    powerRanges: {
        standbyRange: { down: <span class="number">0</span>, up: <span class="number">150</span> },
        normalRange: { down: <span class="number">151</span>, up: <span class="number">800</span> },
        alertRange: { down: <span class="number">801</span>, up: <span class="number">1200</span> },
        failureRange: { down: <span class="number">1201</span>, up: <span class="number">99999</span> }
    }
};
            </div>

            <h3 style="color: #4ade80; margin: 16px 0 8px;">Water</h3>
            <div class="code-example">
<span class="keyword">const</span> waterEntity = {
    entityId: <span class="string">'hid-001'</span>,
    labelOrName: <span class="string">'Hidrometro Loja 01'</span>,
    val: <span class="number">45.2</span>,                       <span class="comment">// Consumo em m3</span>
    pulses: <span class="number">1250</span>,                    <span class="comment">// Pulsos em L (Leitura)</span>
    operationHours: <span class="number">'24h'</span>,            <span class="comment">// Tempo de operacao</span>
    domain: <span class="string">'water'</span>,
    deviceStatus: <span class="string">'power_on'</span>
};
            </div>

            <h3 style="color: #fb923c; margin: 16px 0 8px;">Temperature</h3>
            <div class="code-example">
<span class="keyword">const</span> tempEntity = {
    entityId: <span class="string">'temp-001'</span>,
    labelOrName: <span class="string">'Sensor Loja 01'</span>,
    val: <span class="number">24.5</span>,                       <span class="comment">// Temperatura em C (valor principal)</span>
    currentTemperature: <span class="number">24.5</span>,         <span class="comment">// Footer: Temp. Atual</span>
    lastActivityTime: <span class="number">1702234567890</span>,  <span class="comment">// Footer: Ult. Telemetria (timestamp UTC)</span>
    domain: <span class="string">'temperature'</span>,
    icon: <span class="string">'temperature'</span>,             <span class="comment">// Para FOOTER detectar tipo</span>
    temperatureMin: <span class="number">20</span>,               <span class="comment">// Faixa ideal: min (para cor do fundo)</span>
    temperatureMax: <span class="number">26</span>,               <span class="comment">// Faixa ideal: max (para cor do fundo)</span>
    deviceStatus: <span class="string">'power_on'</span>
};
<span class="comment">// Cor do fundo baseada na faixa:</span>
<span class="comment">// - val &lt; temperatureMin ‚Üí Azul (muito frio)</span>
<span class="comment">// - val dentro da faixa ‚Üí Verde (ideal)</span>
<span class="comment">// - val &gt; temperatureMax ‚Üí Vermelho (muito quente)</span>
            </div>
        </section>

        <div style="text-align: center; margin-top: 32px;">
            <a href="index.html" class="btn btn-primary">‚Üê Voltar ao Portal</a>
        </div>
    </div>

    <script>
        const { renderCardComponentHeadOffice, createAnnotationIndicator, openDashboardPopupSettings } = MyIOLibrary;

        const cardInstances = {
            energy: [],
            water: [],
            temperature: []
        };

        const eventLog = document.getElementById('eventLog');

        // =====================
        // MOCK ANNOTATIONS DATA
        // =====================
        const MOCK_ANNOTATIONS = {
            'elv-001': [
                {
                    id: 'ann-001',
                    version: 2,
                    text: 'Consumo acima da m√©dia - verificar motor',
                    type: 'pending',
                    importance: 5,
                    status: 'modified',
                    createdAt: '2024-12-08T08:00:00Z',
                    dueDate: '2024-12-10T18:00:00Z', // Overdue!
                    createdBy: { id: 'user-003', email: 'supervisor@myio.com.br', name: 'Supervisor' },
                    acknowledged: false,
                    history: []
                }
            ],
            'ar-001': [
                {
                    id: 'ann-002',
                    version: 1,
                    text: 'Manuten√ß√£o preventiva agendada',
                    type: 'maintenance',
                    importance: 3,
                    status: 'created',
                    createdAt: '2024-12-12T14:30:00Z',
                    createdBy: { id: 'user-002', email: 'admin@cliente.com', name: 'Admin Cliente' },
                    acknowledged: true,
                    acknowledgedBy: { id: 'user-001', email: 'tecnico@myio.com.br', name: 'T√©cnico MYIO' },
                    history: []
                },
                {
                    id: 'ann-003',
                    version: 1,
                    text: 'Limpeza dos filtros realizada',
                    type: 'activity',
                    importance: 2,
                    status: 'created',
                    createdAt: '2024-12-15T11:00:00Z',
                    createdBy: { id: 'user-002', email: 'admin@cliente.com', name: 'Admin Cliente' },
                    acknowledged: true,
                    history: []
                }
            ],
            'ilu-001': [
                {
                    id: 'ann-004',
                    version: 1,
                    text: 'Observa√ß√£o: l√¢mpadas LED instaladas',
                    type: 'observation',
                    importance: 1,
                    status: 'created',
                    createdAt: '2024-12-13T16:45:00Z',
                    createdBy: { id: 'user-001', email: 'tecnico@myio.com.br', name: 'T√©cnico MYIO' },
                    acknowledged: false,
                    history: []
                }
            ],
            'hid-001': [
                {
                    id: 'ann-005',
                    version: 1,
                    text: 'Verificar vazamento no hidr√¥metro',
                    type: 'pending',
                    importance: 4,
                    status: 'created',
                    createdAt: '2024-12-14T10:00:00Z',
                    dueDate: '2024-12-20T23:59:59Z',
                    createdBy: { id: 'user-001', email: 'tecnico@myio.com.br', name: 'T√©cnico MYIO' },
                    acknowledged: false,
                    history: []
                }
            ],
            'hid-002': [],
            'hid-003': [
                {
                    id: 'ann-006',
                    version: 1,
                    text: 'Consumo normal para o per√≠odo',
                    type: 'observation',
                    importance: 1,
                    status: 'created',
                    createdAt: '2024-12-14T08:30:00Z',
                    createdBy: { id: 'user-002', email: 'admin@cliente.com', name: 'Admin Cliente' },
                    acknowledged: false,
                    history: []
                }
            ],
            'temp-001': [
                {
                    id: 'ann-007',
                    version: 1,
                    text: 'Sensor abaixo da temperatura ideal',
                    type: 'maintenance',
                    importance: 3,
                    status: 'created',
                    createdAt: '2024-12-11T14:00:00Z',
                    dueDate: '2024-12-18T18:00:00Z',
                    createdBy: { id: 'user-003', email: 'supervisor@myio.com.br', name: 'Supervisor' },
                    acknowledged: false,
                    history: []
                }
            ],
            'temp-002': [
                {
                    id: 'ann-008',
                    version: 1,
                    text: 'Temperatura est√°vel',
                    type: 'activity',
                    importance: 2,
                    status: 'created',
                    createdAt: '2024-12-10T09:15:00Z',
                    createdBy: { id: 'user-001', email: 'tecnico@myio.com.br', name: 'T√©cnico MYIO' },
                    acknowledged: false,
                    history: []
                }
            ],
            'temp-003': []
        };

        // Type icons configuration
        const TYPE_CONFIG = {
            pending: {
                color: '#d63031',
                icon: '‚ö†Ô∏è',
                label: 'Pend√™ncia'
            },
            maintenance: {
                color: '#e17055',
                icon: 'üîß',
                label: 'Manuten√ß√£o'
            },
            activity: {
                color: '#00b894',
                icon: '‚úì',
                label: 'Atividade'
            },
            observation: {
                color: '#0984e3',
                icon: 'üìù',
                label: 'Observa√ß√£o'
            }
        };

        // Inject styles for type badges
        function injectBadgeStyles() {
            if (document.getElementById('annotation-type-badges-styles')) return;

            const style = document.createElement('style');
            style.id = 'annotation-type-badges-styles';
            style.textContent = `
                .annotation-type-badges {
                    position: absolute;
                    top: 50%;
                    right: 6px;
                    transform: translateY(-50%);
                    display: flex;
                    flex-direction: column;
                    gap: 4px;
                    z-index: 10;
                }

                .annotation-type-badge {
                    position: relative;
                    width: 22px;
                    height: 22px;
                    border-radius: 6px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 11px;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
                }

                .annotation-type-badge:hover {
                    transform: scale(1.15);
                    box-shadow: 0 2px 8px rgba(0,0,0,0.25);
                }

                .annotation-type-badge__count {
                    position: absolute;
                    top: -4px;
                    right: -4px;
                    min-width: 14px;
                    height: 14px;
                    padding: 0 3px;
                    background: #1a1a2e;
                    color: white;
                    border-radius: 7px;
                    font-size: 9px;
                    font-weight: 700;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    line-height: 1;
                }

                /* Summary tooltip - positioned via JS to avoid card overflow */
                .annotation-summary-tooltip {
                    position: fixed;
                    min-width: 260px;
                    max-width: 320px;
                    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
                    border: 1px solid rgba(0, 0, 0, 0.1);
                    border-radius: 10px;
                    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
                    font-family: 'Inter', system-ui, sans-serif;
                    font-size: 12px;
                    color: #1a1a2e;
                    opacity: 0;
                    visibility: hidden;
                    transition: opacity 0.3s ease, transform 0.3s ease;
                    transform: translateY(4px);
                    pointer-events: auto;
                    z-index: 9999;
                }

                .annotation-summary-tooltip.visible {
                    opacity: 1;
                    visibility: visible;
                    transform: translateY(0);
                }

                .annotation-summary-tooltip.closing {
                    opacity: 0;
                    transform: translateY(4px);
                    transition: opacity 0.4s ease, transform 0.4s ease;
                }

                .annotation-summary-tooltip.pinned {
                    box-shadow: 0 0 0 2px #6366f1, 0 8px 24px rgba(0, 0, 0, 0.2) !important;
                }

                .annotation-summary-tooltip.maximized {
                    top: 20px !important;
                    left: 20px !important;
                    right: 20px !important;
                    bottom: 20px !important;
                    width: auto !important;
                    max-width: none !important;
                    min-width: auto !important;
                    transform: none !important;
                }

                .annotation-summary-tooltip.maximized .annotation-summary-tooltip__body {
                    flex: 1;
                    overflow-y: auto;
                }

                .annotation-summary-tooltip.dragging {
                    transition: none !important;
                    cursor: move;
                }

                .annotation-summary-tooltip__header {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    padding: 10px 12px;
                    background: linear-gradient(90deg, #f1f5f9 0%, #e2e8f0 100%);
                    border-radius: 10px 10px 0 0;
                    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
                    cursor: move;
                    user-select: none;
                }

                .annotation-summary-tooltip__header-title {
                    font-weight: 600;
                    font-size: 13px;
                    flex: 1;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    color: #1a1a2e;
                }

                .annotation-summary-tooltip__header-actions {
                    display: flex;
                    align-items: center;
                    gap: 4px;
                }

                .annotation-summary-tooltip__header-btn {
                    width: 22px;
                    height: 22px;
                    border: none;
                    background: rgba(255, 255, 255, 0.6);
                    border-radius: 4px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.15s ease;
                    color: #64748b;
                }

                .annotation-summary-tooltip__header-btn:hover {
                    background: rgba(255, 255, 255, 0.9);
                    color: #1e293b;
                }

                .annotation-summary-tooltip__header-btn.pinned {
                    background: #6366f1;
                    color: white;
                }

                .annotation-summary-tooltip__header-btn.pinned:hover {
                    background: #4f46e5;
                    color: white;
                }

                .annotation-summary-tooltip__header-btn svg {
                    width: 12px;
                    height: 12px;
                }

                .annotation-summary-tooltip__body,
                .annotation-summary-tooltip__content {
                    padding: 12px 14px;
                }

                .annotation-summary-tooltip::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    transform: translateY(-50%);
                    border: 8px solid transparent;
                }

                /* Arrow pointing left (tooltip on right side) */
                .annotation-summary-tooltip.arrow-left::after {
                    left: -8px;
                    border-right-color: #ffffff;
                    border-left-color: transparent;
                }

                /* Arrow pointing right (tooltip on left side) */
                .annotation-summary-tooltip.arrow-right::after {
                    right: -8px;
                    border-left-color: #ffffff;
                    border-right-color: transparent;
                }

                .annotation-summary-tooltip.visible {
                    opacity: 1;
                    visibility: visible;
                }

                .annotation-summary-tooltip__title {
                    font-weight: 600;
                    font-size: 13px;
                    margin-bottom: 10px;
                    padding-bottom: 8px;
                    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    color: #1a1a2e;
                }

                .annotation-summary-tooltip__row {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 4px 0;
                }

                .annotation-summary-tooltip__label {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    color: #495057;
                }

                .annotation-summary-tooltip__dot {
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                }

                .annotation-summary-tooltip__value {
                    font-weight: 600;
                    color: #1a1a2e;
                }

                .annotation-summary-tooltip__latest {
                    margin-top: 10px;
                    padding-top: 10px;
                    border-top: 1px solid rgba(0, 0, 0, 0.1);
                    font-size: 11px;
                }

                .annotation-summary-tooltip__latest-label {
                    color: #6c757d;
                    margin-bottom: 4px;
                }

                .annotation-summary-tooltip__latest-text {
                    color: #343a40;
                    line-height: 1.4;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    display: -webkit-box;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                }

                .annotation-summary-tooltip__latest-meta {
                    color: #868e96;
                    font-size: 10px;
                    margin-top: 4px;
                }

                .annotation-summary-tooltip__overdue {
                    color: #d63031;
                    margin-bottom: 10px;
                    font-size: 11px;
                    font-weight: 500;
                    padding: 6px 10px;
                    background: #fff5f5;
                    border-radius: 6px;
                }

                .annotation-summary-tooltip__list {
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                }

                .annotation-summary-tooltip__item {
                    padding: 8px 10px;
                    background: #f8f9fa;
                    border-radius: 6px;
                    border-left: 3px solid currentColor;
                }

                .annotation-summary-tooltip__item.overdue {
                    background: #fff5f5;
                    border-left-color: #d63031;
                }

                .annotation-summary-tooltip__item-text {
                    font-size: 12px;
                    color: #343a40;
                    line-height: 1.4;
                    margin-bottom: 4px;
                }

                .annotation-summary-tooltip__item-meta {
                    font-size: 10px;
                    color: #868e96;
                }

                .annotation-summary-tooltip__more {
                    font-size: 11px;
                    color: #6c757d;
                    text-align: center;
                    padding: 6px;
                    font-style: italic;
                }

                .annotation-summary-tooltip__hint {
                    font-size: 10px;
                    color: #adb5bd;
                    text-align: center;
                    padding-top: 10px;
                    margin-top: 10px;
                    border-top: 1px solid rgba(0,0,0,0.1);
                }
            `;
            document.head.appendChild(style);
        }

        // Function to add annotation type badges to a card
        function addAnnotationIndicator(cardElement, entityId, entityObject) {
            const annotations = MOCK_ANNOTATIONS[entityId] || [];

            // Ensure styles are injected
            injectBadgeStyles();

            // Create wrapper for positioning
            if (cardElement && cardElement.style) {
                cardElement.style.position = 'relative';
            }

            // Filter active annotations
            const activeAnnotations = annotations.filter(a => a.status !== 'archived');
            if (activeAnnotations.length === 0) return null;

            // Group by type
            const byType = {
                pending: [],
                maintenance: [],
                activity: [],
                observation: []
            };

            activeAnnotations.forEach(a => {
                if (byType[a.type]) {
                    byType[a.type].push(a);
                }
            });

            // Create badges container
            const container = document.createElement('div');
            container.className = 'annotation-type-badges';

            // Priority order: pending, maintenance, activity, observation
            const typeOrder = ['pending', 'maintenance', 'activity', 'observation'];

            typeOrder.forEach(type => {
                const typeAnnotations = byType[type];
                if (typeAnnotations.length > 0) {
                    const config = TYPE_CONFIG[type];
                    const badge = document.createElement('div');
                    badge.className = 'annotation-type-badge';
                    badge.style.background = config.color;
                    badge.innerHTML = `
                        <span>${config.icon}</span>
                        <span class="annotation-type-badge__count">${typeAnnotations.length}</span>
                    `;

                    // Create tooltip for THIS type only
                    const tooltip = createTypeTooltip(type, typeAnnotations, config, entityId);
                    document.body.appendChild(tooltip);

                    // Tooltip positioning and visibility
                    badge.addEventListener('mouseenter', () => {
                        const rect = badge.getBoundingClientRect();
                        positionTypeTooltip(tooltip, rect);
                        tooltip.classList.add('visible');
                    });

                    badge.addEventListener('mouseleave', () => {
                        setTimeout(() => {
                            if (!tooltip.matches(':hover')) {
                                tooltip.classList.remove('visible');
                            }
                        }, 100);
                    });

                    tooltip.addEventListener('mouseleave', () => {
                        tooltip.classList.remove('visible');
                    });

                    badge.addEventListener('click', (e) => {
                        e.stopPropagation();
                        tooltip.classList.remove('visible');
                        log(`Opening Settings Modal for ${entityObject.labelOrName} (${config.label})...`);
                        openDashboardPopupSettings({
                            entityId: entityId,
                            entityType: 'DEVICE',
                            entityName: entityObject.labelOrName,
                            activeTab: 'annotations',
                            onClose: () => log(`Settings Modal closed for ${entityObject.labelOrName}`)
                        });
                    });

                    container.appendChild(badge);
                }
            });

            // Append container to card
            cardElement.appendChild(container);

            return container;
        }

        // Helper function to create tooltip for a specific type
        function createTypeTooltip(type, typeAnnotations, config, entityId) {
            const now = new Date();
            const overdueAnnotations = typeAnnotations.filter(a => a.dueDate && new Date(a.dueDate) < now);

            const annotationsList = typeAnnotations.slice(0, 5).map(a => {
                const isOverdue = a.dueDate && new Date(a.dueDate) < now;
                const date = new Date(a.createdAt).toLocaleDateString('pt-BR');
                return `
                    <div class="annotation-summary-tooltip__item ${isOverdue ? 'overdue' : ''}">
                        <div class="annotation-summary-tooltip__item-text">"${a.text.length > 60 ? a.text.substring(0, 60) + '...' : a.text}"</div>
                        <div class="annotation-summary-tooltip__item-meta">
                            ${a.createdBy.name} ‚Ä¢ ${date}
                            ${isOverdue ? ' ‚Ä¢ <span style="color:#d63031">Vencida</span>' : ''}
                        </div>
                    </div>
                `;
            }).join('');

            const moreText = typeAnnotations.length > 5
                ? `<div class="annotation-summary-tooltip__more">+ ${typeAnnotations.length - 5} mais...</div>`
                : '';

            const tooltip = document.createElement('div');
            tooltip.className = 'annotation-summary-tooltip';
            tooltip.innerHTML = `
                <div class="annotation-summary-tooltip__header">
                    <span class="annotation-summary-tooltip__header-title">${config.icon} ${config.label} (${typeAnnotations.length})</span>
                </div>
                <div class="annotation-summary-tooltip__content">
                    ${overdueAnnotations.length > 0 ? `<div class="annotation-summary-tooltip__overdue">‚ö†Ô∏è ${overdueAnnotations.length} vencida(s)</div>` : ''}
                    <div class="annotation-summary-tooltip__list">
                        ${annotationsList}
                        ${moreText}
                    </div>
                    <div class="annotation-summary-tooltip__hint">Clique para ver todas</div>
                </div>
            `;

            return tooltip;
        }

        // Helper function to position type tooltip
        function positionTypeTooltip(tooltip, rect) {
            const tooltipWidth = 280;
            const spacing = 12;
            const viewportWidth = window.innerWidth;
            const rightPosition = rect.right + spacing;
            const canFitRight = (rightPosition + tooltipWidth) < viewportWidth;

            tooltip.classList.remove('arrow-left', 'arrow-right');
            if (canFitRight) {
                tooltip.style.left = `${rightPosition}px`;
                tooltip.classList.add('arrow-left');
            } else {
                tooltip.style.left = `${rect.left - tooltipWidth - spacing}px`;
                tooltip.classList.add('arrow-right');
            }
            tooltip.style.top = `${rect.top + rect.height / 2}px`;
            tooltip.style.transform = 'translateY(-50%)';
        }

        function log(message, domain = '') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = domain ? `[${domain.toUpperCase()}]` : '';
            eventLog.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        window.clearLog = function() {
            eventLog.textContent = '';
        };

        // Set default datetime for temperature lastActivity
        document.getElementById('tempLastActivity').value = new Date().toISOString().slice(0, 16);

        // =====================
        // ENERGY CARDS
        // =====================
        const energyDevices = [
            {
                entityId: 'elv-001',
                labelOrName: 'Elevador Social Norte',
                deviceIdentifier: 'ELV-001',
                customerName: 'Shopping ABC',
                deviceType: 'ELEVADOR',
                val: 156.8,
                instantaneousPower: 450, // Within normalRange (151-800)
                operationHours: '8.5h',
                domain: 'energy',
                icon: 'energy',
                unit: 'kWh',
                deviceStatus: 'power_on',
                connectionStatus: 'online',
                consumptionTargetValue: 200,
                lastConnectTime: Date.now() - 5 * 60 * 1000,
                // Power ranges for tooltip
                powerRanges: {
                    standbyRange: { down: 0, up: 150 },
                    normalRange: { down: 151, up: 800 },
                    alertRange: { down: 801, up: 1200 },
                    failureRange: { down: 1201, up: 99999 },
                    source: 'hardcoded',
                    tier: 3
                }
            },
            {
                entityId: 'ar-001',
                labelOrName: 'Ar Condicionado Praca',
                deviceIdentifier: 'AC-001',
                customerName: 'Shopping ABC',
                deviceType: 'AR_CONDICIONADO',
                val: 89.2,
                instantaneousPower: 3500, // Within alertRange (3001-5000)
                operationHours: '12.3h',
                domain: 'energy',
                icon: 'energy',
                unit: 'kWh',
                deviceStatus: 'standby',
                connectionStatus: 'online',
                consumptionTargetValue: 100,
                lastConnectTime: Date.now() - 2 * 60 * 1000,
                // Power ranges for tooltip
                powerRanges: {
                    standbyRange: { down: 0, up: 500 },
                    normalRange: { down: 501, up: 3000 },
                    alertRange: { down: 3001, up: 5000 },
                    failureRange: { down: 5001, up: 99999 },
                    source: 'hardcoded',
                    tier: 3
                }
            },
            {
                entityId: 'ilu-001',
                labelOrName: 'Iluminacao Estacionamento',
                deviceIdentifier: 'ILU-001',
                customerName: 'Shopping XYZ',
                deviceType: 'ILUMINACAO',
                val: 45.6,
                instantaneousPower: 80, // Within standbyRange (0-100)
                operationHours: '6.0h',
                domain: 'energy',
                icon: 'energy',
                unit: 'kWh',
                deviceStatus: 'warning',
                connectionStatus: 'online',
                lastConnectTime: Date.now() - 30 * 60 * 1000,
                // Power ranges for tooltip (DEFAULT)
                powerRanges: {
                    standbyRange: { down: 0, up: 100 },
                    normalRange: { down: 101, up: 1000 },
                    alertRange: { down: 1001, up: 2000 },
                    failureRange: { down: 2001, up: 99999 },
                    source: 'hardcoded',
                    tier: 3
                }
            }
        ];

        function initEnergyCards() {
            const grid = document.getElementById('energyCardsGrid');
            grid.innerHTML = '';

            energyDevices.forEach((device, idx) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';
                grid.appendChild(wrapper);

                const instance = renderCardComponentHeadOffice(wrapper, {
                    entityObject: { ...device },
                    handleActionDashboard: (e, entity) => log(`Dashboard: ${entity.labelOrName}`, 'energy'),
                    handleActionReport: (e, entity) => log(`Report: ${entity.labelOrName}`, 'energy'),
                    handleActionSettings: (e, entity) => log(`Settings: ${entity.labelOrName}`, 'energy'),
                    handleSelect: (checked, entity) => log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.labelOrName}`, 'energy'),
                    handleClickCard: (e, entity) => log(`Click: ${entity.labelOrName}`, 'energy'),
                    enableSelection: true,
                    enableDragDrop: true,
                    useNewComponents: true,
                    debugActive: false
                });

                // Add annotation indicator to the wrapper
                addAnnotationIndicator(wrapper, device.entityId, device);

                cardInstances.energy.push({ instance, device });
            });

            log('Energy cards initialized', 'energy');
        }

        window.updateEnergyCards = function() {
            const val = parseFloat(document.getElementById('energyValue').value) || 0;
            const power = parseFloat(document.getElementById('energyPower').value) || 0;
            const status = document.getElementById('energyStatus').value;

            cardInstances.energy.forEach(({ instance }) => {
                instance.update({
                    val: val,
                    instantaneousPower: power,
                    deviceStatus: status,
                    domain: 'energy',  // Required for correct icon
                    // connectionStatus prevents verifyOfflineStatus from overwriting deviceStatus
                    connectionStatus: status === 'offline' ? 'offline' : 'online',
                    lastConnectTime: Date.now()
                });
            });

            log(`Updated: ${val} kWh, ${power}W, ${status}`, 'energy');
        };

        // =====================
        // WATER CARDS
        // =====================
        const waterDevices = [
            {
                entityId: 'hid-001',
                labelOrName: 'Hidrometro Loja 01',
                deviceIdentifier: 'HID-001',
                customerName: 'Loja Magazine',
                deviceType: 'HIDROMETRO',
                val: 45.2,
                pulses: 1250,
                operationHours: '24h',
                domain: 'water',
                icon: 'water',
                unit: 'm3',
                deviceStatus: 'power_on',
                connectionStatus: 'online',
                consumptionTargetValue: 60,
                lastConnectTime: Date.now() - 10 * 60 * 1000
            },
            {
                entityId: 'hid-002',
                labelOrName: 'Hidrometro Area Comum',
                deviceIdentifier: 'HID-002',
                customerName: 'Administracao',
                deviceType: 'HIDROMETRO',
                val: 128.7,
                pulses: 3420,
                operationHours: '24h',
                domain: 'water',
                icon: 'water',
                unit: 'm3',
                deviceStatus: 'standby',
                connectionStatus: 'online',
                consumptionTargetValue: 150,
                lastConnectTime: Date.now() - 3 * 60 * 1000
            },
            {
                entityId: 'hid-003',
                labelOrName: 'Hidrometro Restaurante',
                deviceIdentifier: 'HID-003',
                customerName: 'Restaurante Sabor',
                deviceType: 'HIDROMETRO',
                val: 78.9,
                pulses: 890,
                operationHours: '18h',
                domain: 'water',
                icon: 'water',
                unit: 'm3',
                deviceStatus: 'warning',
                connectionStatus: 'online',
                lastConnectTime: Date.now() - 45 * 60 * 1000
            }
        ];

        function initWaterCards() {
            const grid = document.getElementById('waterCardsGrid');
            grid.innerHTML = '';

            waterDevices.forEach((device, idx) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';
                grid.appendChild(wrapper);

                const instance = renderCardComponentHeadOffice(wrapper, {
                    entityObject: { ...device },
                    handleActionDashboard: (e, entity) => log(`Dashboard: ${entity.labelOrName}`, 'water'),
                    handleActionReport: (e, entity) => log(`Report: ${entity.labelOrName}`, 'water'),
                    handleActionSettings: (e, entity) => log(`Settings: ${entity.labelOrName}`, 'water'),
                    handleSelect: (checked, entity) => log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.labelOrName}`, 'water'),
                    handleClickCard: (e, entity) => log(`Click: ${entity.labelOrName}`, 'water'),
                    enableSelection: true,
                    enableDragDrop: true,
                    useNewComponents: true,
                    debugActive: false
                });

                // Add annotation indicator to the wrapper
                addAnnotationIndicator(wrapper, device.entityId, device);

                cardInstances.water.push({ instance, device });
            });

            log('Water cards initialized', 'water');
        }

        window.updateWaterCards = function() {
            const val = parseFloat(document.getElementById('waterValue').value) || 0;
            const pulses = parseInt(document.getElementById('waterPulses').value) || 0;
            const status = document.getElementById('waterStatus').value;

            cardInstances.water.forEach(({ instance }) => {
                instance.update({
                    val: val,
                    pulses: pulses,
                    deviceStatus: status,
                    domain: 'water',  // Required for correct icon
                    // connectionStatus prevents verifyOfflineStatus from overwriting deviceStatus
                    connectionStatus: status === 'offline' ? 'offline' : 'online',
                    lastConnectTime: Date.now()
                });
            });

            log(`Updated: ${val} m3, ${pulses}L, ${status}`, 'water');
        };

        // =====================
        // TEMPERATURE CARDS
        // =====================
        // Three cards demonstrating temperature range backgrounds:
        // Background color based on temperature range (not deviceStatus):
        // - temp-001: Blue background (temp below min range)
        // - temp-002: Green background (temp within range)
        // - temp-003: Red background (temp above max range)
        const tempDevices = [
            {
                entityId: 'temp-001',
                labelOrName: 'Sensor Loja 01',
                deviceIdentifier: 'TEMP-001',
                customerName: 'Loja Magazine',
                deviceType: 'TEMPERATURE_SENSOR',
                val: 15.0,  // Below temperatureMin=18 ‚Üí blue background
                currentTemperature: 15.0,
                lastActivityTime: Date.now() - 5 * 60 * 1000,
                domain: 'temperature',
                icon: 'temperature',
                unit: 'C',
                deviceStatus: 'power_on',  // Standard deviceStatus
                connectionStatus: 'online',
                temperatureMin: 18,
                temperatureMax: 26,
                lastConnectTime: Date.now() - 5 * 60 * 1000
            },
            {
                entityId: 'temp-002',
                labelOrName: 'Sensor Praca Alimentacao',
                deviceIdentifier: 'TEMP-002',
                customerName: 'Administracao',
                deviceType: 'TEMPERATURE_SENSOR',
                val: 22.0,  // Within 20-24 range ‚Üí green background
                currentTemperature: 22.0,
                lastActivityTime: Date.now() - 15 * 60 * 1000,
                domain: 'temperature',
                icon: 'temperature',
                unit: 'C',
                deviceStatus: 'power_on',  // Standard deviceStatus
                connectionStatus: 'online',
                temperatureMin: 20,
                temperatureMax: 24,
                lastConnectTime: Date.now() - 2 * 60 * 1000
            },
            {
                entityId: 'temp-003',
                labelOrName: 'Sensor Deposito',
                deviceIdentifier: 'TEMP-003',
                customerName: 'Logistica',
                deviceType: 'TEMPERATURE_SENSOR',
                val: 28.7,  // Above temperatureMax=25 ‚Üí red background
                currentTemperature: 28.7,
                lastActivityTime: Date.now() - 30 * 60 * 1000,
                domain: 'temperature',
                icon: 'temperature',
                unit: 'C',
                deviceStatus: 'warning',  // Standard deviceStatus (coincidentally matches hot)
                connectionStatus: 'online',
                temperatureMin: 18,
                temperatureMax: 25,
                lastConnectTime: Date.now() - 60 * 60 * 1000
            }
        ];

        function initTempCards() {
            const grid = document.getElementById('tempCardsGrid');
            grid.innerHTML = '';

            tempDevices.forEach((device, idx) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'card-wrapper';
                grid.appendChild(wrapper);

                const instance = renderCardComponentHeadOffice(wrapper, {
                    entityObject: { ...device },
                    handleActionDashboard: (e, entity) => log(`Dashboard: ${entity.labelOrName}`, 'temperature'),
                    handleActionReport: (e, entity) => log(`Report: ${entity.labelOrName}`, 'temperature'),
                    handleActionSettings: (e, entity) => log(`Settings: ${entity.labelOrName}`, 'temperature'),
                    handleSelect: (checked, entity) => log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.labelOrName}`, 'temperature'),
                    handleClickCard: (e, entity) => log(`Click: ${entity.labelOrName}`, 'temperature'),
                    enableSelection: true,
                    enableDragDrop: false, // Temperature cards don't have drag drop
                    useNewComponents: true,
                    debugActive: false
                });

                // Add annotation indicator to the wrapper
                addAnnotationIndicator(wrapper, device.entityId, device);

                cardInstances.temperature.push({ instance, device });
            });

            log('Temperature cards initialized', 'temperature');
        }

        window.updateTempCards = function() {
            const val = parseFloat(document.getElementById('tempValue').value) || 0;
            const tempMin = parseFloat(document.getElementById('tempMin').value) || 20;
            const tempMax = parseFloat(document.getElementById('tempMax').value) || 26;
            const lastActivityInput = document.getElementById('tempLastActivity').value;
            const lastActivityTime = lastActivityInput ? new Date(lastActivityInput).getTime() : Date.now();
            const status = document.getElementById('tempStatus').value;

            // Determine range status for log
            let rangeStatus = 'OK (verde)';
            if (val < tempMin) rangeStatus = 'FRIO (azul)';
            else if (val > tempMax) rangeStatus = 'QUENTE (vermelho)';

            cardInstances.temperature.forEach(({ instance }) => {
                instance.update({
                    val: val,
                    currentTemperature: val,
                    temperatureMin: tempMin,
                    temperatureMax: tempMax,
                    lastActivityTime: lastActivityTime,
                    deviceStatus: status,
                    domain: 'temperature',  // Required for correct icon
                    // connectionStatus prevents verifyOfflineStatus from overwriting deviceStatus
                    connectionStatus: status === 'offline' ? 'offline' : 'online',
                    lastConnectTime: Date.now()
                });
            });

            log(`Updated: ${val}¬∞C (faixa ${tempMin}-${tempMax}¬∞C) ‚Üí ${rangeStatus}, ${status}`, 'temperature');
        };

        // Initialize all cards on load
        document.addEventListener('DOMContentLoaded', () => {
            initEnergyCards();
            initWaterCards();
            initTempCards();
            log('All cards initialized successfully!');
        });
    </script>
</body>
</html>
