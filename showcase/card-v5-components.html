<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Card V5 Components - MYIO JS Library Showcase</title>
    <style>
      :root {
        --primary: #3b82f6;
        --primary-dark: #1d4ed8;
        --success: #22c55e;
        --warning: #f59e0b;
        --danger: #ef4444;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--gray-900);
        color: var(--gray-100);
        line-height: 1.6;
      }

      .header {
        background: linear-gradient(135deg, #00e09e, #00b4d8);
        color: white;
        padding: 32px 20px;
      }

      .header-content {
        max-width: 1400px;
        margin: 0 auto;
      }

      .breadcrumb {
        font-size: 14px;
        opacity: 0.8;
        margin-bottom: 8px;
      }

      .breadcrumb a {
        color: white;
        text-decoration: none;
      }

      .breadcrumb a:hover {
        text-decoration: underline;
      }

      .header h1 {
        font-size: 2rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .header p {
        margin-top: 8px;
        opacity: 0.9;
        font-size: 14px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 32px 20px;
      }

      .section {
        background: var(--gray-800);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }

      .section h2 {
        font-size: 1.25rem;
        color: var(--gray-100);
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .section-desc {
        color: var(--gray-600);
        font-size: 14px;
        margin-bottom: 20px;
      }

      /* Domain tabs */
      .domain-tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 24px;
        flex-wrap: wrap;
      }

      .domain-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 2px solid var(--gray-700);
      }

      .domain-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
      }

      .domain-icon.energy {
        background: rgba(59, 130, 246, 0.2);
      }
      .domain-icon.water {
        background: rgba(34, 197, 94, 0.2);
      }
      .domain-icon.temperature {
        background: rgba(249, 115, 22, 0.2);
      }

      .domain-title {
        font-size: 18px;
        font-weight: 600;
      }

      .domain-title.energy {
        color: #60a5fa;
      }
      .domain-title.water {
        color: #4ade80;
      }
      .domain-title.temperature {
        color: #fb923c;
      }

      /* Cards grid */
      .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
      }

      .card-wrapper {
        min-height: 180px;
        display: flex;
        justify-content: center;
      }

      .control-panel {
        background: var(--gray-700);
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 20px;
      }

      .control-panel h3 {
        font-size: 14px;
        color: var(--gray-400);
        margin-bottom: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .control-row {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        align-items: flex-end;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .control-group label {
        font-size: 12px;
        color: var(--gray-400);
      }

      .control-group select,
      .control-group input {
        padding: 8px 12px;
        border: 1px solid var(--gray-600);
        border-radius: 6px;
        font-size: 14px;
        min-width: 150px;
        background: var(--gray-800);
        color: var(--gray-100);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-sm {
        padding: 6px 12px;
        font-size: 13px;
      }

      .btn-primary {
        background: #00e09e;
        color: #1f2937;
      }

      .btn-primary:hover {
        background: #00c78a;
      }

      .btn-secondary {
        background: var(--gray-600);
        color: var(--gray-100);
      }

      .btn-secondary:hover {
        background: var(--gray-500);
      }

      .btn-energy {
        background: #3b82f6;
        color: white;
      }
      .btn-energy:hover {
        background: #2563eb;
      }

      .btn-water {
        background: #22c55e;
        color: white;
      }
      .btn-water:hover {
        background: #16a34a;
      }

      .btn-temperature {
        background: #f97316;
        color: white;
      }
      .btn-temperature:hover {
        background: #ea580c;
      }

      .event-log {
        background: var(--gray-900);
        color: #86efac;
        padding: 16px;
        border-radius: 8px;
        font-family: 'Monaco', 'Menlo', monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
        border: 1px solid var(--gray-700);
      }

      .event-log-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .code-example {
        background: var(--gray-900);
        color: #e5e7eb;
        padding: 16px 20px;
        border-radius: 8px;
        font-family: 'Monaco', 'Menlo', monospace;
        font-size: 13px;
        overflow-x: auto;
        border: 1px solid var(--gray-700);
      }

      .code-example .comment {
        color: #6b7280;
      }
      .code-example .keyword {
        color: #c084fc;
      }
      .code-example .string {
        color: #86efac;
      }
      .code-example .function {
        color: #60a5fa;
      }
      .code-example .number {
        color: #fbbf24;
      }

      .status-legend {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 16px;
        padding: 12px;
        background: var(--gray-700);
        border-radius: 8px;
      }

      .status-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 12px;
        color: var(--gray-300);
      }

      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
      }

      .status-dot.power_on {
        background: #3b82f6;
      }
      .status-dot.standby {
        background: #22c55e;
      }
      .status-dot.warning {
        background: #f59e0b;
      }
      .status-dot.failure {
        background: #ef4444;
      }
      .status-dot.offline {
        background: #6b7280;
      }

      .comparison-note {
        background: rgba(0, 224, 158, 0.1);
        border: 1px solid rgba(0, 224, 158, 0.3);
        border-radius: 8px;
        padding: 12px 16px;
        margin-bottom: 20px;
        font-size: 13px;
        color: #86efac;
      }

      .version-badge {
        display: inline-block;
        background: rgba(0, 224, 158, 0.2);
        color: #00e09e;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 12px;
      }
    </style>
    <script src="../dist/myio-js-library.umd.min.js"></script>
  </head>
  <body>
    <header class="header">
      <div class="header-content">
        <div class="breadcrumb"><a href="index.html">Showcase</a> / Card V5 Components</div>
        <h1>
          renderCardComponentV5
          <span class="version-badge">v5.2.0</span>
        </h1>
        <p>Card component otimizado para Shopping Dashboard com TempRangeTooltip integrado</p>
      </div>
    </header>

    <div class="container">
      <div class="comparison-note">
        <strong>Diferen√ßas do V5:</strong> Layout otimizado, min-height reduzido (114px), TempRangeTooltip
        rico para sensores de temperatura (hover na imagem), piano-keys laterais sem icone de info.
      </div>

      <div style="background: rgba(249, 115, 22, 0.1); border: 1px solid rgba(249, 115, 22, 0.3); border-radius: 8px; padding: 12px 16px; margin-bottom: 20px; font-size: 13px; color: #fb923c;">
        <strong>Tooltip Features:</strong> Hover sobre os cards de temperatura para ver as tooltips premium.
        <br>üìå <strong>PIN:</strong> Fixa a tooltip na tela (cria um clone independente) |
        ‚¨ú <strong>Maximizar:</strong> Expande para tela cheia |
        ‚úï <strong>Fechar:</strong> Fecha a tooltip |
        üñêÔ∏è <strong>Arrastar:</strong> Mova pelo header |
        ‚è±Ô∏è <strong>Delay:</strong> 1.5s antes de fechar
      </div>

      <!-- Temperature Cards Section -->
      <section class="section">
        <div class="domain-header">
          <div class="domain-icon temperature">üå°Ô∏è</div>
          <h2 class="domain-title temperature">Temperature Domain - TERMOSTATO</h2>
        </div>

        <div class="control-panel">
          <h3>Controles de Temperatura (com TempRangeTooltip)</h3>
          <div class="control-row">
            <div class="control-group">
              <label>Temperatura (¬∞C)</label>
              <input type="number" id="tempValue" value="24.5" step="0.1" />
            </div>
            <div class="control-group">
              <label>Temp Min (¬∞C)</label>
              <input type="number" id="tempMin" value="20" step="0.5" />
            </div>
            <div class="control-group">
              <label>Temp Max (¬∞C)</label>
              <input type="number" id="tempMax" value="26" step="0.5" />
            </div>
            <div class="control-group">
              <label>Status</label>
              <select id="tempStatus">
                <option value="power_on">Em Operacao</option>
                <option value="standby">Standby</option>
                <option value="warning">Alerta</option>
                <option value="failure">Falha</option>
                <option value="offline">Offline</option>
              </select>
            </div>
            <button class="btn btn-temperature" onclick="updateTempCards()">Atualizar</button>
          </div>
          <div style="margin-top: 12px; font-size: 12px; color: var(--gray-400)">
            <strong>Passe o mouse sobre a imagem do termostato para ver o TempRangeTooltip!</strong>
          </div>
        </div>

        <div class="cards-grid" id="tempCardsGrid"></div>
      </section>

      <!-- Energy Cards Section -->
      <section class="section">
        <div class="domain-header">
          <div class="domain-icon energy">‚ö°</div>
          <h2 class="domain-title energy">Energy Domain</h2>
        </div>

        <div class="control-panel">
          <div class="control-row">
            <div class="control-group">
              <label>Consumo (kWh)</label>
              <input type="number" id="energyValue" value="156.8" step="0.1" />
            </div>
            <div class="control-group">
              <label>Percentual (%)</label>
              <input type="number" id="energyPerc" value="75" step="1" min="0" max="100" />
            </div>
            <div class="control-group">
              <label>Status</label>
              <select id="energyStatus">
                <option value="power_on">Power On</option>
                <option value="standby">Standby</option>
                <option value="warning">Warning</option>
                <option value="failure">Failure</option>
                <option value="offline">Offline</option>
              </select>
            </div>
            <button class="btn btn-energy" onclick="updateEnergyCards()">Atualizar</button>
          </div>
        </div>

        <div class="cards-grid" id="energyCardsGrid"></div>
      </section>

      <!-- Water Cards Section -->
      <section class="section">
        <div class="domain-header">
          <div class="domain-icon water">üíß</div>
          <h2 class="domain-title water">Water Domain - TANK</h2>
        </div>

        <div class="control-panel">
          <div class="control-row">
            <div class="control-group">
              <label>Volume (L)</label>
              <input type="number" id="waterValue" value="4500" step="100" />
            </div>
            <div class="control-group">
              <label>Nivel (0-1)</label>
              <input type="number" id="waterLevel" value="0.75" step="0.05" min="0" max="1" />
            </div>
            <div class="control-group">
              <label>Status</label>
              <select id="waterStatus">
                <option value="power_on">Em Operacao</option>
                <option value="standby">Standby</option>
                <option value="warning">Alerta</option>
                <option value="failure">Falha</option>
                <option value="offline">Offline</option>
              </select>
            </div>
            <button class="btn btn-water" onclick="updateWaterCards()">Atualizar</button>
          </div>
        </div>

        <div class="cards-grid" id="waterCardsGrid"></div>
      </section>

      <!-- Event Log -->
      <section class="section">
        <div class="event-log-header">
          <h2>Event Log</h2>
          <button class="btn btn-sm btn-secondary" onclick="clearLog()">Limpar</button>
        </div>
        <div class="event-log" id="eventLog">Aguardando eventos...\n</div>

        <div class="status-legend">
          <div class="status-item"><span class="status-dot power_on"></span> Power On</div>
          <div class="status-item"><span class="status-dot standby"></span> Standby</div>
          <div class="status-item"><span class="status-dot warning"></span> Warning</div>
          <div class="status-item"><span class="status-dot failure"></span> Failure</div>
          <div class="status-item"><span class="status-dot offline"></span> Offline</div>
        </div>
      </section>

      <!-- Code Examples -->
      <section class="section">
        <h2>Exemplo de Uso - renderCardComponentV5</h2>

        <h3 style="color: #fb923c; margin: 16px 0 8px">Temperature (TERMOSTATO) com TempRangeTooltip</h3>
        <div class="code-example">
          <span class="keyword">import</span> { renderCardComponentV5 } <span class="keyword">from</span>
          <span class="string">'myio-js-library'</span>;

          <span class="comment">// entityObject cont√©m TODOS os dados, incluindo entityId e labelOrName</span>
          <span class="keyword">const</span> entityObject = { entityId:
          <span class="string">'termo-001'</span>, labelOrName: <span class="string">'Sensor Loja 01'</span>,
          val: <span class="number">24.5</span>, deviceType: <span class="string">'TERMOSTATO'</span>,
          deviceIdentifier: <span class="string">'TERMO-001'</span>, customerName:
          <span class="string">'Shopping ABC'</span>, deviceStatus: <span class="string">'power_on'</span>,
          temperatureMin: <span class="number">20</span>,
          <span class="comment">// Faixa ideal min</span> temperatureMax: <span class="number">26</span>
          <span class="comment">// Faixa ideal max</span>
          };

          <span class="keyword">const</span> [cardElement, cardEntity] =
          <span class="function">renderCardComponentV5</span>({ entityObject, handleClickCard: (entity) =>
          console.log(<span class="string">'Clicked:'</span>, entity), handleActionDashboard: (entity) =>
          console.log(<span class="string">'Dashboard:'</span>, entity), handleActionReport: (entity) =>
          console.log(<span class="string">'Report:'</span>, entity), handleActionSettings: (entity) =>
          console.log(<span class="string">'Settings:'</span>, entity), enableSelection:
          <span class="keyword">true</span>, enableDragDrop: <span class="keyword">false</span>
          });

          <span class="comment">// Append o elemento retornado ao container</span>
          document.getElementById(<span class="string">'card-container'</span>).appendChild(cardElement);

          <span class="comment">// O TempRangeTooltip e automaticamente vinculado ao hover na imagem!</span>
        </div>
      </section>

      <div style="text-align: center; margin-top: 32px">
        <a href="index.html" class="btn btn-primary">‚Üê Voltar ao Portal</a>
        <a href="card-components.html" class="btn btn-secondary" style="margin-left: 12px"
          >Ver Head Office Cards</a
        >
      </div>
    </div>

    <script>
      const { renderCardComponentV5, createAnnotationIndicator, openDashboardPopupSettings } = MyIOLibrary;

      // Helper function to open settings modal
      function handleOpenSettings(entity, domain) {
        log(`Opening Settings Modal for ${entity.name || entity.labelOrName}...`, domain);
        openDashboardPopupSettings({
          deviceId: entity.entityId,
          jwtToken: '123',
          entityType: 'DEVICE',
          entityName: entity.name || entity.labelOrName,
          activeTab: 'annotations',
          onClose: () => log(`Settings Modal closed for ${entity.name || entity.labelOrName}`, domain),
        });
      }

      const cardInstances = {
        energy: [],
        water: [],
        temperature: [],
      };

      const eventLog = document.getElementById('eventLog');

      // =====================
      // MOCK ANNOTATIONS DATA
      // =====================
      const MOCK_ANNOTATIONS = {
        'termo-001': [
          {
            id: 'ann-001',
            version: 1,
            text: 'Verificar calibra√ß√£o do sensor',
            type: 'pending',
            importance: 4,
            status: 'created',
            createdAt: '2024-12-14T10:00:00Z',
            dueDate: '2024-12-20T23:59:59Z',
            createdBy: { id: 'user-001', email: 'tecnico@myio.com.br', name: 'T√©cnico MYIO' },
            acknowledged: false,
            history: [],
          },
        ],
        'termo-002': [
          {
            id: 'ann-002',
            version: 1,
            text: 'Manuten√ß√£o preventiva agendada',
            type: 'maintenance',
            importance: 3,
            status: 'created',
            createdAt: '2024-12-12T14:30:00Z',
            createdBy: { id: 'user-002', email: 'admin@cliente.com', name: 'Admin Cliente' },
            acknowledged: true,
            acknowledgedBy: { id: 'user-001', email: 'tecnico@myio.com.br', name: 'T√©cnico MYIO' },
            history: [],
          },
          {
            id: 'ann-003',
            version: 1,
            text: 'Sensor funcionando normalmente ap√≥s ajuste',
            type: 'activity',
            importance: 2,
            status: 'created',
            createdAt: '2024-12-10T09:15:00Z',
            createdBy: { id: 'user-001', email: 'tecnico@myio.com.br', name: 'T√©cnico MYIO' },
            acknowledged: false,
            history: [],
          },
        ],
        'termo-003': [], // No annotations
        'elv-001': [
          {
            id: 'ann-004',
            version: 2,
            text: 'Consumo acima da m√©dia - verificar motor',
            type: 'pending',
            importance: 5,
            status: 'modified',
            createdAt: '2024-12-08T08:00:00Z',
            dueDate: '2024-12-10T18:00:00Z', // Overdue!
            createdBy: { id: 'user-003', email: 'supervisor@myio.com.br', name: 'Supervisor' },
            acknowledged: false,
            history: [],
          },
        ],
        'ac-001': [
          {
            id: 'ann-005',
            version: 1,
            text: 'Limpeza dos filtros realizada',
            type: 'activity',
            importance: 2,
            status: 'created',
            createdAt: '2024-12-15T11:00:00Z',
            createdBy: { id: 'user-002', email: 'admin@cliente.com', name: 'Admin Cliente' },
            acknowledged: true,
            history: [],
          },
        ],
        'ilu-001': [
          {
            id: 'ann-006',
            version: 1,
            text: 'Observa√ß√£o: l√¢mpadas LED instaladas',
            type: 'observation',
            importance: 1,
            status: 'created',
            createdAt: '2024-12-13T16:45:00Z',
            createdBy: { id: 'user-001', email: 'tecnico@myio.com.br', name: 'T√©cnico MYIO' },
            acknowledged: false,
            history: [],
          },
        ],
        'tank-001': [
          {
            id: 'ann-007',
            version: 1,
            text: 'N√≠vel do reservat√≥rio est√°vel',
            type: 'observation',
            importance: 1,
            status: 'created',
            createdAt: '2024-12-14T08:30:00Z',
            createdBy: { id: 'user-002', email: 'admin@cliente.com', name: 'Admin Cliente' },
            acknowledged: false,
            history: [],
          },
        ],
        'tank-002': [],
        'tank-003': [
          {
            id: 'ann-008',
            version: 1,
            text: 'Verificar bomba de recalque',
            type: 'maintenance',
            importance: 4,
            status: 'created',
            createdAt: '2024-12-11T14:00:00Z',
            dueDate: '2024-12-18T18:00:00Z',
            createdBy: { id: 'user-003', email: 'supervisor@myio.com.br', name: 'Supervisor' },
            acknowledged: false,
            history: [],
          },
        ],
      };

      // Type icons configuration
      const TYPE_CONFIG = {
        pending: {
          color: '#d63031',
          icon: '‚ö†Ô∏è',
          label: 'Pend√™ncia',
        },
        maintenance: {
          color: '#e17055',
          icon: 'üîß',
          label: 'Manuten√ß√£o',
        },
        activity: {
          color: '#00b894',
          icon: '‚úì',
          label: 'Atividade',
        },
        observation: {
          color: '#0984e3',
          icon: 'üìù',
          label: 'Observa√ß√£o',
        },
      };

      // Inject styles for type badges
      function injectBadgeStyles() {
        if (document.getElementById('annotation-type-badges-styles')) return;

        const style = document.createElement('style');
        style.id = 'annotation-type-badges-styles';
        style.textContent = `
                .annotation-type-badges {
                    position: absolute;
                    top: 50%;
                    right: 6px;
                    transform: translateY(-50%);
                    display: flex;
                    flex-direction: column;
                    gap: 4px;
                    z-index: 10;
                }

                .annotation-type-badge {
                    position: relative;
                    width: 22px;
                    height: 22px;
                    border-radius: 6px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 11px;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.15);
                }

                .annotation-type-badge:hover {
                    transform: scale(1.15);
                    box-shadow: 0 2px 8px rgba(0,0,0,0.25);
                }

                .annotation-type-badge__count {
                    position: absolute;
                    top: -4px;
                    right: -4px;
                    min-width: 14px;
                    height: 14px;
                    padding: 0 3px;
                    background: #1a1a2e;
                    color: white;
                    border-radius: 7px;
                    font-size: 9px;
                    font-weight: 700;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    line-height: 1;
                }

                /* Summary tooltip - positioned via JS to avoid card overflow */
                .annotation-summary-tooltip {
                    position: fixed;
                    min-width: 240px;
                    max-width: 300px;
                    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
                    border: 1px solid rgba(0, 0, 0, 0.1);
                    border-radius: 10px;
                    padding: 12px 14px;
                    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
                    font-family: 'Inter', system-ui, sans-serif;
                    font-size: 12px;
                    color: #1a1a2e;
                    opacity: 0;
                    visibility: hidden;
                    transition: opacity 0.2s ease, visibility 0.2s ease;
                    pointer-events: none;
                    z-index: 9999;
                }

                .annotation-summary-tooltip::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    transform: translateY(-50%);
                    border: 8px solid transparent;
                }

                /* Arrow pointing left (tooltip on right side) */
                .annotation-summary-tooltip.arrow-left::after {
                    left: -8px;
                    border-right-color: #ffffff;
                    border-left-color: transparent;
                }

                /* Arrow pointing right (tooltip on left side) */
                .annotation-summary-tooltip.arrow-right::after {
                    right: -8px;
                    border-left-color: #ffffff;
                    border-right-color: transparent;
                }

                .annotation-summary-tooltip.visible {
                    opacity: 1;
                    visibility: visible;
                }

                .annotation-summary-tooltip__title {
                    font-weight: 600;
                    font-size: 13px;
                    margin-bottom: 10px;
                    padding-bottom: 8px;
                    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    color: #1a1a2e;
                }

                .annotation-summary-tooltip__row {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 4px 0;
                }

                .annotation-summary-tooltip__label {
                    display: flex;
                    align-items: center;
                    gap: 6px;
                    color: #495057;
                }

                .annotation-summary-tooltip__dot {
                    width: 8px;
                    height: 8px;
                    border-radius: 50%;
                }

                .annotation-summary-tooltip__value {
                    font-weight: 600;
                    color: #1a1a2e;
                }

                .annotation-summary-tooltip__latest {
                    margin-top: 10px;
                    padding-top: 10px;
                    border-top: 1px solid rgba(0, 0, 0, 0.1);
                    font-size: 11px;
                }

                .annotation-summary-tooltip__latest-label {
                    color: #6c757d;
                    margin-bottom: 4px;
                }

                .annotation-summary-tooltip__latest-text {
                    color: #343a40;
                    line-height: 1.4;
                    overflow: hidden;
                    text-overflow: ellipsis;
                    display: -webkit-box;
                    -webkit-line-clamp: 2;
                    -webkit-box-orient: vertical;
                }

                .annotation-summary-tooltip__latest-meta {
                    color: #868e96;
                    font-size: 10px;
                    margin-top: 4px;
                }

                .annotation-summary-tooltip__overdue {
                    color: #d63031;
                    margin-top: 8px;
                    font-size: 11px;
                    font-weight: 500;
                }
            `;
        document.head.appendChild(style);
      }

      // Function to add annotation type badges to a card
      function addAnnotationIndicator(cardElement, entityId, entityObject) {
        const annotations = MOCK_ANNOTATIONS[entityId] || [];

        // Ensure styles are injected
        injectBadgeStyles();

        // Create wrapper for positioning
        if (cardElement && cardElement.style) {
          cardElement.style.position = 'relative';
        }

        // Filter active annotations
        const activeAnnotations = annotations.filter((a) => a.status !== 'archived');
        if (activeAnnotations.length === 0) return null;

        // Count by type
        const counts = {
          pending: 0,
          maintenance: 0,
          activity: 0,
          observation: 0,
        };

        let overdueCount = 0;
        const now = new Date();

        activeAnnotations.forEach((a) => {
          if (counts[a.type] !== undefined) {
            counts[a.type]++;
          }
          if (a.dueDate && new Date(a.dueDate) < now) {
            overdueCount++;
          }
        });

        // Create badges container
        const container = document.createElement('div');
        container.className = 'annotation-type-badges';

        // Priority order: pending, maintenance, activity, observation
        const typeOrder = ['pending', 'maintenance', 'activity', 'observation'];

        typeOrder.forEach((type) => {
          if (counts[type] > 0) {
            const config = TYPE_CONFIG[type];
            const badge = document.createElement('div');
            badge.className = 'annotation-type-badge';
            badge.style.background = config.color;
            badge.innerHTML = `
                        <span>${config.icon}</span>
                        <span class="annotation-type-badge__count">${counts[type]}</span>
                    `;

            badge.addEventListener('click', (e) => {
              e.stopPropagation();
              log(`Opening Settings Modal for ${entityObject.labelOrName} (${config.label})...`);
              openDashboardPopupSettings({
                entityId: entityId,
                entityType: 'DEVICE',
                entityName: entityObject.labelOrName,
                activeTab: 'annotations',
                onClose: () => log(`Settings Modal closed for ${entityObject.labelOrName}`),
              });
            });

            container.appendChild(badge);
          }
        });

        // Create summary tooltip
        const latestAnnotation = activeAnnotations[0];
        const rows = typeOrder
          .filter((type) => counts[type] > 0)
          .map(
            (type) => `
                    <div class="annotation-summary-tooltip__row">
                        <span class="annotation-summary-tooltip__label">
                            <span class="annotation-summary-tooltip__dot" style="background: ${TYPE_CONFIG[type].color}"></span>
                            ${TYPE_CONFIG[type].label}
                        </span>
                        <span class="annotation-summary-tooltip__value">${counts[type]}</span>
                    </div>
                `
          )
          .join('');

        const latestSection = latestAnnotation
          ? `
                <div class="annotation-summary-tooltip__latest">
                    <div class="annotation-summary-tooltip__latest-label">√öltima anota√ß√£o:</div>
                    <div class="annotation-summary-tooltip__latest-text">"${latestAnnotation.text}"</div>
                    <div class="annotation-summary-tooltip__latest-meta">
                        ${latestAnnotation.createdBy.name} ‚Ä¢ ${new Date(
              latestAnnotation.createdAt
            ).toLocaleDateString('pt-BR')}
                    </div>
                </div>
            `
          : '';

        const overdueWarning =
          overdueCount > 0
            ? `<div class="annotation-summary-tooltip__overdue">‚ö†Ô∏è ${overdueCount} anota√ß√£o(√µes) vencida(s)</div>`
            : '';

        const tooltip = document.createElement('div');
        tooltip.className = 'annotation-summary-tooltip';
        tooltip.innerHTML = `
                <div class="annotation-summary-tooltip__title">
                    üìã Anota√ß√µes (${activeAnnotations.length})
                </div>
                ${rows}
                ${overdueWarning}
                ${latestSection}
            `;

        // Append tooltip to body (to avoid card overflow issues)
        document.body.appendChild(tooltip);

        // Position tooltip on hover - prefer right side
        container.addEventListener('mouseenter', () => {
          const rect = container.getBoundingClientRect();
          const tooltipWidth = 260; // approximate width
          const spacing = 12;
          const viewportWidth = window.innerWidth;

          // Calculate positions
          const rightPosition = rect.right + spacing;
          const leftPosition = rect.left - tooltipWidth - spacing;

          // Check if right side has enough space
          const canFitRight = rightPosition + tooltipWidth < viewportWidth;

          // Remove previous arrow classes
          tooltip.classList.remove('arrow-left', 'arrow-right');

          if (canFitRight) {
            // Position on right side
            tooltip.style.left = `${rightPosition}px`;
            tooltip.classList.add('arrow-left'); // arrow points left
          } else {
            // Fallback to left side
            tooltip.style.left = `${leftPosition}px`;
            tooltip.classList.add('arrow-right'); // arrow points right
          }

          tooltip.style.top = `${rect.top + rect.height / 2}px`;
          tooltip.style.transform = 'translateY(-50%)';
          tooltip.classList.add('visible');
        });

        container.addEventListener('mouseleave', () => {
          tooltip.classList.remove('visible');
        });

        // Append badges to card
        cardElement.appendChild(container);

        return container;
      }

      function log(message, domain = '') {
        const timestamp = new Date().toLocaleTimeString();
        const prefix = domain ? `[${domain.toUpperCase()}]` : '';
        eventLog.textContent += `[${timestamp}] ${prefix} ${message}\n`;
        eventLog.scrollTop = eventLog.scrollHeight;
      }

      window.clearLog = function () {
        eventLog.textContent = '';
      };

      // =====================
      // TEMPERATURE CARDS (TERMOSTATO)
      // entityObject must have entityId and labelOrName
      // =====================
      const tempEntityObjects = [
        {
          entityId: 'termo-001',
          labelOrName: 'Sensor Loja 01',
          val: 18.0,
          deviceType: 'TERMOSTATO',
          deviceIdentifier: 'TERMO-001',
          customerName: 'Loja Magazine',
          deviceStatus: 'power_on',
          temperatureMin: 20,
          temperatureMax: 26,
        },
        {
          entityId: 'termo-002',
          labelOrName: 'Sensor Praca Alimentacao',
          val: 23.0,
          deviceType: 'TERMOSTATO',
          deviceIdentifier: 'TERMO-002',
          customerName: 'Administracao',
          deviceStatus: 'power_on',
          temperatureMin: 20,
          temperatureMax: 26,
        },
        {
          entityId: 'termo-003',
          labelOrName: 'Sensor Deposito',
          val: 28.5,
          deviceType: 'TERMOSTATO',
          deviceIdentifier: 'TERMO-003',
          customerName: 'Logistica',
          deviceStatus: 'warning',
          temperatureMin: 20,
          temperatureMax: 26,
        },
      ];

      function initTempCards() {
        const grid = document.getElementById('tempCardsGrid');
        grid.innerHTML = '';

        tempEntityObjects.forEach((entityObj, idx) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'card-wrapper';
          grid.appendChild(wrapper);

          const instance = renderCardComponentV5({
            entityObject: { ...entityObj, jwtToken: '123' },
            handleActionDashboard: (entity) => log(`Dashboard: ${entity.name}`, 'temperature'),
            handleActionReport: (entity) => log(`Report: ${entity.name}`, 'temperature'),
            handleActionSettings: (entity) => handleOpenSettings(entity, 'temperature'),
            handleSelect: (checked, entity) =>
              log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.name}`, 'temperature'),
            handleClickCard: (entity) => log(`Click: ${entity.name}`, 'temperature'),
            enableSelection: true,
            enableDragDrop: false,
          });

          // Append the returned element to wrapper
          if (instance && instance[0]) {
            wrapper.appendChild(instance[0]);
            // Add annotation indicator
            addAnnotationIndicator(instance[0], entityObj.entityId, entityObj);
          }

          cardInstances.temperature.push({ instance, entityObject: entityObj });
        });

        log('Temperature cards initialized (hover sobre imagem para TempRangeTooltip)', 'temperature');
      }

      window.updateTempCards = function () {
        const val = parseFloat(document.getElementById('tempValue').value) || 0;
        const tempMin = parseFloat(document.getElementById('tempMin').value) || 20;
        const tempMax = parseFloat(document.getElementById('tempMax').value) || 26;
        const status = document.getElementById('tempStatus').value;

        // Determine range status for log
        let rangeStatus = 'OK (verde)';
        if (val < tempMin) rangeStatus = 'FRIO (azul)';
        else if (val > tempMax) rangeStatus = 'QUENTE (vermelho)';

        // Re-render cards with new values
        const grid = document.getElementById('tempCardsGrid');
        grid.innerHTML = '';
        cardInstances.temperature = [];

        tempEntityObjects.forEach((entityObj, idx) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'card-wrapper';
          grid.appendChild(wrapper);

          const updatedEntityObject = {
            ...entityObj,
            val: val,
            deviceStatus: status,
            temperatureMin: tempMin,
            temperatureMax: tempMax,
          };

          const instance = renderCardComponentV5({
            entityObject: updatedEntityObject,
            handleActionDashboard: (entity) => log(`Dashboard: ${entity.name}`, 'temperature'),
            handleActionReport: (entity) => log(`Report: ${entity.name}`, 'temperature'),
            handleActionSettings: (entity) => handleOpenSettings(entity, 'temperature'),
            handleSelect: (checked, entity) =>
              log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.name}`, 'temperature'),
            handleClickCard: (entity) => log(`Click: ${entity.name}`, 'temperature'),
            enableSelection: true,
            enableDragDrop: false,
          });

          if (instance && instance[0]) {
            wrapper.appendChild(instance[0]);
          }

          cardInstances.temperature.push({ instance, entityObject: updatedEntityObject });
        });

        log(`Updated: ${val}¬∞C (faixa ${tempMin}-${tempMax}¬∞C) ‚Üí ${rangeStatus}, ${status}`, 'temperature');
      };

      // =====================
      // ENERGY CARDS
      // =====================
      const energyEntityObjects = [
        {
          entityId: 'elv-001',
          labelOrName: 'Elevador Social',
          val: 156.8,
          perc: 78,
          deviceType: 'ELEVADOR',
          deviceIdentifier: 'ELV-001',
          customerName: 'Shopping ABC',
          deviceStatus: 'power_on',
        },
        {
          entityId: 'ac-001',
          labelOrName: 'Ar Condicionado',
          val: 89.2,
          perc: 45,
          deviceType: 'AR_CONDICIONADO',
          deviceIdentifier: 'AC-001',
          customerName: 'Shopping ABC',
          deviceStatus: 'standby',
        },
        {
          entityId: 'ilu-001',
          labelOrName: 'Iluminacao',
          val: 45.6,
          perc: 92,
          deviceType: 'ILUMINACAO',
          deviceIdentifier: 'ILU-001',
          customerName: 'Shopping XYZ',
          deviceStatus: 'warning',
        },
      ];

      function initEnergyCards() {
        const grid = document.getElementById('energyCardsGrid');
        grid.innerHTML = '';

        energyEntityObjects.forEach((entityObj) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'card-wrapper';
          grid.appendChild(wrapper);

          const instance = renderCardComponentV5({
            entityObject: { ...entityObj },
            handleActionDashboard: (entity) => log(`Dashboard: ${entity.name}`, 'energy'),
            handleActionReport: (entity) => log(`Report: ${entity.name}`, 'energy'),
            handleActionSettings: (entity) => handleOpenSettings(entity, 'energy'),
            handleSelect: (checked, entity) =>
              log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.name}`, 'energy'),
            handleClickCard: (entity) => log(`Click: ${entity.name}`, 'energy'),
            enableSelection: true,
            enableDragDrop: true,
          });

          if (instance && instance[0]) {
            wrapper.appendChild(instance[0]);
            // Add annotation indicator
            addAnnotationIndicator(instance[0], entityObj.entityId, entityObj);
          }

          cardInstances.energy.push({ instance, entityObject: entityObj });
        });

        log('Energy cards initialized', 'energy');
      }

      window.updateEnergyCards = function () {
        const val = parseFloat(document.getElementById('energyValue').value) || 0;
        const perc = parseFloat(document.getElementById('energyPerc').value) || 0;
        const status = document.getElementById('energyStatus').value;

        // Re-render cards
        const grid = document.getElementById('energyCardsGrid');
        grid.innerHTML = '';
        cardInstances.energy = [];

        energyEntityObjects.forEach((entityObj) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'card-wrapper';
          grid.appendChild(wrapper);

          const updatedEntityObject = {
            ...entityObj,
            val: val,
            perc: perc,
            deviceStatus: status,
          };

          const instance = renderCardComponentV5({
            entityObject: updatedEntityObject,
            handleActionDashboard: (entity) => log(`Dashboard: ${entity.name}`, 'energy'),
            handleActionReport: (entity) => log(`Report: ${entity.name}`, 'energy'),
            handleActionSettings: (entity) => handleOpenSettings(entity, 'energy'),
            handleSelect: (checked, entity) =>
              log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.name}`, 'energy'),
            handleClickCard: (entity) => log(`Click: ${entity.name}`, 'energy'),
            enableSelection: true,
            enableDragDrop: true,
          });

          if (instance && instance[0]) {
            wrapper.appendChild(instance[0]);
          }

          cardInstances.energy.push({ instance, entityObject: updatedEntityObject });
        });

        log(`Updated: ${val} kWh, ${perc}%, ${status}`, 'energy');
      };

      // =====================
      // WATER CARDS (TANK)
      // =====================
      const waterEntityObjects = [
        {
          entityId: 'tank-001',
          labelOrName: 'Caixa Dagua Principal',
          val: 4500,
          waterPercentage: 0.9,
          deviceType: 'TANK',
          deviceIdentifier: 'TANK-001',
          customerName: 'Shopping ABC',
          deviceStatus: 'power_on',
        },
        {
          entityId: 'tank-002',
          labelOrName: 'Reservatorio Inferior',
          val: 2800,
          waterPercentage: 0.56,
          deviceType: 'CAIXA_DAGUA',
          deviceIdentifier: 'TANK-002',
          customerName: 'Shopping ABC',
          deviceStatus: 'standby',
        },
        {
          entityId: 'tank-003',
          labelOrName: 'Cisterna',
          val: 1200,
          waterPercentage: 0.24,
          deviceType: 'TANK',
          deviceIdentifier: 'TANK-003',
          customerName: 'Shopping XYZ',
          deviceStatus: 'warning',
        },
      ];

      function initWaterCards() {
        const grid = document.getElementById('waterCardsGrid');
        grid.innerHTML = '';

        waterEntityObjects.forEach((entityObj) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'card-wrapper';
          grid.appendChild(wrapper);

          const instance = renderCardComponentV5({
            entityObject: { ...entityObj },
            handleActionDashboard: (entity) => log(`Dashboard: ${entity.name}`, 'water'),
            handleActionReport: (entity) => log(`Report: ${entity.name}`, 'water'),
            handleActionSettings: (entity) => handleOpenSettings(entity, 'water'),
            handleSelect: (checked, entity) =>
              log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.name}`, 'water'),
            handleClickCard: (entity) => log(`Click: ${entity.name}`, 'water'),
            enableSelection: true,
            enableDragDrop: true,
          });

          if (instance && instance[0]) {
            wrapper.appendChild(instance[0]);
            // Add annotation indicator
            addAnnotationIndicator(instance[0], entityObj.entityId, entityObj);
          }

          cardInstances.water.push({ instance, entityObject: entityObj });
        });

        log('Water cards initialized', 'water');
      }

      window.updateWaterCards = function () {
        const val = parseFloat(document.getElementById('waterValue').value) || 0;
        const level = parseFloat(document.getElementById('waterLevel').value) || 0;
        const status = document.getElementById('waterStatus').value;

        // Re-render cards
        const grid = document.getElementById('waterCardsGrid');
        grid.innerHTML = '';
        cardInstances.water = [];

        waterEntityObjects.forEach((entityObj) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'card-wrapper';
          grid.appendChild(wrapper);

          const updatedEntityObject = {
            ...entityObj,
            val: val,
            waterPercentage: level,
            deviceStatus: status,
          };

          const instance = renderCardComponentV5({
            entityObject: updatedEntityObject,
            handleActionDashboard: (entity) => log(`Dashboard: ${entity.name}`, 'water'),
            handleActionReport: (entity) => log(`Report: ${entity.name}`, 'water'),
            handleActionSettings: (entity) => handleOpenSettings(entity, 'water'),
            handleSelect: (checked, entity) =>
              log(`Select ${checked ? 'ON' : 'OFF'}: ${entity.name}`, 'water'),
            handleClickCard: (entity) => log(`Click: ${entity.name}`, 'water'),
            enableSelection: true,
            enableDragDrop: true,
          });

          if (instance && instance[0]) {
            wrapper.appendChild(instance[0]);
          }

          cardInstances.water.push({ instance, entityObject: updatedEntityObject });
        });

        log(`Updated: ${val}L, nivel ${(level * 100).toFixed(0)}%, ${status}`, 'water');
      };

      // Initialize all cards on load
      document.addEventListener('DOMContentLoaded', () => {
        initTempCards();
        initEnergyCards();
        initWaterCards();
        log('All V5 cards initialized successfully!');
      });
    </script>
  </body>
</html>
