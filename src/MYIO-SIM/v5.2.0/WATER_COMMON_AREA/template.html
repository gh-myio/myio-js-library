<div class="water-common-area-wrap" id="waterCommonAreaWrap">
  <!-- RFC-0087: Water Common Area widget based on EQUIPMENTS -->

  <div class="toolbar-zoom">
    <div class="shopping-filter-chips" id="shoppingFilterChips"></div>
  </div>

  <!-- Water Statistics Header (outside view containers - always visible) -->
  <div class="water-stats-header" id="waterStatsHeader" style="display: flex !important; flex-direction: row !important;">
    <div class="stat-item">
      <span class="stat-label">Conectividade</span>
      <span class="stat-value" id="waterStatsConnectivity">-</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Total de Hidrômetros</span>
      <span class="stat-value" id="waterStatsTotal">-</span>
    </div>
    <div class="stat-item highlight">
      <span class="stat-label">Consumo Total de Água</span>
      <span class="stat-value" id="waterStatsConsumption">-</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Sem Consumo</span>
      <span class="stat-value" id="waterStatsZero">-</span>
    </div>

    <!-- Filter Actions -->
    <div class="filter-actions">
      <div class="search-wrap" id="searchWrap">
        <input type="text" id="waterSearch" placeholder="Buscar hidrômetro..." autocomplete="off">
      </div>
      <button class="icon-btn" id="btnSearch" title="Buscar" aria-label="Buscar">
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
          <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20l-6-6zM4 9.5C4 6.46 6.46 4 9.5 4S15 6.46 15 9.5 12.54 15 9.5 15 4 12.54 4 9.5z"/>
        </svg>
      </button>
      <button class="icon-btn" id="btnFilter" title="Filtros" aria-label="Filtros">
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
          <path d="M3 4h18l-7 8v6l-4 2v-8L3 4z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Loading overlay -->
  <div id="water-loading-overlay" class="water-loading-overlay" style="display: none;">
    <div class="loading-spinner">
      <svg style="width:48px; height:48px; animation: spin 1s linear infinite;" viewBox="0 0 50 50">
        <circle cx="25" cy="25" r="20" fill="none" stroke="#0288d1" stroke-width="5" stroke-linecap="round"
                stroke-dasharray="90,150" stroke-dashoffset="0">
        </circle>
      </svg>
      <p>Carregando dados de consumo de água...</p>
    </div>
  </div>

  <section class="water-grid" id="waterGrid">
      <div id="cards-grid" class="cards-grid"></div>
  </section>

  <!-- Filter Modal -->
  <div id="filterModal" class="water-modal hidden" role="dialog" aria-modal="true" aria-labelledby="filterTitle">
    <div class="water-modal-card">
      <header class="water-modal-header">
        <h3 id="filterTitle">Selecionar Hidrômetros</h3>
        <button class="icon-btn" id="closeFilter" aria-label="Fechar">
          <svg viewBox="0 0 24 24" width="18" height="18">
            <path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.3l6.3 6.29 6.29-6.3z"/>
          </svg>
        </button>
      </header>

      <section class="water-modal-body">
        <div class="filter-block">
          <div class="filter-tabs" id="filterTabs">
            <button class="filter-tab active" data-filter="all">TODOS (<span id="countAll">0</span>)</button>
            <button class="filter-tab" data-filter="online">ONLINE (<span id="countOnline">0</span>)</button>
            <button class="filter-tab" data-filter="offline">OFFLINE (<span id="countOffline">0</span>)</button>
            <button class="filter-tab" data-filter="with-consumption">COM CONSUMO (<span id="countWithConsumption">0</span>)</button>
            <button class="filter-tab" data-filter="no-consumption">SEM CONSUMO (<span id="countNoConsumption">0</span>)</button>
          </div>

          <div class="filter-search">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20l-6-6zM4 9.5C4 6.46 6.46 4 9.5 4S15 6.46 15 9.5 12.54 15 9.5 15 4 12.54 4 9.5z"/>
            </svg>
            <input id="filterDeviceSearch" type="text" placeholder="Buscar hidrômetros..." autocomplete="off">
            <button class="clear-x" id="filterDeviceClear" title="Limpar" aria-label="Limpar">
              <svg viewBox="0 0 24 24" width="14" height="14">
                <path d="M18.3 5.71 12 12l6.3 6.29-1.41 1.42L10.59 13.4 4.29 19.7 2.88 18.29 9.17 12 2.88 5.71 4.29 4.3l6.3 6.29 6.29-6.3z"/>
              </svg>
            </button>
          </div>
          <div id="deviceChecklist" class="checklist" role="listbox" aria-multiselectable="true"></div>
        </div>

        <div class="filter-block">
          <label class="block-label">Ordenação</label>
          <div class="radio-grid">
            <label><input type="radio" name="sortMode" value="cons_desc" checked> Consumo ↓ (padrão)</label>
            <label><input type="radio" name="sortMode" value="cons_asc"> Consumo ↑</label>
            <label><input type="radio" name="sortMode" value="alpha_asc"> A → Z</label>
            <label><input type="radio" name="sortMode" value="alpha_desc"> Z → A</label>
          </div>
          <p class="muted">Caso o consumo seja o mesmo é considerada a ordem alfabética.</p>
        </div>
      </section>

      <footer class="water-modal-footer">
        <button id="applyFilters" class="btn primary">Aplicar</button>
        <button id="resetFilters" class="btn">Resetar</button>
      </footer>
    </div>
  </div>
</div>
