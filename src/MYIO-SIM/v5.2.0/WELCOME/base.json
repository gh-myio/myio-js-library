{
  "entityType": "WIDGET_TYPE",
  "entity": {
    "fqn": "widget_head_office_welcome_v5_2_0",
    "name": "Widget Head Office - WELCOME - v5.2.0",
    "deprecated": false,
    "image": null,
    "description": null,
    "descriptor": {
      "type": "latest",
      "sizeX": 7.5,
      "sizeY": 3,
      "resources": [
        {
          "url": "https://unpkg.com/myio-js-library@0.1.184/dist/myio-js-library.umd.min.js"
        }
      ],
      "templateHtml": "<section class=\"welcome-lv\">\r\n  <!-- Hero Section -->\r\n  <div class=\"hero-container\">\r\n    <!-- Logo -->\r\n    <div class=\"brand-logo\">\r\n      <img id=\"welcomeBrandLogo\" src=\"\" alt=\"Logo\" />\r\n    </div>\r\n\r\n    <!-- User Menu -->\r\n    <div class=\"user-menu\" id=\"welcomeUserMenu\">\r\n      <div class=\"user-info\">\r\n        <div class=\"user-name\" id=\"welcomeUserName\">Carregando...</div>\r\n        <div class=\"user-email\" id=\"welcomeUserEmail\"></div>\r\n      </div>\r\n      <button class=\"btn-logout\" id=\"welcomeLogout\">\r\n        <span class=\"logout-icon\">ðŸšª</span>\r\n        <span class=\"logout-text\">Sair</span>\r\n      </button>\r\n    </div>\r\n\r\n    <!-- Hero Content (rev001: Added IDs for text overrides) -->\r\n    <div class=\"hero-content\">\r\n      <h1 class=\"hero-title\" id=\"welcomeHeroTitle\">Bem-vindo ao MYIO SIM - HEAD OFFICE</h1>\r\n      <p class=\"hero-description\" id=\"welcomeHeroDescription\">\r\n        GestÃ£o inteligente de energia, Ã¡gua e recursos para shoppings centers\r\n      </p>\r\n      <button class=\"btn-primary\" id=\"welcomeCTA\" tabindex=\"0\" aria-label=\"ACESSAR PAINEL\">\r\n        ACESSAR PAINEL\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Shopping Shortcuts (rev001: Cards have tabindex and aria-labels in JS) -->\r\n  <div\r\n    class=\"shortcuts-container\"\r\n    id=\"welcomeShortcuts\"\r\n    role=\"navigation\"\r\n    aria-label=\"Shopping dashboard shortcuts\"\r\n  >\r\n    <!-- Cards will be rendered here with accessibility attributes -->\r\n  </div>\r\n</section>\r\n",
      "templateCss": "/* RFC-0057: Welcome LV Widget Styles */\r\n\r\n/* Hide ThingsBoard Actions UI element */\r\ntb-widget-actions,\r\n.tb-widget-actions,\r\n.tb-widget-actions-absolute {\r\n  display: none !important;\r\n  visibility: hidden !important;\r\n  opacity: 0 !important;\r\n  pointer-events: none !important;\r\n}\r\n\r\n/* CSS Variables (overridable via Customer attributes) */\r\n.welcome-lv {\r\n  --welcome-ink: #f5f7fa;\r\n  --welcome-muted: #b8c2d8;\r\n  --welcome-primary: #7a2ff7;\r\n  --welcome-secondary: #5a1fd1;\r\n  --welcome-grad-start: rgba(10, 18, 44, 0.55);\r\n  --welcome-grad-end: rgba(10, 18, 44, 0.15);\r\n}\r\n\r\n.welcome-lv {\r\n  width: 100% !important;\r\n  min-height: 800px !important;\r\n  background: linear-gradient(120deg, var(--welcome-grad-start), var(--welcome-grad-end)),\r\n    url('https://dashboard.myio-bas.com/api/images/public/wntqPf1KcpLX2l182DY86Y4p8pa3bj6F') !important;\r\n  background-size: cover !important;\r\n  background-position: center !important;\r\n  background-repeat: no-repeat !important;\r\n  color: var(--welcome-ink) !important;\r\n  padding: 40px !important;\r\n  border-radius: 12px !important;\r\n  box-sizing: border-box !important;\r\n  position: relative !important;\r\n}\r\n\r\n/* Hero Layout - Relative container */\r\n.welcome-lv .hero-container {\r\n  width: 100% !important;\r\n  position: relative !important;\r\n  min-height: 700px !important;\r\n  margin-bottom: 20px !important;\r\n  display: flex !important;\r\n  flex-direction: column !important;\r\n  justify-content: center !important;\r\n  align-items: center !important;\r\n}\r\n\r\n/* Logo - flutuante canto superior esquerdo */\r\n.welcome-lv .brand-logo {\r\n  position: absolute !important;\r\n  top: 0 !important;\r\n  left: 0 !important;\r\n  z-index: 10 !important;\r\n  width: auto !important;\r\n  max-width: 1600px !important;\r\n}\r\n\r\n.welcome-lv .brand-logo img {\r\n  height: auto !important;\r\n  width: auto !important;\r\n  max-width: 1600px !important;\r\n  max-height: 800px !important;\r\n  min-width: 500px !important;\r\n  object-fit: contain !important;\r\n  object-position: left top !important;\r\n  display: block !important;\r\n}\r\n\r\n/* User Menu - flutuante canto superior direito */\r\n.welcome-lv .user-menu {\r\n  position: absolute !important;\r\n  top: 20px !important;\r\n  right: 20px !important;\r\n  z-index: 10 !important;\r\n  display: flex !important;\r\n  flex-direction: column !important;\r\n  align-items: flex-end !important;\r\n  gap: 12px !important;\r\n  padding: 18px 24px !important;\r\n  background: var(--welcome-user-menu-bg, rgba(255, 255, 255, 0.15)) !important;\r\n  border-radius: 12px !important;\r\n  backdrop-filter: blur(10px) !important;\r\n  -webkit-backdrop-filter: blur(10px) !important;\r\n  border: 1px solid var(--welcome-user-menu-border, rgba(255, 255, 255, 0.3)) !important;\r\n  min-width: 240px !important;\r\n  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2) !important;\r\n}\r\n\r\n.welcome-lv .user-info {\r\n  display: flex !important;\r\n  flex-direction: column !important;\r\n  align-items: flex-end !important;\r\n  text-align: right !important;\r\n  width: 100% !important;\r\n}\r\n\r\n.welcome-lv .user-name {\r\n  font-size: 16px !important;\r\n  font-weight: 600 !important;\r\n  color: var(--welcome-ink) !important;\r\n  margin: 0 0 6px 0 !important;\r\n  padding: 0 !important;\r\n  word-wrap: break-word !important;\r\n  white-space: normal !important;\r\n  line-height: 1.3 !important;\r\n}\r\n\r\n.welcome-lv .user-email {\r\n  font-size: 13px !important;\r\n  font-weight: 400 !important;\r\n  color: var(--welcome-ink) !important;\r\n  opacity: 0.9 !important;\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n  word-wrap: break-word !important;\r\n  white-space: normal !important;\r\n  line-height: 1.3 !important;\r\n  display: block !important;\r\n  visibility: visible !important;\r\n  height: auto !important;\r\n  min-height: 16px !important;\r\n}\r\n\r\n/* Garantir que o email seja exibido mesmo vazio */\r\n.welcome-lv #welcomeUserEmail {\r\n  display: block !important;\r\n  visibility: visible !important;\r\n}\r\n\r\n.welcome-lv .btn-logout {\r\n  display: inline-flex !important;\r\n  align-items: center !important;\r\n  justify-content: center !important;\r\n  gap: 6px !important;\r\n  padding: 10px 18px !important;\r\n  background: var(--welcome-logout-btn-bg, rgba(255, 255, 255, 0.2)) !important;\r\n  border: 1px solid var(--welcome-logout-btn-border, rgba(255, 255, 255, 0.4)) !important;\r\n  border-radius: 8px !important;\r\n  color: var(--welcome-ink) !important;\r\n  font-size: 13px !important;\r\n  font-weight: 600 !important;\r\n  cursor: pointer !important;\r\n  transition: all 0.2s !important;\r\n}\r\n\r\n.welcome-lv .btn-logout .logout-icon {\r\n  font-size: 16px !important;\r\n  line-height: 1 !important;\r\n}\r\n\r\n.welcome-lv .btn-logout .logout-text {\r\n  line-height: 1 !important;\r\n}\r\n\r\n.welcome-lv .btn-logout:hover {\r\n  background: rgba(255, 255, 255, 0.3) !important;\r\n  transform: translateY(-2px) !important;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;\r\n}\r\n\r\n.welcome-lv .btn-logout:focus {\r\n  outline: 2px solid var(--welcome-primary) !important;\r\n  outline-offset: 2px !important;\r\n}\r\n\r\n.welcome-lv .btn-logout:active {\r\n  transform: translateY(0) !important;\r\n}\r\n\r\n/* Hero Content - centralizado */\r\n.welcome-lv .hero-content {\r\n  position: relative !important;\r\n  z-index: 5 !important;\r\n  display: flex !important;\r\n  flex-direction: column !important;\r\n  justify-content: center !important;\r\n  align-items: center !important;\r\n  text-align: center !important;\r\n  gap: 24px !important;\r\n  width: 100% !important;\r\n  max-width: 800px !important;\r\n  margin: 0 auto !important;\r\n  padding-top: 200px !important;\r\n}\r\n\r\n.welcome-lv .hero-title {\r\n  font-size: 48px !important;\r\n  font-weight: 700 !important;\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n  color: var(--welcome-ink) !important;\r\n  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;\r\n  line-height: 1.2 !important;\r\n}\r\n\r\n.welcome-lv .hero-description {\r\n  font-size: 18px !important;\r\n  font-weight: 400 !important;\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n  color: var(--welcome-muted) !important;\r\n  max-width: 600px !important;\r\n  line-height: 1.5 !important;\r\n}\r\n\r\n.welcome-lv .btn-primary {\r\n  padding: 16px 48px !important;\r\n  background: linear-gradient(135deg, var(--welcome-primary), var(--welcome-secondary)) !important;\r\n  border: none !important;\r\n  border-radius: 8px !important;\r\n  color: var(--welcome-ink) !important;\r\n  font-size: 16px !important;\r\n  font-weight: 700 !important;\r\n  text-transform: uppercase !important;\r\n  letter-spacing: 1px !important;\r\n  cursor: pointer !important;\r\n  box-shadow: 0 4px 16px rgba(122, 47, 247, 0.4) !important;\r\n  transition: all 0.3s !important;\r\n}\r\n\r\n.welcome-lv .btn-primary:hover {\r\n  transform: translateY(-4px) !important;\r\n  box-shadow: 0 8px 24px rgba(122, 47, 247, 0.6) !important;\r\n}\r\n\r\n.welcome-lv .btn-primary:focus {\r\n  outline: 2px solid var(--welcome-ink) !important;\r\n  outline-offset: 2px !important;\r\n}\r\n\r\n.welcome-lv .btn-primary:active {\r\n  transform: translateY(-2px) !important;\r\n}\r\n\r\n/* Shopping Shortcuts */\r\n.welcome-lv .shortcuts-container {\r\n  margin-top: 16px !important;\r\n  display: flex !important;\r\n  justify-content: center !important;\r\n  gap: 16px !important;\r\n  overflow-x: auto !important;\r\n  padding: 16px 0 !important;\r\n  scroll-behavior: smooth !important;\r\n  flex-wrap: wrap !important;\r\n  width: 100% !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container::-webkit-scrollbar {\r\n  height: 8px !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container::-webkit-scrollbar-track {\r\n  background: rgba(255, 255, 255, 0.1) !important;\r\n  border-radius: 4px !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container::-webkit-scrollbar-thumb {\r\n  background: var(--welcome-primary) !important;\r\n  border-radius: 4px !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container::-webkit-scrollbar-thumb:hover {\r\n  background: var(--welcome-secondary) !important;\r\n}\r\n\r\n/* Shopping Cards - botÃµes clicÃ¡veis na parte inferior */\r\n.welcome-lv .shortcuts-container .shopping-card {\r\n  flex: 0 0 280px !important;\r\n  height: 160px !important;\r\n  background: var(--welcome-shopping-card-bg, rgba(255, 255, 255, 0.1)) !important;\r\n  border-radius: 12px !important;\r\n  padding: 20px !important;\r\n  cursor: pointer !important;\r\n  position: relative !important;\r\n  overflow: hidden !important;\r\n  backdrop-filter: blur(10px) !important;\r\n  -webkit-backdrop-filter: blur(10px) !important;\r\n  border: 1px solid var(--welcome-shopping-card-border, rgba(255, 255, 255, 0.2)) !important;\r\n  transition: all 0.3s !important;\r\n  box-sizing: border-box !important;\r\n  text-align: center !important;\r\n  font-family: inherit !important;\r\n  display: flex !important;\r\n  flex-direction: column !important;\r\n  align-items: center !important;\r\n  justify-content: center !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container .shopping-card:hover {\r\n  transform: translateY(-8px) !important;\r\n  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3) !important;\r\n  border-color: var(--welcome-primary) !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container .shopping-card:focus {\r\n  outline: 2px solid var(--welcome-primary) !important;\r\n  outline-offset: 2px !important;\r\n  transform: translateY(-4px) !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container .shopping-card:active {\r\n  transform: translateY(-2px) !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container .shopping-card .card-bg {\r\n  position: absolute !important;\r\n  top: 0 !important;\r\n  left: 0 !important;\r\n  width: 100% !important;\r\n  height: 100% !important;\r\n  background-size: cover !important;\r\n  background-position: center !important;\r\n  opacity: 0.3 !important;\r\n  z-index: 0 !important;\r\n  transition: opacity 0.3s !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container .shopping-card:hover .card-bg {\r\n  opacity: 0.4 !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container .shopping-card h3 {\r\n  position: relative !important;\r\n  z-index: 1 !important;\r\n  margin: 0 0 8px 0 !important;\r\n  padding: 0 !important;\r\n  font-size: 20px !important;\r\n  font-weight: 700 !important;\r\n  color: var(--welcome-ink) !important;\r\n  line-height: 1.3 !important;\r\n}\r\n\r\n.welcome-lv .shortcuts-container .shopping-card p {\r\n  position: relative !important;\r\n  z-index: 1 !important;\r\n  margin: 0 !important;\r\n  padding: 0 !important;\r\n  font-size: 14px !important;\r\n  color: var(--welcome-muted) !important;\r\n  line-height: 1.3 !important;\r\n}\r\n\r\n/* Responsive */\r\n@media (max-width: 1024px) {\r\n  .welcome-lv .hero-container {\r\n    min-height: 600px !important;\r\n  }\r\n\r\n  .welcome-lv .brand-logo {\r\n    max-width: 800px !important;\r\n  }\r\n\r\n  .welcome-lv .brand-logo img {\r\n    max-width: 800px !important;\r\n    max-height: 400px !important;\r\n    min-width: 300px !important;\r\n  }\r\n\r\n  .welcome-lv .user-menu {\r\n    min-width: 180px !important;\r\n    padding: 14px 18px !important;\r\n    top: 15px !important;\r\n    right: 15px !important;\r\n  }\r\n\r\n  .welcome-lv .hero-content {\r\n    padding-top: 150px !important;\r\n  }\r\n\r\n  .welcome-lv .hero-title {\r\n    font-size: 36px !important;\r\n  }\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .welcome-lv {\r\n    padding: 20px !important;\r\n    min-height: 600px !important;\r\n  }\r\n\r\n  .welcome-lv .hero-container {\r\n    min-height: 500px !important;\r\n  }\r\n\r\n  .welcome-lv .brand-logo {\r\n    max-width: 500px !important;\r\n    left: 10px !important;\r\n  }\r\n\r\n  .welcome-lv .brand-logo img {\r\n    max-width: 500px !important;\r\n    max-height: 250px !important;\r\n    min-width: 250px !important;\r\n  }\r\n\r\n  .welcome-lv .user-menu {\r\n    top: 10px !important;\r\n    right: 10px !important;\r\n    min-width: auto !important;\r\n    max-width: 280px !important;\r\n    padding: 12px 16px !important;\r\n  }\r\n\r\n  .welcome-lv .user-info {\r\n    align-items: flex-end !important;\r\n    text-align: right !important;\r\n  }\r\n\r\n  .welcome-lv .hero-content {\r\n    padding-top: 180px !important;\r\n  }\r\n\r\n  .welcome-lv .btn-logout {\r\n    padding: 6px 12px !important;\r\n    font-size: 12px !important;\r\n  }\r\n\r\n  .welcome-lv .hero-title {\r\n    font-size: 32px !important;\r\n  }\r\n\r\n  .welcome-lv .hero-description {\r\n    font-size: 16px !important;\r\n  }\r\n\r\n  .welcome-lv .btn-primary {\r\n    padding: 14px 40px !important;\r\n    font-size: 15px !important;\r\n  }\r\n\r\n  .welcome-lv .shortcuts-container .shopping-card {\r\n    flex: 0 0 260px !important;\r\n    height: 150px !important;\r\n  }\r\n}\r\n\r\n@media (max-width: 560px) {\r\n  .welcome-lv {\r\n    padding: 16px !important;\r\n    min-height: 500px !important;\r\n  }\r\n\r\n  .welcome-lv .hero-container {\r\n    min-height: 450px !important;\r\n  }\r\n\r\n  .welcome-lv .brand-logo {\r\n    max-width: 400px !important;\r\n  }\r\n\r\n  .welcome-lv .brand-logo img {\r\n    max-width: 400px !important;\r\n    max-height: 200px !important;\r\n  }\r\n\r\n  .welcome-lv .user-menu {\r\n    gap: 8px !important;\r\n    padding: 10px 14px !important;\r\n    max-width: 260px !important;\r\n  }\r\n\r\n  .welcome-lv .user-name {\r\n    font-size: 14px !important;\r\n  }\r\n\r\n  .welcome-lv .user-email {\r\n    font-size: 11px !important;\r\n  }\r\n\r\n  .welcome-lv .btn-logout {\r\n    padding: 6px 10px !important;\r\n    font-size: 11px !important;\r\n  }\r\n\r\n  .welcome-lv .btn-logout .logout-icon {\r\n    font-size: 14px !important;\r\n  }\r\n\r\n  .welcome-lv .hero-title {\r\n    font-size: 24px !important;\r\n  }\r\n\r\n  .welcome-lv .hero-description {\r\n    font-size: 14px !important;\r\n  }\r\n\r\n  .welcome-lv .btn-primary {\r\n    padding: 12px 28px !important;\r\n    font-size: 13px !important;\r\n  }\r\n\r\n  .welcome-lv .shortcuts-container .shopping-card {\r\n    flex: 0 0 240px !important;\r\n    height: 140px !important;\r\n    padding: 16px !important;\r\n  }\r\n\r\n  .welcome-lv .shortcuts-container .shopping-card h3 {\r\n    font-size: 18px !important;\r\n  }\r\n\r\n  .welcome-lv .shortcuts-container .shopping-card p {\r\n    font-size: 13px !important;\r\n  }\r\n\r\n  .welcome-lv .shortcuts-container {\r\n    margin-top: 20px !important;\r\n    gap: 12px !important;\r\n  }\r\n}\r\n\r\n/* Accessibility: High contrast mode support */\r\n@media (prefers-contrast: high) {\r\n  .welcome-lv .shortcuts-container .shopping-card {\r\n    border-width: 2px !important;\r\n  }\r\n\r\n  .welcome-lv .btn-primary {\r\n    border: 2px solid var(--welcome-ink) !important;\r\n  }\r\n\r\n  .welcome-lv .btn-logout {\r\n    border-width: 2px !important;\r\n  }\r\n}\r\n\r\n/* Accessibility: Reduced motion support */\r\n@media (prefers-reduced-motion: reduce) {\r\n  .welcome-lv .btn-primary,\r\n  .welcome-lv .btn-logout,\r\n  .welcome-lv .shortcuts-container .shopping-card,\r\n  .welcome-lv .shortcuts-container .shopping-card .card-bg {\r\n    transition: none !important;\r\n  }\r\n\r\n  .welcome-lv .btn-primary:hover,\r\n  .welcome-lv .btn-logout:hover,\r\n  .welcome-lv .shortcuts-container .shopping-card:hover {\r\n    transform: none !important;\r\n  }\r\n}\r\n",
      "controllerScript": "/* global self, ctx, localStorage, document, window, IntersectionObserver */\r\n\r\n/**\r\n * RFC-0057: Welcome LV Widget - BUILD CHECK ACTION IS WORKING WELL 2025-12-11 14:59\r\n *\r\n * Purpose: Home dashboard hero with brand palette, user menu, and shopping shortcuts\r\n *\r\n * Customer Attributes (SERVER_SCOPE):\r\n * {\r\n *   \"home.brand.logoUrl\": \"https://...\",\r\n *   \"home.brand.palette\": {\r\n *     \"primary\": \"#7A2FF7\",\r\n *     \"secondary\": \"#5A1FD1\",\r\n *     \"gradientStart\": \"rgba(10,18,44,0.55)\",\r\n *     \"gradientEnd\": \"rgba(10,18,44,0.15)\",\r\n *     \"ink\": \"#F5F7FA\",\r\n *     \"muted\": \"#B8C2D8\"\r\n *   },\r\n *   \"home.actions.primaryState\": \"main\",\r\n *   \"home.showUserMenu\": true\r\n * }\r\n *\r\n * Shopping Cards Source:\r\n * Cards are automatically generated from ctx.data[] which contains shopping entities\r\n * Each shopping entity in ctx.data[] should have:\r\n * - dataKey.label: Shopping name (e.g., \"Mestre Ãlvaro\")\r\n * - dataKey.entityId: Dashboard ID to navigate to\r\n * - Additional metadata from entity attributes\r\n */\r\n\r\n// Debug configuration (can be overridden by widget settings)\r\nlet DEBUG_ACTIVE = false;\r\n\r\n// RFC-0086: Shopping label storage key\r\nconst MYIO_SHOPPING_LABEL_KEY = '__MYIO_SHOPPING_LABEL__';\r\n\r\nconst LogHelper = {\r\n  log: function (...args) {\r\n    if (DEBUG_ACTIVE) {\r\n      console.log('[WelcomeLV]', ...args);\r\n    }\r\n  },\r\n  warn: function (...args) {\r\n    if (DEBUG_ACTIVE) {\r\n      console.warn('[WelcomeLV]', ...args);\r\n    }\r\n  },\r\n  error: function (...args) {\r\n    // Always log errors regardless of debug mode\r\n    console.error('[WelcomeLV]', ...args);\r\n  },\r\n};\r\n\r\n// Default MYIO palette\r\nconst DEFAULT_PALETTE = {\r\n  primary: '#7A2FF7',\r\n  secondary: '#5A1FD1',\r\n  gradientStart: 'rgba(10,18,44,0.55)',\r\n  gradientEnd: 'rgba(10,18,44,0.15)',\r\n  ink: '#F5F7FA',\r\n  muted: '#B8C2D8',\r\n};\r\n\r\nconst DEFAULT_LOGO_URL = 'https://dashboard.myio-bas.com/api/images/public/1Tl6OQO9NWvexQw18Kkb2VBkN04b8tYG';\r\n\r\n// Hardcoded shopping cards with dashboard navigation\r\nconst DEFAULT_SHOPPING_CARDS = [\r\n  {\r\n    title: 'Mestre Ãlvaro',\r\n    subtitle: 'Dashboard Principal',\r\n    buttonId: 'ShoppingMestreAlvaro',\r\n    dashboardId: '6c188a90-b0cc-11f0-9722-210aa9448abc',\r\n    entityId: '6c188a90-b0cc-11f0-9722-210aa9448abc',\r\n    entityType: 'ASSET',\r\n  },\r\n  {\r\n    title: 'Mont Serrat',\r\n    subtitle: 'Dashboard Principal',\r\n    buttonId: 'ShoppingMontSerrat',\r\n    dashboardId: '39e4ca30-b503-11f0-be7f-e760d1498268',\r\n    entityId: '39e4ca30-b503-11f0-be7f-e760d1498268',\r\n    entityType: 'ASSET',\r\n  },\r\n  {\r\n    title: 'Moxuara',\r\n    subtitle: 'Dashboard Principal',\r\n    buttonId: 'ShoppingMoxuara',\r\n    dashboardId: '4b53bbb0-b5a7-11f0-be7f-e760d1498268',\r\n    entityId: '4b53bbb0-b5a7-11f0-be7f-e760d1498268',\r\n    entityType: 'ASSET',\r\n  },\r\n  {\r\n    title: 'Rio Poty',\r\n    subtitle: 'Dashboard Principal',\r\n    buttonId: 'ShoppingRioPoty',\r\n    dashboardId: 'd432db90-cee9-11f0-998e-25174baff087',\r\n    entityId: 'd432db90-cee9-11f0-998e-25174baff087',\r\n    entityType: 'ASSET',\r\n  },\r\n  {\r\n    title: 'Shopping da Ilha',\r\n    subtitle: 'Dashboard Principal',\r\n    buttonId: 'ShoppingDaIlha',\r\n    dashboardId: 'd2754480-b668-11f0-be7f-e760d1498268',\r\n    entityId: 'd2754480-b668-11f0-be7f-e760d1498268',\r\n    entityType: 'ASSET',\r\n  },\r\n  {\r\n    title: 'MetrÃ³pole Ananindeua',\r\n    subtitle: 'Dashboard Principal',\r\n    buttonId: 'ShoppingMetrÃ³poleAnanindeua',\r\n    dashboardId: 'aaa21b80-d6e9-11f0-998e-25174baff087',\r\n    entityId: 'aaa21b80-d6e9-11f0-998e-25174baff087',\r\n    entityType: 'ASSET',\r\n  },\r\n];\r\n\r\n// State\r\nlet customerAttrs = {};\r\nlet currentPalette = DEFAULT_PALETTE;\r\n\r\n/**\r\n * Fetch Customer SERVER_SCOPE attributes\r\n * rev001: Enhanced with robust Customer lookup fallback\r\n */\r\nasync function fetchCustomerAttributes() {\r\n  try {\r\n    // Try multiple sources for customerId (rev001)\r\n    let customerId = ctx.defaultSubscription?.configuredDatasources?.[0]?.entityId;\r\n\r\n    // Fallback 1: Try stateController (rev001)\r\n    if (!customerId && ctx.stateController?.dashboardCtx) {\r\n      customerId = ctx.stateController.dashboardCtx.currentCustomerId;\r\n    }\r\n\r\n    // Fallback 2: Try currentUser customer (rev001)\r\n    if (!customerId && ctx.currentUser?.customerId) {\r\n      customerId = ctx.currentUser.customerId;\r\n    }\r\n\r\n    // Force specific customer ID if default customer is detected\r\n    if (customerId === '13814000-1dd2-11b2-8080-808080808080') {\r\n      customerId = '56614a70-326f-11ef-ad2c-53aeabe7d3fa';\r\n      LogHelper.log('Forced customerId to:', customerId);\r\n    }\r\n\r\n    if (!customerId) {\r\n      LogHelper.warn('[rev001] No customer ID found via any method, using defaults');\r\n      return {};\r\n    }\r\n\r\n    const tbToken = localStorage.getItem('jwt_token');\r\n    if (!tbToken) {\r\n      LogHelper.error('JWT token not found');\r\n      return {};\r\n    }\r\n\r\n    const url = `/api/plugins/telemetry/CUSTOMER/${customerId}/values/attributes/SERVER_SCOPE`;\r\n    const response = await fetch(url, {\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Authorization': `Bearer ${tbToken}`,\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      LogHelper.warn(`Failed to fetch attributes: ${response.status}`);\r\n      return {};\r\n    }\r\n\r\n    const data = await response.json();\r\n    LogHelper.log('Customer attributes fetched:', Object.keys(data));\r\n\r\n    // Convert array to object\r\n    const attrs = {};\r\n    data.forEach((attr) => {\r\n      try {\r\n        attrs[attr.key] = JSON.parse(attr.value);\r\n      } catch (_e) {\r\n        attrs[attr.key] = attr.value;\r\n      }\r\n    });\r\n\r\n    return attrs;\r\n  } catch (error) {\r\n    LogHelper.error('Error fetching customer attributes:', error);\r\n    return {};\r\n  }\r\n}\r\n\r\n/**\r\n * Resolve brand palette from widget settings, attributes, or defaults\r\n * Priority: Widget Settings > Customer Attributes > Defaults\r\n */\r\nfunction resolvePalette(attrs) {\r\n  const settings = ctx.settings || {};\r\n\r\n  // Build palette with priority: settings > attrs > defaults\r\n  const palette = {\r\n    primary: settings.primaryColor || attrs['home.brand.palette']?.primary || DEFAULT_PALETTE.primary,\r\n    secondary: settings.secondaryColor || attrs['home.brand.palette']?.secondary || DEFAULT_PALETTE.secondary,\r\n    gradientStart: attrs['home.brand.palette']?.gradientStart || DEFAULT_PALETTE.gradientStart,\r\n    gradientEnd: attrs['home.brand.palette']?.gradientEnd || DEFAULT_PALETTE.gradientEnd,\r\n    ink: settings.textColor || attrs['home.brand.palette']?.ink || DEFAULT_PALETTE.ink,\r\n    muted: settings.mutedTextColor || attrs['home.brand.palette']?.muted || DEFAULT_PALETTE.muted,\r\n    userMenuBg: settings.userMenuBackgroundColor || 'rgba(255, 255, 255, 0.15)',\r\n    userMenuBorder: settings.userMenuBorderColor || 'rgba(255, 255, 255, 0.3)',\r\n    logoutBtnBg: settings.logoutButtonBackgroundColor || 'rgba(255, 255, 255, 0.2)',\r\n    logoutBtnBorder: settings.logoutButtonBorderColor || 'rgba(255, 255, 255, 0.4)',\r\n    shoppingCardBg: settings.shoppingCardBackgroundColor || 'rgba(255, 255, 255, 0.1)',\r\n    shoppingCardBorder: settings.shoppingCardBorderColor || 'rgba(255, 255, 255, 0.2)',\r\n  };\r\n\r\n  LogHelper.log('Palette resolved:', palette);\r\n  return palette;\r\n}\r\n\r\n/**\r\n * Validate color value (hex or rgba) (rev001)\r\n */\r\nfunction isValidColor(color) {\r\n  if (!color) return false;\r\n\r\n  // Hex validation: #RGB or #RRGGBB\r\n  const hexRegex = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/;\r\n  if (hexRegex.test(color)) return true;\r\n\r\n  // RGBA validation: rgba(r,g,b,a)\r\n  const rgbaRegex = /^rgba?\\(\\s*\\d+\\s*,\\s*\\d+\\s*,\\s*\\d+\\s*(,\\s*[\\d.]+\\s*)?\\)$/;\r\n  if (rgbaRegex.test(color)) return true;\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Apply palette to CSS variables\r\n * rev001: Added validation before injection\r\n */\r\nfunction applyPalette(palette) {\r\n  const root = document.documentElement;\r\n\r\n  // Validate and apply each color (rev001)\r\n  const colorMap = {\r\n    '--welcome-primary': palette.primary,\r\n    '--welcome-secondary': palette.secondary,\r\n    '--welcome-grad-start': palette.gradientStart,\r\n    '--welcome-grad-end': palette.gradientEnd,\r\n    '--welcome-ink': palette.ink,\r\n    '--welcome-muted': palette.muted,\r\n    '--welcome-user-menu-bg': palette.userMenuBg,\r\n    '--welcome-user-menu-border': palette.userMenuBorder,\r\n    '--welcome-logout-btn-bg': palette.logoutBtnBg,\r\n    '--welcome-logout-btn-border': palette.logoutBtnBorder,\r\n    '--welcome-shopping-card-bg': palette.shoppingCardBg,\r\n    '--welcome-shopping-card-border': palette.shoppingCardBorder,\r\n  };\r\n\r\n  Object.entries(colorMap).forEach(([cssVar, color]) => {\r\n    if (isValidColor(color)) {\r\n      root.style.setProperty(cssVar, color);\r\n    } else {\r\n      LogHelper.warn(`[rev001] Invalid color for ${cssVar}: ${color}, skipping`);\r\n    }\r\n  });\r\n\r\n  LogHelper.log('Palette applied to CSS variables');\r\n}\r\n\r\n/**\r\n * Render brand logo\r\n * Priority: Widget Settings > Customer Attributes > Default\r\n */\r\nfunction renderLogo(attrs) {\r\n  const settings = ctx.settings || {};\r\n  const logoUrl = settings.defaultLogoUrl || attrs['home.brand.logoUrl'] || DEFAULT_LOGO_URL;\r\n  const logoImg = document.getElementById('welcomeBrandLogo');\r\n\r\n  if (logoImg) {\r\n    logoImg.src = logoUrl;\r\n    logoImg.onerror = () => {\r\n      LogHelper.warn('Logo failed to load, using fallback');\r\n      logoImg.src = DEFAULT_LOGO_URL;\r\n    };\r\n    LogHelper.log('Logo set:', logoUrl, '(source: settings)', settings.defaultLogoUrl ? 'YES' : 'NO');\r\n  }\r\n}\r\n\r\n/**\r\n * Apply hero background image\r\n * Priority: Widget Settings > Customer Attributes\r\n */\r\nfunction applyHeroBackground(attrs) {\r\n  const settings = ctx.settings || {};\r\n  const backgroundUrl = settings.defaultBackgroundUrl || attrs['home.hero.backgroundUrl'];\r\n\r\n  if (!backgroundUrl) {\r\n    LogHelper.log('No hero background URL configured');\r\n    return;\r\n  }\r\n\r\n  const heroContainer = document.querySelector('.hero-container');\r\n  if (heroContainer) {\r\n    heroContainer.style.backgroundImage = `url(${backgroundUrl})`;\r\n    heroContainer.style.backgroundSize = 'cover';\r\n    heroContainer.style.backgroundPosition = 'center';\r\n    heroContainer.style.backgroundRepeat = 'no-repeat';\r\n    LogHelper.log(\r\n      'Hero background set:',\r\n      backgroundUrl,\r\n      '(source: settings)',\r\n      settings.defaultBackgroundUrl ? 'YES' : 'NO'\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Fetch user info from API (same approach as MENU widget)\r\n * Priority: Widget Settings > Customer Attributes > Default\r\n */\r\nasync function fetchAndRenderUserMenu(attrs) {\r\n  const settings = ctx.settings || {};\r\n  const showUserMenu =\r\n    settings.showUserMenuByDefault !== undefined\r\n      ? settings.showUserMenuByDefault\r\n      : attrs['home.showUserMenu'] !== false;\r\n  const userMenuEl = document.getElementById('welcomeUserMenu');\r\n\r\n  if (!userMenuEl) return;\r\n\r\n  if (!showUserMenu) {\r\n    userMenuEl.style.display = 'none';\r\n    LogHelper.log(\r\n      'User menu hidden by config (settings:',\r\n      settings.showUserMenuByDefault,\r\n      'attrs:',\r\n      attrs['home.showUserMenu'],\r\n      ')'\r\n    );\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const tbToken = localStorage.getItem('jwt_token');\r\n    const headers = { 'Content-Type': 'application/json' };\r\n    if (tbToken) {\r\n      headers['X-Authorization'] = `Bearer ${tbToken}`;\r\n    }\r\n\r\n    const response = await fetch('/api/auth/user', {\r\n      method: 'GET',\r\n      headers: headers,\r\n      credentials: 'include',\r\n    });\r\n\r\n    if (!response.ok) {\r\n      LogHelper.warn('Failed to fetch user info from API:', response.status);\r\n      // Fallback to ctx.currentUser\r\n      renderUserMenuFallback(attrs);\r\n      return;\r\n    }\r\n\r\n    const user = await response.json();\r\n    LogHelper.log('User data from API:', user);\r\n\r\n    const userNameEl = document.getElementById('welcomeUserName');\r\n    const userEmailEl = document.getElementById('welcomeUserEmail');\r\n\r\n    // Update user name\r\n    if (userNameEl) {\r\n      const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.name || 'UsuÃ¡rio';\r\n      userNameEl.textContent = fullName;\r\n      LogHelper.log('User name set:', fullName);\r\n    }\r\n\r\n    // Update user email\r\n    if (userEmailEl && user?.email) {\r\n      userEmailEl.textContent = user.email;\r\n      userEmailEl.style.display = 'block';\r\n      userEmailEl.style.visibility = 'visible';\r\n      LogHelper.log('User email set:', user.email);\r\n    } else {\r\n      LogHelper.warn('No email found in user object');\r\n    }\r\n\r\n    // Wire logout button\r\n    const logoutBtn = document.getElementById('welcomeLogout');\r\n    if (logoutBtn) {\r\n      logoutBtn.addEventListener('click', handleLogout);\r\n    }\r\n\r\n    LogHelper.log('User menu rendered with API data');\r\n  } catch (error) {\r\n    LogHelper.error('Error fetching user info:', error);\r\n    // Fallback to ctx.currentUser\r\n    renderUserMenuFallback(attrs);\r\n  }\r\n}\r\n\r\n/**\r\n * Fallback: Get user info from ctx.currentUser\r\n */\r\nfunction renderUserMenuFallback(_attrs) {\r\n  const user = ctx.currentUser;\r\n  if (!user) {\r\n    LogHelper.warn('No user found in context');\r\n    return;\r\n  }\r\n\r\n  const userNameEl = document.getElementById('welcomeUserName');\r\n  const userEmailEl = document.getElementById('welcomeUserEmail');\r\n\r\n  if (userNameEl) {\r\n    const firstName = user.firstName || '';\r\n    const lastName = user.lastName || '';\r\n    const name = `${firstName} ${lastName}`.trim() || 'User';\r\n    userNameEl.textContent = name;\r\n  }\r\n\r\n  if (userEmailEl && user.email) {\r\n    userEmailEl.textContent = user.email;\r\n    userEmailEl.style.display = 'block';\r\n    userEmailEl.style.visibility = 'visible';\r\n  }\r\n\r\n  // Wire logout button\r\n  const logoutBtn = document.getElementById('welcomeLogout');\r\n  if (logoutBtn) {\r\n    logoutBtn.addEventListener('click', handleLogout);\r\n  }\r\n\r\n  LogHelper.log('User menu rendered with fallback data');\r\n}\r\n\r\n/**\r\n * Handle logout\r\n */\r\nfunction handleLogout() {\r\n  LogHelper.log('Logout clicked');\r\n  try {\r\n    // Use ThingsBoard's built-in logout\r\n    if (ctx.logout) {\r\n      ctx.logout();\r\n    } else {\r\n      // Fallback: clear tokens and redirect\r\n      localStorage.removeItem('jwt_token');\r\n      window.location.href = '/login';\r\n    }\r\n  } catch (error) {\r\n    LogHelper.error('Logout error:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Navigate to shopping dashboard\r\n */\r\nfunction navigateToShoppingDashboard(card) {\r\n  try {\r\n    LogHelper.log('Navigating to shopping:', card.title, 'â†’', card.dashboardId);\r\n\r\n    const state = [\r\n      {\r\n        id: 'default',\r\n        params: {\r\n          entityId: {\r\n            id: card.entityId,\r\n            entityType: card.entityType,\r\n          },\r\n        },\r\n      },\r\n    ];\r\n\r\n    const stateBase64 = encodeURIComponent(btoa(JSON.stringify(state)));\r\n    const url = `/dashboards/${card.dashboardId}?state=${stateBase64}`;\r\n\r\n    if (self.ctx && self.ctx.router) {\r\n      self.ctx.router.navigateByUrl(url);\r\n      LogHelper.log('Navigation successful:', url);\r\n    } else {\r\n      LogHelper.error('ctx.router not available');\r\n    }\r\n  } catch (error) {\r\n    LogHelper.error('Navigation error:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Lazy load card background images (rev001)\r\n * Uses widget settings for lazy loading config\r\n */\r\nfunction setupLazyLoading() {\r\n  const settings = ctx.settings || {};\r\n  const enableLazyLoading = settings.enableLazyLoading !== false; // Default: true\r\n  const rootMargin = settings.lazyLoadRootMargin || '50px';\r\n\r\n  if (!enableLazyLoading) {\r\n    // Load all images immediately if lazy loading is disabled\r\n    document.querySelectorAll('.card-bg[data-bg-url]').forEach((bg) => {\r\n      const imageUrl = bg.getAttribute('data-bg-url');\r\n      if (imageUrl) {\r\n        bg.style.backgroundImage = `url(${imageUrl})`;\r\n        bg.removeAttribute('data-bg-url');\r\n      }\r\n    });\r\n    LogHelper.log('Lazy loading disabled, loaded all images immediately');\r\n    return;\r\n  }\r\n\r\n  const imageObserver = new IntersectionObserver(\r\n    (entries) => {\r\n      entries.forEach((entry) => {\r\n        if (entry.isIntersecting) {\r\n          const cardBg = entry.target;\r\n          const imageUrl = cardBg.getAttribute('data-bg-url');\r\n          if (imageUrl) {\r\n            cardBg.style.backgroundImage = `url(${imageUrl})`;\r\n            cardBg.removeAttribute('data-bg-url');\r\n            imageObserver.unobserve(cardBg);\r\n          }\r\n        }\r\n      });\r\n    },\r\n    { rootMargin: rootMargin }\r\n  );\r\n\r\n  document.querySelectorAll('.card-bg[data-bg-url]').forEach((bg) => {\r\n    imageObserver.observe(bg);\r\n  });\r\n\r\n  LogHelper.log(\r\n    '[rev001] Lazy loading observer set up for',\r\n    document.querySelectorAll('.card-bg[data-bg-url]').length,\r\n    'images (rootMargin:',\r\n    rootMargin,\r\n    ')'\r\n  );\r\n}\r\n\r\n/**\r\n * Render shopping cards\r\n * Always use DEFAULT_SHOPPING_CARDS with navigation onclick\r\n */\r\nfunction renderShortcuts(_attrs) {\r\n  // Always use default hardcoded shopping cards with specific button IDs\r\n  const cards = DEFAULT_SHOPPING_CARDS;\r\n  LogHelper.log('Using default hardcoded shopping cards with button IDs:', cards.length);\r\n\r\n  const container = document.getElementById('welcomeShortcuts');\r\n\r\n  if (!container) return;\r\n\r\n  if (cards.length === 0) {\r\n    container.style.display = 'none';\r\n    LogHelper.log('No cards available, hiding shortcuts row');\r\n    return;\r\n  }\r\n\r\n  container.innerHTML = cards\r\n    .map(\r\n      (card, index) => `\r\n    <button class=\"shopping-card\"\r\n            id=\"${card.buttonId || 'Shopping' + index}\"\r\n            type=\"button\"\r\n            data-card-index=\"${index}\"\r\n            aria-label=\"${card.title || 'Shopping'} - ${card.subtitle || ''}\">\r\n      ${card.bgImageUrl ? `<div class=\"card-bg\" data-bg-url=\"${card.bgImageUrl}\"></div>` : ''}\r\n      <h3>${card.title || 'Shopping'}</h3>\r\n      <p>${card.subtitle || ''}</p>\r\n    </button>\r\n  `\r\n    )\r\n    .join('');\r\n\r\n  // Setup lazy loading for background images\r\n  setupLazyLoading();\r\n\r\n  // Wire click handlers for navigation\r\n  cards.forEach((card, index) => {\r\n    const button = document.querySelector(`[data-card-index=\"${index}\"]`);\r\n    if (button) {\r\n      button.addEventListener('click', () => navigateToShoppingDashboard(card));\r\n\r\n      // Keyboard navigation\r\n      button.addEventListener('keydown', (e) => {\r\n        if (e.key === 'Enter' || e.key === ' ') {\r\n          e.preventDefault();\r\n          navigateToShoppingDashboard(card);\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  LogHelper.log(\r\n    'Shopping cards rendered with navigation:',\r\n    cards.map((c) => c.buttonId || c.title).join(', ')\r\n  );\r\n}\r\n\r\n/**\r\n * Handle primary CTA click\r\n * Priority: Widget Settings > Customer Attributes > Default\r\n */\r\nfunction handleCTAClick(attrs) {\r\n  const settings = ctx.settings || {};\r\n  const primaryState = settings.defaultPrimaryState || attrs['home.actions.primaryState'] || 'main';\r\n  LogHelper.log(\r\n    'CTA clicked â†’ state:',\r\n    primaryState,\r\n    '(source: settings)',\r\n    settings.defaultPrimaryState ? 'YES' : 'NO'\r\n  );\r\n\r\n  try {\r\n    ctx.stateController.openState(primaryState, {}, false);\r\n  } catch (error) {\r\n    LogHelper.error('State navigation error:', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Render hero content with text overrides (rev001)\r\n */\r\nfunction renderHeroContent(attrs) {\r\n  // Get widget settings\r\n  const settings = ctx.settings || {};\r\n\r\n  // Default texts\r\n  const defaultTitle = 'Bem-vindo ao MYIO Platform';\r\n  const defaultDescription = 'GestÃ£o inteligente de energia, Ã¡gua e recursos para shoppings centers';\r\n  const defaultPrimaryLabel = 'ACESSAR PAINEL';\r\n\r\n  // Priority: Widget Settings > Customer Attributes > Defaults\r\n  const title = settings.defaultHeroTitle || attrs['home.hero.title'] || defaultTitle;\r\n  const description = settings.defaultHeroDescription || attrs['home.hero.description'] || defaultDescription;\r\n  const primaryLabel =\r\n    settings.defaultPrimaryLabel || attrs['home.actions.primaryLabel'] || defaultPrimaryLabel;\r\n\r\n  LogHelper.log('Hero settings:', { title, description, primaryLabel });\r\n\r\n  // Update DOM\r\n  const titleEl = document.getElementById('welcomeHeroTitle');\r\n  const descEl = document.getElementById('welcomeHeroDescription');\r\n  const ctaBtn = document.getElementById('welcomeCTA');\r\n\r\n  if (titleEl) {\r\n    titleEl.textContent = title;\r\n    LogHelper.log('Hero title set to:', title);\r\n  }\r\n\r\n  if (descEl) {\r\n    descEl.textContent = description;\r\n  }\r\n\r\n  if (ctaBtn) {\r\n    ctaBtn.textContent = primaryLabel;\r\n    ctaBtn.setAttribute('aria-label', primaryLabel);\r\n  }\r\n\r\n  LogHelper.log('Hero content rendered with text overrides');\r\n}\r\n\r\n/**\r\n * Wire primary CTA button\r\n */\r\nfunction wireCTA(attrs) {\r\n  const ctaBtn = document.getElementById('welcomeCTA');\r\n  if (ctaBtn) {\r\n    ctaBtn.addEventListener('click', () => handleCTAClick(attrs));\r\n\r\n    // Keyboard navigation (rev001)\r\n    ctaBtn.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter' || e.key === ' ') {\r\n        e.preventDefault();\r\n        handleCTAClick(attrs);\r\n      }\r\n    });\r\n\r\n    LogHelper.log('CTA button wired');\r\n  }\r\n}\r\n\r\n/**\r\n * RFC-0086: Get current dashboard title from ThingsBoard context\r\n */\r\nfunction getCurrentDashboardTitle() {\r\n  try {\r\n    // Try multiple sources for dashboard title\r\n    const title =\r\n      ctx.stateController?.dashboardCtx?.name ||\r\n      ctx.stateController?.dashboardCtx?.dashboard?.title ||\r\n      ctx.dashboard?.title ||\r\n      null;\r\n    return title;\r\n  } catch (error) {\r\n    LogHelper.warn('Error getting dashboard title:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * RFC-0086: Set shopping label in window global (for other widgets)\r\n */\r\nfunction setShoppingButtonLabel(label) {\r\n  window[MYIO_SHOPPING_LABEL_KEY] = label;\r\n  LogHelper.log('RFC-0086: Shopping label set to:', label);\r\n}\r\n\r\n/**\r\n * RFC-0086: Update and persist shopping label from current dashboard\r\n */\r\nfunction updateShoppingLabelFromDashboard() {\r\n  const title = getCurrentDashboardTitle();\r\n  if (title) {\r\n    setShoppingButtonLabel(title);\r\n    try {\r\n      localStorage.setItem(MYIO_SHOPPING_LABEL_KEY, JSON.stringify(title));\r\n    } catch {\r\n      LogHelper.error('Error saving shopping label to localStorage:', title);\r\n    }\r\n  } else {\r\n    setShoppingButtonLabel(null);\r\n  }\r\n}\r\n\r\n/**\r\n * Initialize widget\r\n * rev001: Added text overrides rendering\r\n * rev002: Added settings.schema.json support for all configurations\r\n * rev003: RFC-0086 - Share DATA_API_HOST globally\r\n * rev004: RFC-0086 - Share shopping label globally\r\n */\r\nasync function init() {\r\n  // Apply debug mode from settings\r\n  const settings = ctx.settings || {};\r\n  if (settings.enableDebugMode !== undefined) {\r\n    DEBUG_ACTIVE = settings.enableDebugMode;\r\n  }\r\n\r\n  // RFC-0086: Update and persist shopping label\r\n  updateShoppingLabelFromDashboard();\r\n\r\n  LogHelper.log('init() called');\r\n  LogHelper.log('Debug mode:', DEBUG_ACTIVE, '(from settings)');\r\n  LogHelper.log('Widget settings:', ctx.settings);\r\n\r\n  try {\r\n    // Fetch customer attributes\r\n    customerAttrs = await fetchCustomerAttributes();\r\n\r\n    // Resolve and apply palette (Widget Settings > Customer Attrs > Defaults)\r\n    currentPalette = resolvePalette(customerAttrs);\r\n    applyPalette(currentPalette);\r\n\r\n    // Render components\r\n    applyHeroBackground(customerAttrs); // Apply hero background image\r\n    renderLogo(customerAttrs);\r\n    renderHeroContent(customerAttrs); // rev001: Text overrides\r\n    await fetchAndRenderUserMenu(customerAttrs); // Fetch user from API\r\n    renderShortcuts(customerAttrs);\r\n    wireCTA(customerAttrs);\r\n\r\n    LogHelper.log('âœ… Initialization complete');\r\n  } catch (error) {\r\n    LogHelper.error('Initialization error:', error);\r\n  }\r\n}\r\n\r\n// Widget lifecycle hooks\r\nself.onInit = function () {\r\n  LogHelper.log('onInit() called');\r\n  init();\r\n};\r\n\r\nself.onDataUpdated = function () {\r\n  // Widget doesn't depend on data updates\r\n  LogHelper.log('onDataUpdated() called (no-op)');\r\n};\r\n\r\nself.onDestroy = function () {\r\n  LogHelper.log('onDestroy() called');\r\n};\r\n",
      "settingsSchema": "{\r\n  \"schema\": {\r\n    \"type\": \"object\",\r\n    \"title\": \"Welcome LV Widget Settings\",\r\n    \"description\": \"RFC-0057: Configuration for brand palette, user menu, and shopping shortcuts\",\r\n    \"properties\": {\r\n      \"enableDebugMode\": {\r\n        \"title\": \"Enable Debug Mode\",\r\n        \"type\": \"boolean\",\r\n        \"default\": true,\r\n        \"description\": \"Enable console logging for debugging\"\r\n      },\r\n      \"defaultBackgroundUrl\": {\r\n        \"title\": \"Default Background URL\",\r\n        \"type\": \"string\",\r\n        \"default\": \"https://dashboard.myio-bas.com/api/images/public/wntqPf1KcpLX2l182DY86Y4p8pa3bj6F\",\r\n        \"description\": \"Default background image URL for hero section\"\r\n      },\r\n      \"defaultLogoUrl\": {\r\n        \"title\": \"Default Logo URL\",\r\n        \"type\": \"string\",\r\n        \"default\": \"https://dashboard.myio-bas.com/api/images/public/1Tl6OQO9NWvexQw18Kkb2VBkN04b8tYG\",\r\n        \"description\": \"Default MYIO logo URL\"\r\n      },\r\n      \"primaryColor\": {\r\n        \"title\": \"Primary Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"#7A2FF7\"\r\n      },\r\n      \"secondaryColor\": {\r\n        \"title\": \"Secondary Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"#5A1FD1\"\r\n      },\r\n      \"textColor\": {\r\n        \"title\": \"Main Text Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"#F5F7FA\"\r\n      },\r\n      \"mutedTextColor\": {\r\n        \"title\": \"Muted Text Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"#B8C2D8\"\r\n      },\r\n      \"userMenuBackgroundColor\": {\r\n        \"title\": \"User Menu - Background Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"rgba(255, 255, 255, 0.15)\"\r\n      },\r\n      \"userMenuBorderColor\": {\r\n        \"title\": \"User Menu - Border Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"rgba(255, 255, 255, 0.3)\"\r\n      },\r\n      \"logoutButtonBackgroundColor\": {\r\n        \"title\": \"Logout Button - Background Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"rgba(255, 255, 255, 0.2)\"\r\n      },\r\n      \"logoutButtonBorderColor\": {\r\n        \"title\": \"Logout Button - Border Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"rgba(255, 255, 255, 0.4)\"\r\n      },\r\n      \"shoppingCardBackgroundColor\": {\r\n        \"title\": \"Shopping Card - Background Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"rgba(255, 255, 255, 0.1)\"\r\n      },\r\n      \"shoppingCardBorderColor\": {\r\n        \"title\": \"Shopping Card - Border Color\",\r\n        \"type\": \"string\",\r\n        \"default\": \"rgba(255, 255, 255, 0.2)\"\r\n      },\r\n      \"defaultHeroTitle\": {\r\n        \"title\": \"Default Hero Title\",\r\n        \"type\": \"string\",\r\n        \"default\": \"Bem-vindo ao MYIO Platform\",\r\n        \"description\": \"Default title for hero section (overridden by Customer attributes)\"\r\n      },\r\n      \"defaultHeroDescription\": {\r\n        \"title\": \"Default Hero Description\",\r\n        \"type\": \"string\",\r\n        \"default\": \"GestÃ£o inteligente de energia, Ã¡gua e recursos para shoppings centers\",\r\n        \"description\": \"Default description for hero section (overridden by Customer attributes)\"\r\n      },\r\n      \"defaultPrimaryLabel\": {\r\n        \"title\": \"Default CTA Button Label\",\r\n        \"type\": \"string\",\r\n        \"default\": \"ACESSAR PAINEL\",\r\n        \"description\": \"Default label for primary CTA button (overridden by Customer attributes)\"\r\n      },\r\n      \"defaultPrimaryState\": {\r\n        \"title\": \"Default Primary State\",\r\n        \"type\": \"string\",\r\n        \"default\": \"main\",\r\n        \"description\": \"Default dashboard state for primary CTA button\"\r\n      },\r\n      \"showUserMenuByDefault\": {\r\n        \"title\": \"Show User Menu by Default\",\r\n        \"type\": \"boolean\",\r\n        \"default\": true,\r\n        \"description\": \"Show user menu by default (can be overridden by Customer attributes)\"\r\n      },\r\n      \"enableLazyLoading\": {\r\n        \"title\": \"Enable Lazy Loading\",\r\n        \"type\": \"boolean\",\r\n        \"default\": true,\r\n        \"description\": \"Enable lazy loading for shopping card background images\"\r\n      },\r\n      \"lazyLoadRootMargin\": {\r\n        \"title\": \"Lazy Load Root Margin\",\r\n        \"type\": \"string\",\r\n        \"default\": \"50px\",\r\n        \"description\": \"Root margin for IntersectionObserver (lazy loading)\"\r\n      }\r\n    },\r\n    \"required\": []\r\n  },\r\n  \"form\": [\r\n    {\r\n      \"type\": \"fieldset\",\r\n      \"title\": \"API Configuration\",\r\n      \"items\": [\"dataApiHost\"]\r\n    },\r\n    {\r\n      \"key\": \"enableDebugMode\",\r\n      \"type\": \"checkbox\"\r\n    },\r\n    {\r\n      \"type\": \"fieldset\",\r\n      \"title\": \"Background & Logo\",\r\n      \"items\": [\"defaultBackgroundUrl\", \"defaultLogoUrl\"]\r\n    },\r\n    {\r\n      \"type\": \"fieldset\",\r\n      \"title\": \"Brand Colors\",\r\n      \"items\": [\r\n        {\r\n          \"key\": \"primaryColor\",\r\n          \"type\": \"color\"\r\n        },\r\n        {\r\n          \"key\": \"secondaryColor\",\r\n          \"type\": \"color\"\r\n        },\r\n        {\r\n          \"key\": \"textColor\",\r\n          \"type\": \"color\"\r\n        },\r\n        {\r\n          \"key\": \"mutedTextColor\",\r\n          \"type\": \"color\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"type\": \"fieldset\",\r\n      \"title\": \"User Menu Colors\",\r\n      \"items\": [\r\n        {\r\n          \"key\": \"userMenuBackgroundColor\",\r\n          \"type\": \"color\"\r\n        },\r\n        {\r\n          \"key\": \"userMenuBorderColor\",\r\n          \"type\": \"color\"\r\n        },\r\n        {\r\n          \"key\": \"logoutButtonBackgroundColor\",\r\n          \"type\": \"color\"\r\n        },\r\n        {\r\n          \"key\": \"logoutButtonBorderColor\",\r\n          \"type\": \"color\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"type\": \"fieldset\",\r\n      \"title\": \"Shopping Cards Colors\",\r\n      \"items\": [\r\n        {\r\n          \"key\": \"shoppingCardBackgroundColor\",\r\n          \"type\": \"color\"\r\n        },\r\n        {\r\n          \"key\": \"shoppingCardBorderColor\",\r\n          \"type\": \"color\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"type\": \"fieldset\",\r\n      \"title\": \"Hero Text Content\",\r\n      \"items\": [\"defaultHeroTitle\", \"defaultHeroDescription\", \"defaultPrimaryLabel\"]\r\n    },\r\n    {\r\n      \"type\": \"fieldset\",\r\n      \"title\": \"Navigation & Features\",\r\n      \"items\": [\"defaultPrimaryState\", \"showUserMenuByDefault\", \"enableLazyLoading\", \"lazyLoadRootMargin\"]\r\n    }\r\n  ]\r\n}\r\n",
      "dataKeySettingsSchema": "{}\n",
      "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Widget Head Office - WELCOME - v5.2.0\",\"decimals\":null}"
    },
    "externalId": null,
    "resources": null,
    "id": {
      "entityType": "WIDGET_TYPE",
      "id": "25d02ba0-c97d-11f0-84a2-1f4ed3957b2a"
    },
    "scada": false,
    "tags": null
  },
  "relations": [],
  "attributes": {
    "SERVER_SCOPE": []
  }
}