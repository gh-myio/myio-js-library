<!--
  ThingsBoard Widget: TELEMETRY_INFO (MyIO v-5.2.0)
  RFC-0056: Grid 2 columns layout with 6 categories
  - Entrada, Climatiza√ß√£o, Elevadores, Esc. Rolantes, Lojas, √Årea Comum (residual)
-->

<section class="telemetry-info-root">
  <!-- HEADER -->
  <header class="info-header">
    <h2 class="info-title">‚ÑπÔ∏è Informa√ß√µes de Energia</h2>
    <button
      class="btn-expand"
      id="btnExpandModal"
      title="Expandir visualiza√ß√£o"
      style="display: flex !important; cursor: pointer !important; z-index: 9999 !important;"
      onclick="console.log('[TELEMETRY_INFO] Button clicked!'); if(window.TELEMETRY_INFO_openModal) { window.TELEMETRY_INFO_openModal(); } else { alert('Function not loaded yet!'); }">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/>
      </svg>
    </button>
  </header>

  <!-- GRID 2 COLUNAS -->
  <div class="info-grid">

    <!-- ========== ROW 1: ENTRADA + LOJAS ========== -->
    <div class="info-card entrada-card">
      <div class="card-header">
        <span class="card-icon">üì•</span>
        <h3 class="card-title">Entrada</h3>
      </div>
      <div class="card-body">
        <div class="stat-row main-stat">
          <span class="stat-value" id="entradaTotal">0,00 kWh</span>
        </div>
        <div class="devices-list" id="entradaDevices">
          <!-- Dispositivos de entrada (opcional) -->
        </div>
      </div>
    </div>

    <div class="info-card lojas-card">
      <div class="card-header">
        <span class="card-icon">üè™</span>
        <h3 class="card-title">Lojas</h3>
      </div>
      <div class="card-body">
        <div class="stat-row main-stat">
          <span class="stat-value" id="lojasTotal">0,00 kWh</span>
          <span class="stat-perc" id="lojasPerc">(0%)</span>
        </div>
      </div>
    </div>

    <!-- ========== ROW 2: CLIMATIZA√á√ÉO + ELEVADORES ========== -->
    <div class="info-card climatizacao-card">
      <div class="card-header">
        <span class="card-icon">‚ùÑÔ∏è</span>
        <h3 class="card-title">Climatiza√ß√£o</h3>
      </div>
      <div class="card-body">
        <div class="stat-row main-stat">
          <span class="stat-value" id="climatizacaoTotal">0,00 kWh</span>
          <span class="stat-perc" id="climatizacaoPerc">(0%)</span>
        </div>
      </div>
    </div>

    <div class="info-card elevadores-card">
      <div class="card-header">
        <span class="card-icon">üõó</span>
        <h3 class="card-title">Elevadores</h3>
      </div>
      <div class="card-body">
        <div class="stat-row main-stat">
          <span class="stat-value" id="elevadoresTotal">0,00 kWh</span>
          <span class="stat-perc" id="elevadoresPerc">(0%)</span>
        </div>
      </div>
    </div>

    <!-- ========== ROW 3: ESC. ROLANTES + OUTROS EQUIPAMENTOS ========== -->
    <div class="info-card escadas-card">
      <div class="card-header">
        <span class="card-icon">üé¢</span>
        <h3 class="card-title">Esc. Rolantes</h3>
      </div>
      <div class="card-body">
        <div class="stat-row main-stat">
          <span class="stat-value" id="escadasRolantesTotal">0,00 kWh</span>
          <span class="stat-perc" id="escadasRolantesPerc">(0%)</span>
        </div>
      </div>
    </div>

    <div class="info-card outros-card">
      <div class="card-header">
        <span class="card-icon">‚öôÔ∏è</span>
        <h3 class="card-title">Outros Equipamentos</h3>
      </div>
      <div class="card-body">
        <div class="stat-row main-stat">
          <span class="stat-value" id="outrosTotal">0,00 kWh</span>
          <span class="stat-perc" id="outrosPerc">(0%)</span>
        </div>
      </div>
    </div>

    <!-- ========== ROW 4: √ÅREA COMUM + TOTAL (SAME ROW) ========== -->
    <div class="info-card area-comum-card">
      <div class="card-header">
        <span class="card-icon">üè¢</span>
        <h3 class="card-title">
          √Årea Comum
          <span class="info-tooltip" title="Entrada - (Lojas + Climatiza√ß√£o + Elevadores + Esc. Rolantes + Outros)">‚ÑπÔ∏è</span>
        </h3>
      </div>
      <div class="card-body">
        <div class="stat-row main-stat">
          <span class="stat-value" id="areaComumTotal">0,00 kWh</span>
          <span class="stat-perc" id="areaComumPerc">(0%)</span>
        </div>
      </div>
    </div>

    <div class="info-card total-card">
      <div class="card-header">
        <span class="card-icon">üìä</span>
        <h3 class="card-title">Total Consumidores</h3>
      </div>
      <div class="card-body">
        <div class="stat-row main-stat">
          <span class="stat-value" id="consumidoresTotal">0,00 kWh</span>
          <span class="stat-perc" id="consumidoresPerc">(100%)</span>
        </div>
      </div>
    </div>

    <!-- ========== ROW 5: GR√ÅFICO (FULL WIDTH) ========== -->
    <div class="info-card chart-card">
      <div class="card-header">
        <h3 class="card-title">Distribui√ß√£o de Consumo</h3>
      </div>
      <div class="card-body">
        <div class="chart-container">
          <canvas id="consumptionPieChart"></canvas>
        </div>
        <div class="chart-legend" id="chartLegend">
          <!-- Legenda gerada dinamicamente -->
        </div>
      </div>
    </div>

  </div>

  <!-- ========== MODAL EXPANDIDA (PREMIUM CLEAN) ========== -->
  <div class="modal-overlay" id="modalExpanded" style="display: none;" onclick="if(event.target.id === 'modalExpanded') { window.TELEMETRY_INFO_closeModal && window.TELEMETRY_INFO_closeModal(); }">
    <div class="modal-container">
      <!-- Close Button (Floating) -->
      <button
        class="btn-close-floating"
        id="btnCloseModal"
        title="Fechar"
        onclick="console.log('[TELEMETRY_INFO] Close button clicked!'); window.TELEMETRY_INFO_closeModal && window.TELEMETRY_INFO_closeModal()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <!-- Modal Content: Chart Only -->
      <div class="modal-body-clean">
        <h2 class="modal-title-clean">Distribui√ß√£o de Consumo de Energia</h2>

        <!-- Inner White Container for Chart -->
        <div class="modal-chart-inner-container">
          <div class="modal-chart-wrapper">
            <canvas id="modalConsumptionPieChart"></canvas>
          </div>
        </div>

        <div class="modal-legend-clean" id="modalChartLegend">
          <!-- Legenda gerada dinamicamente -->
        </div>
      </div>
    </div>
  </div>
</section>
