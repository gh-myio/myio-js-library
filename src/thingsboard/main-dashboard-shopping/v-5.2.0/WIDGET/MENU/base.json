{
  "entityType": "WIDGET_TYPE",
  "entity": {
    "fqn": "widget_shopping_dashboard_menu_v_5_2_0",
    "name": "Widget - Shopping Dashboard - MENU - v.5.2.0",
    "deprecated": false,
    "image": null,
    "description": null,
    "descriptor": {
      "type": "latest",
      "sizeX": 7.5,
      "sizeY": 3,
      "resources": [],
      "templateHtml": "<section class=\"shops-menu-root\">\r\n  <div class=\"user-info\" id=\"user-info\">\r\n    <div class=\"user-name\" id=\"user-name\">Carregando...</div>\r\n    <div class=\"user-email\" id=\"user-email\"></div>\r\n  </div>\r\n\r\n  <div class=\"menu-header\">\r\n    <button class=\"hamburger-btn\">‚ò∞ Menu</button>\r\n  </div>\r\n\r\n  <nav class=\"menu-list\">\r\n    <a\r\n      href=\"#\"\r\n      *ngFor=\"let link of links; let i = index\"\r\n      id=\"link{{ i }}\"\r\n      class=\"menu-item\"\r\n      (click)=\"changeDashboardState($event, link.stateId, i)\"\r\n      [class.active]=\"link.enableLink\"\r\n      [attr.data-icon]=\"getMenuIcon(link.stateId)\"\r\n    >\r\n      <span class=\"menu-icon\">{{ getMenuIcon(link.stateId) }}</span>\r\n      <span class=\"label\">{{ link.content }}</span>\r\n    </a>\r\n  </nav>\r\n\r\n  <div class=\"menu-footer\">\r\n    <button\r\n      id=\"logout-btn\"\r\n      class=\"logout-btn\"\r\n      (click)=\"handleLogout($event)\"\r\n      title=\"Sair do sistema\"\r\n    >\r\n      <span class=\"logout-icon\">üö™</span>\r\n      <span class=\"logout-text\">Sair</span>\r\n    </button>\r\n  </div>\r\n</section>\r\n",
      "templateCss": ".shopping-modal {\r\n  position: fixed;\r\n  inset: 0;\r\n  z-index: 9999;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n  transition: opacity .2s ease;\r\n  font-family: \"Inter\", sans-serif;\r\n}\r\n\r\n.shopping-modal.show {\r\n  opacity: 1;\r\n  pointer-events: auto;\r\n}\r\n\r\n.shopping-modal-overlay {\r\n  position: absolute;\r\n  inset: 0;\r\n  background: rgba(0,0,0,0.45);\r\n  backdrop-filter: blur(3px);\r\n}\r\n\r\n.shopping-modal-window {\r\n  position: relative;\r\n  z-index: 2;\r\n  background: #fff;\r\n  width: 400px;\r\n  max-width: 90%;\r\n  border-radius: 16px;\r\n  box-shadow: 0 8px 30px rgba(0,0,0,0.2);\r\n  overflow: hidden;\r\n  transform: translateY(-10px);\r\n  transition: transform .25s ease;\r\n}\r\n\r\n.shopping-modal.show .shopping-modal-window {\r\n  transform: translateY(0);\r\n}\r\n\r\n.shopping-modal-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  background: #5B3CC4;\r\n  color: #fff;\r\n  padding: 12px 18px;\r\n}\r\n\r\n.shopping-modal-header h3 {\r\n  font-size: 1.1rem;\r\n  margin: 0;\r\n}\r\n\r\n.close-btn {\r\n  background: none;\r\n  border: none;\r\n  color: #fff;\r\n  font-size: 22px;\r\n  cursor: pointer;\r\n  transition: transform .2s;\r\n}\r\n\r\n.close-btn:hover {\r\n  transform: scale(1.1);\r\n}\r\n\r\n.shopping-modal-body {\r\n  padding: 16px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 10px;\r\n}\r\n\r\n.shopping-option {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 10px;\r\n  padding: 10px 14px;\r\n  cursor: pointer;\r\n  transition: all .2s;\r\n  background: #fafafa;\r\n}\r\n\r\n.shopping-option:hover {\r\n  background: #f3ebff;\r\n  border-color: #7b5dfb;\r\n  transform: scale(1.02);\r\n}\r\n\r\n.shopping-icon {\r\n  font-size: 26px;\r\n}\r\n\r\n.shopping-info h4 {\r\n  margin: 0;\r\n  font-size: 1rem;\r\n  color: #333;\r\n}\r\n\r\n.shopping-info p {\r\n  margin: 0;\r\n  font-size: 0.8rem;\r\n  color: #666;\r\n}\r\n/*fim do modal*/\r\n/* container do rodap√© (onde ficam os bot√µes) */\r\n.shops-menu-root .menu-footer {\r\n  display: grid;\r\n  gap: 10px;\r\n  padding: 10px 0px;\r\n}\r\n\r\n/* bot√£o base */\r\n.shopping-selector-btn {\r\n  width: 100%;\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  gap: 10px;\r\n  padding: 10px 12px;\r\n  border: 1px solid #E6E6EF;\r\n  background: #FFFFFF;\r\n  color: #2F2A3B;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 10px rgba(31, 28, 53, 0.06);\r\n  cursor: pointer;\r\n  transition: background .15s ease, border-color .15s ease, transform .06s ease, box-shadow .15s ease;\r\n  font: 500 14px/1 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\r\n}\r\n\r\n/* conte√∫do do bot√£o */\r\n.shopping-selector-btn .menu-icon-wrap {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  width: 28px; height: 28px;\r\n  border-radius: 8px;\r\n  background: #F4F1FF;\r\n  color: #5B3CC4; /* roxo do seu topo */\r\n}\r\n\r\n.shopping-selector-btn .menu-label {\r\n  flex: 1 1 auto;\r\n  text-align: left;\r\n  white-space: nowrap;\r\n}\r\n\r\n.shopping-selector-btn .menu-kicker {\r\n  font-size: 12px;\r\n  color: #7C7A8A;\r\n  background: #F7F7FB;\r\n  border: 1px solid #EDECF5;\r\n  padding: 3px 6px;\r\n  border-radius: 8px;\r\n}\r\n\r\n/* estados */\r\n.shopping-selector-btn:hover {\r\n  background: #F7F4FF;\r\n  border-color: #D8CEFF;\r\n  box-shadow: 0 4px 18px rgba(91, 60, 196, 0.12);\r\n}\r\n.shopping-selector-btn:active {\r\n  transform: translateY(1px);\r\n  box-shadow: 0 2px 10px rgba(91, 60, 196, 0.10);\r\n}\r\n.shopping-selector-btn:focus-visible {\r\n  outline: 3px solid rgba(123, 93, 251, .4);\r\n  outline-offset: 2px;\r\n}\r\n\r\n/* desabilitado (se quiser usar em algum momento) */\r\n.shopping-selector-btn[disabled] {\r\n  opacity: .55;\r\n  cursor: not-allowed;\r\n}\r\n\r\n/* quando o menu estiver recolhido (classe .collapsed j√° existe no seu c√≥digo) */\r\n.shops-menu-root.collapsed .shopping-selector-btn {\r\n  justify-content: center;\r\n  padding: 10px;\r\n}\r\n.shops-menu-root.collapsed .shopping-selector-btn .menu-label,\r\n.shops-menu-root.collapsed .shopping-selector-btn .menu-kicker {\r\n  display: none;\r\n}\r\n.shops-menu-root.collapsed .shopping-selector-btn .menu-icon-wrap {\r\n  width: 34px; height: 34px;\r\n  border-radius: 10px;\r\n}\r\n/*css do bort√£o trocar shopping fim */\r\n.shopping-modal {\r\n  position: fixed;\r\n  inset: 0;\r\n  z-index: 9999;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  opacity: 0;\r\n  pointer-events: none;\r\n  transition: opacity .2s ease;\r\n  font-family: \"Inter\", sans-serif;\r\n}\r\n\r\n.shopping-modal.show {\r\n  opacity: 1;\r\n  pointer-events: auto;\r\n}\r\n\r\n.shopping-modal-overlay {\r\n  position: absolute;\r\n  inset: 0;\r\n  background: rgba(0,0,0,0.45);\r\n  backdrop-filter: blur(3px);\r\n}\r\n\r\n.shopping-modal-window {\r\n  position: relative;\r\n  z-index: 2;\r\n  background: #fff;\r\n  width: 400px;\r\n  max-width: 90%;\r\n  border-radius: 16px;\r\n  box-shadow: 0 8px 30px rgba(0,0,0,0.2);\r\n  overflow: hidden;\r\n  transform: translateY(-10px);\r\n  transition: transform .25s ease;\r\n}\r\n\r\n.shopping-modal.show .shopping-modal-window {\r\n  transform: translateY(0);\r\n}\r\n\r\n.shopping-modal-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  background: #5B3CC4;\r\n  color: #fff;\r\n  padding: 12px 18px;\r\n}\r\n\r\n.shopping-modal-header h3 {\r\n  font-size: 1.1rem;\r\n  margin: 0;\r\n}\r\n\r\n.close-btn {\r\n  background: none;\r\n  border: none;\r\n  color: #fff;\r\n  font-size: 22px;\r\n  cursor: pointer;\r\n  transition: transform .2s;\r\n}\r\n\r\n.close-btn:hover {\r\n  transform: scale(1.1);\r\n}\r\n\r\n.shopping-modal-body {\r\n  padding: 16px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 10px;\r\n}\r\n\r\n.shopping-option {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 10px;\r\n  padding: 10px 14px;\r\n  cursor: pointer;\r\n  transition: all .2s;\r\n  background: #fafafa;\r\n}\r\n\r\n.shopping-option:hover {\r\n  background: #f3ebff;\r\n  border-color: #7b5dfb;\r\n  transform: scale(1.02);\r\n}\r\n\r\n.shopping-icon {\r\n  font-size: 26px;\r\n}\r\n\r\n.shopping-info h4 {\r\n  margin: 0;\r\n  font-size: 1rem;\r\n  color: #333;\r\n}\r\n\r\n.shopping-info p {\r\n  margin: 0;\r\n  font-size: 0.8rem;\r\n  color: #666;\r\n}\r\n\r\n\r\n.shops-menu-root{\r\n  --brand: #3E1A7D;        /* ativo */\r\n  --ghost: ghostwhite;     /* texto no ativo */\r\n  --hover-bg: #efe7ff;     /* hover (roxo claro) */\r\n  --text: #111827;         /* texto padr√£o */\r\n  --divider: #e5e7eb;      /* linha divis√≥ria */\r\n  --radius: 10px;\r\n}\r\n\r\n/* Escopo local das cores */\r\n.shops-menu-root {\r\n  --brand: #3E1A7D;                  /* cor MYIO para ativo */\r\n  --ghost: ghostwhite;               /* texto no ativo */\r\n  --hover-bg: #efe7ff;               /* hover suave */\r\n  --text: #111827;                   /* texto padr√£o */\r\n  --user-color: #2d1458;             /* cor sutil para info do usu√°rio */\r\n  --radius: 10px;\r\n\r\n  display: flex;\r\n  flex-direction: column;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding: 16px 0;\r\n  box-sizing: border-box;\r\n}\r\n\r\n/* User info section at the top */\r\n.user-info {\r\n  padding: 12px 16px 16px;\r\n  border-bottom: 1px solid var(--divider);\r\n  margin-bottom: 8px;\r\n}\r\n\r\n/* Rodap√© do menu: for√ßa 1 coluna cheia */\r\n.shops-menu-root .menu-footer {\r\n  display: grid;               /* pode ser flex, mas grid d√° menos surpresas */\r\n  grid-template-columns: 1fr;  /* garante 1 coluna ocupando 100% */\r\n  gap: 10px;\r\n  padding: 10px 0px;          /* padding sim√©trico */\r\n  box-sizing: border-box;\r\n}\r\n\r\n/* O bot√£o precisa esticar 100% da coluna e zerar margens */\r\n#shopping-selector-btn.shopping-selector-btn {\r\n  justify-self: stretch;       /* estica no grid */\r\n  align-self: center;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  margin: 0;                   /* evita ‚Äúpuxar‚Äù para a direita */\r\n}\r\n\r\n/* Conte√∫do interno permanece como antes */\r\n.shopping-selector-btn {\r\n  display: inline-flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  gap: 10px;\r\n  padding: 10px 12px;\r\n  border: 1px solid #E6E6EF;\r\n  background: #FFFFFF;\r\n  color: #2F2A3B;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 10px rgba(31, 28, 53, 0.06);\r\n  cursor: pointer;\r\n  transition: background .15s ease, border-color .15s ease, transform .06s ease, box-shadow .15s ease;\r\n  font: 500 14px/1 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\r\n}\r\n\r\n/* quando o menu estiver recolhido, continua centrado */\r\n.shops-menu-root.collapsed #shopping-selector-btn {\r\n  justify-self: center;        /* centraliza quando colapsado */\r\n  width: auto;                 /* deixa o bot√£o ‚Äúcompacto‚Äù */\r\n}\r\n\r\n\r\n.user-name {\r\n  color: var(--user-color);\r\n  font-size: 15px;\r\n  font-weight: 600;\r\n  margin-bottom: 4px;\r\n  word-wrap: break-word;\r\n}\r\n\r\n.user-email {\r\n  color: var(--user-color);\r\n  font-size: 12px;\r\n  font-weight: 400;\r\n  opacity: 0.7;\r\n  word-wrap: break-word;\r\n}\r\n\r\n.menu-header {\r\n  display: flex; align-items: center; gap: 8px;\r\n  padding-bottom: 10px; border-bottom: 1px solid #eee;\r\n}\r\n\r\n.hamburger-btn {\r\n  background: none;\r\n  border: 0;\r\n  font-size: 14px;\r\n  cursor: pointer;\r\n  transition: transform 0.3s ease;\r\n}\r\n\r\n.hamburger-btn:hover {\r\n  transform: scale(1.1);\r\n}\r\n\r\n.hamburger-btn:active {\r\n  transform: scale(0.95);\r\n}\r\n\r\n/* lista em coluna, com divisores */\r\n.menu-list{\r\n  display:flex; flex-direction:column;\r\n  padding-top:12px; gap:0; /* gap 0 pq o divisor j√° separa */\r\n  flex: 1; /* Takes remaining space, pushing footer to bottom */\r\n  overflow-y: auto; /* Allows scrolling if menu items overflow */\r\n}\r\n\r\n/* cada item ocupa 100% da largura da linha */\r\n.menu-item{\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12px;\r\n  width:100%;\r\n  padding:12px 16px;\r\n  color:var(--text);\r\n  text-decoration:none;\r\n  border-bottom:1px solid var(--divider) !important; /* padroniza divisor */\r\n  border-radius: var(--radius);\r\n  transition: background .2s ease, color .2s ease, box-shadow .2s ease;\r\n}\r\n\r\n.menu-icon {\r\n  font-size: 20px;\r\n  display: inline-block;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.menu-item {\r\n  text-decoration: none;\r\n  color: var(--text, #111827);\r\n  font-size: 16px;\r\n}\r\n\r\n/* texto/√≠cones herdam a cor do item */\r\n.menu-item .label{ display:inline-block; }\r\n\r\n/* se ainda aparecer um tra√ßo roxo legado, for√ßa remover: */\r\n.menu-item{ border-image:none !important; }\r\n\r\n/* fundo no hover pega a LINHA TODA */\r\n.menu-item:hover{\r\n  background:var(--hover-bg);\r\n}\r\n\r\n.menu-item.active .label {\r\n  background: var(--brand, #3E1A7D);\r\n  color: var(--ghost, #F8F8FF);\r\n  box-shadow: 0 2px 0 rgba(62, 26, 125, .35);\r\n}\r\n\r\n/* fundo no ativo pega a LINHA TODA */\r\n.menu-item.active {\r\n  background:var(--brand);\r\n  color:var(--ghost);\r\n  border-bottom-color: transparent; /* evita ‚Äúrisco‚Äù roxo sob o ativo */\r\n  box-shadow: 0 1px 0 rgba(62,26,125,.20) inset;\r\n}\r\n\r\n/* opcional: √≠cone + texto alinhados, caso adicione √≠cones no futuro */\r\n.menu-item .label > .icon {\r\n  margin-right: 8px;\r\n  display: inline-block;\r\n  vertical-align: -2px;\r\n}\r\n\r\n/* Logout button section */\r\n.menu-footer {\r\n  margin-top: auto;\r\n  padding: 16px 0 0;\r\n  border-top: 1px solid var(--divider);\r\n}\r\n\r\n.logout-btn {\r\n  width: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  gap: 8px;\r\n  padding: 12px 16px;\r\n  border: none;\r\n  border-radius: var(--radius);\r\n  background: transparent;\r\n  color: #dc2626; /* red-600 */\r\n  font-size: 16px;\r\n  font-weight: 500;\r\n  cursor: pointer;\r\n  transition: background 0.2s ease, color 0.2s ease;\r\n}\r\n\r\n.logout-btn:hover {\r\n  background: #fef2f2; /* red-50 */\r\n  color: #991b1b; /* red-800 */\r\n}\r\n\r\n.logout-btn:active {\r\n  background: #fee2e2; /* red-100 */\r\n}\r\n\r\n.logout-btn:disabled {\r\n  opacity: 0.5;\r\n  cursor: not-allowed;\r\n}\r\n\r\n.logout-icon {\r\n  font-size: 20px;\r\n  display: inline-block;\r\n}\r\n\r\n.logout-text {\r\n  font-weight: 500;\r\n}\r\n\r\n/* ============================================\r\n   COLLAPSED MENU STATE (menu recolhido)\r\n   ============================================ */\r\n\r\n.shops-menu-root.collapsed {\r\n  width: 20px;\r\n}\r\n\r\n/* Hide text elements when collapsed */\r\n.shops-menu-root.collapsed .user-name,\r\n.shops-menu-root.collapsed .user-email,\r\n.shops-menu-root.collapsed .menu-item .label,\r\n.shops-menu-root.collapsed .logout-text {\r\n  display: none;\r\n}\r\n\r\n/* Adjust user info when collapsed */\r\n.shops-menu-root.collapsed .user-info {\r\n  padding: 12px 8px;\r\n  text-align: center;\r\n}\r\n\r\n/* Center hamburger button when collapsed */\r\n.shops-menu-root.collapsed .menu-header {\r\n  justify-content: center;\r\n  padding-bottom: 10px;\r\n}\r\n\r\n/* Center menu items when collapsed */\r\n.shops-menu-root.collapsed .menu-item {\r\n  padding: 12px 8px;\r\n  justify-content: center;\r\n  flex-direction: column;\r\n  gap: 4px;\r\n}\r\n\r\n/* Center logout button when collapsed */\r\n.shops-menu-root.collapsed .logout-btn {\r\n  padding: 12px 8px;\r\n  justify-content: center;\r\n}\r\n\r\n.shops-menu-root.collapsed .logout-icon {\r\n  margin: 0;\r\n}\r\n\r\n/* ============================================\r\n   RFC-0055: SHOPPING SELECTOR MODAL\r\n   ============================================ */\r\n\r\n/* Shopping selector menu item */\r\n.menu-item.shopping-selector {\r\n  cursor: pointer;\r\n}\r\n\r\n.menu-item.shopping-selector:hover {\r\n  background: var(--hover-bg);\r\n}\r\n\r\n/* Modal container */\r\n.shopping-modal {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  z-index: 10000;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  opacity: 0;\r\n  transition: opacity 0.3s ease;\r\n}\r\n\r\n.shopping-modal.show {\r\n  opacity: 1;\r\n}\r\n\r\n.shopping-modal.closing {\r\n  opacity: 0;\r\n}\r\n\r\n/* Modal overlay */\r\n.shopping-modal-overlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background: rgba(0, 0, 0, 0.5);\r\n  backdrop-filter: blur(2px);\r\n}\r\n\r\n/* Modal content box */\r\n.shopping-modal-content {\r\n  position: relative;\r\n  background: white;\r\n  border-radius: 12px;\r\n  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);\r\n  max-width: 500px;\r\n  width: 90%;\r\n  max-height: 80vh;\r\n  overflow: hidden;\r\n  transform: scale(0.9);\r\n  transition: transform 0.3s ease;\r\n}\r\n\r\n.shopping-modal.show .shopping-modal-content {\r\n  transform: scale(1);\r\n}\r\n\r\n.shopping-modal.closing .shopping-modal-content {\r\n  transform: scale(0.9);\r\n}\r\n\r\n/* Modal header */\r\n.shopping-modal-header {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  padding: 20px 24px;\r\n  border-bottom: 1px solid var(--divider);\r\n  background: var(--brand);\r\n  color: var(--ghost);\r\n}\r\n\r\n.shopping-modal-header h2 {\r\n  margin: 0;\r\n  font-size: 20px;\r\n  font-weight: 600;\r\n}\r\n\r\n.shopping-modal-close {\r\n  background: none;\r\n  border: none;\r\n  color: var(--ghost);\r\n  font-size: 28px;\r\n  line-height: 1;\r\n  cursor: pointer;\r\n  padding: 0;\r\n  width: 32px;\r\n  height: 32px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border-radius: 4px;\r\n  transition: background 0.2s ease;\r\n}\r\n\r\n.shopping-modal-close:hover {\r\n  background: rgba(255, 255, 255, 0.1);\r\n}\r\n\r\n/* Modal body */\r\n.shopping-modal-body {\r\n  padding: 24px;\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 16px;\r\n}\r\n\r\n/* Shopping option cards */\r\n.shopping-option {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 16px;\r\n  padding: 20px;\r\n  border: 2px solid var(--divider);\r\n  border-radius: var(--radius);\r\n  cursor: pointer;\r\n  transition: all 0.2s ease;\r\n  background: white;\r\n}\r\n\r\n.shopping-option:hover {\r\n  border-color: var(--brand);\r\n  background: var(--hover-bg);\r\n  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\r\n  transform: translateY(-2px);\r\n}\r\n\r\n.shopping-option:active {\r\n  transform: translateY(0);\r\n  box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.shopping-icon {\r\n  font-size: 32px;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.shopping-name {\r\n  font-size: 18px;\r\n  font-weight: 600;\r\n  color: var(--text);\r\n}\r\n\r\n/* Layout do bot√£o \"Trocar Shopping\" refinado */\r\n.shopping-selector-btn {\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: column;        /* organiza em coluna */\r\n  align-items: flex-start;       /* alinha √† esquerda */\r\n  justify-content: center;\r\n  gap: 2px;\r\n  padding: 10px 12px;\r\n  border: 1px solid #E6E6EF;\r\n  background: #FFFFFF;\r\n  color: #2F2A3B;\r\n  border-radius: 12px;\r\n  box-shadow: 0 2px 10px rgba(31, 28, 53, 0.06);\r\n  cursor: pointer;\r\n  transition: all .15s ease;\r\n  font-family: \"Inter\", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\r\n}\r\n\r\n/* primeira linha (\"Trocar Shopping\") */\r\n.shopping-selector-btn .menu-label {\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n}\r\n\r\n/* segunda linha (nome do shopping) */\r\n.shopping-selector-btn .current-shopping {\r\n  font-size: 12.5px;\r\n  font-weight: 500;\r\n  color: #5B3CC4;      /* roxo principal */\r\n  opacity: 0.9;\r\n  text-transform: none;\r\n  line-height: 1.2;\r\n  margin-left: 26px;   /* alinha com o √≠cone */\r\n}\r\n\r\n/* √≠cone visualmente equilibrado √† esquerda */\r\n.shopping-selector-btn .menu-icon-wrap {\r\n  position: absolute;\r\n  left: 10px;\r\n  top: 50%;\r\n  transform: translateY(-50%);\r\n}\r\n\r\n/* mant√©m comportamento normal em modo colapsado */\r\n.shops-menu-root.collapsed .shopping-selector-btn {\r\n  flex-direction: row;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.shops-menu-root.collapsed .shopping-selector-btn .current-shopping {\r\n  display: none;\r\n}\r\n.shopping-selector-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  width: 100%;\r\n  padding: 10px 12px;\r\n  border-radius: 12px;\r\n  border: 1px solid #E6E6EF;\r\n  background: #FFFFFF;\r\n  box-shadow: 0 2px 10px rgba(31, 28, 53, 0.06);\r\n  cursor: pointer;\r\n  transition: .15s;\r\n}\r\n\r\n.menu-btn-content {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n}\r\n\r\n.menu-icon-wrap {\r\n  background: #F4F1FF;\r\n  color: #5B3CC4;\r\n  padding: 6px;\r\n  border-radius: 8px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n\r\n.menu-text {\r\n  display: flex;\r\n  flex-direction: column;\r\n  line-height: 1.2;\r\n}\r\n\r\n.menu-label {\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n}\r\n\r\n.current-shopping {\r\n  font-size: 12px;\r\n  font-weight: 500;\r\n  color: #5B3CC4;\r\n  opacity: .9;\r\n}\r\n\r\n.menu-kicker {\r\n  font-size: 12px;\r\n  color: #7C7A8A;\r\n  background: #F7F7FB;\r\n  border-radius: 6px;\r\n  padding: 3px 6px;\r\n}\r\n\r\n.shops-menu-root.collapsed .current-shopping,\r\n.shops-menu-root.collapsed .menu-kicker {\r\n  display: none;\r\n}\r\n\r\n/* container do rodap√© */\r\n.shops-menu-root .menu-footer{\r\n  display:grid;\r\n  grid-template-columns: 1fr;\r\n  gap:10px;\r\n  padding:10px 12px;\r\n  box-sizing:border-box;\r\n}\r\n\r\n/* bot√£o */\r\n#shopping-selector-btn.shopping-selector-btn{\r\n  width:100%;\r\n  margin:0;\r\n  box-sizing:border-box;\r\n  padding:12px;\r\n  border-radius:14px;\r\n  border:1px solid #E6E6EF;\r\n  background: #FFFFFF;\r\n  box-shadow: 0 2px 10px rgba(31,28,53,.06);\r\n  cursor:pointer;\r\n  transition: transform .06s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;\r\n}\r\n\r\n/* grade interna: √≠cone | texto (2 linhas) | atalho */\r\n#shopping-selector-btn .ssb-grid{\r\n  display:grid;\r\n  grid-template-columns: 36px 1fr auto;\r\n  align-items:center;\r\n  column-gap:12px;\r\n}\r\n\r\n/* √≠cone ‚Äúp√≠lula‚Äù */\r\n#shopping-selector-btn .ssb-icon{\r\n  width:36px; height:36px;\r\n  display:flex; align-items:center; justify-content:center;\r\n  border-radius:10px;\r\n  background:#F3EEFF;\r\n  color:#5B3CC4;\r\n  font-size:18px;\r\n}\r\n\r\n/* bloco de texto */\r\n#shopping-selector-btn .ssb-text{\r\n  display:flex; flex-direction:column; min-width:0; line-height:1.15;\r\n}\r\n#shopping-selector-btn .ssb-title{\r\n  font: 600 14px/1.1 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\r\n  color:#2F2A3B;\r\n}\r\n#shopping-selector-btn .ssb-sub{\r\n  margin-top:2px;\r\n  font: 500 12.5px/1.1 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\r\n  color:#5B3CC4;\r\n  opacity:.95;\r\n  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;\r\n}\r\n\r\n/* atalho (keycap) */\r\n#shopping-selector-btn .ssb-kbd{\r\n  font: 500 12px/1 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\r\n  color:#7C7A8A;\r\n  background:#F7F7FB;\r\n  border:1px solid #EDECF5;\r\n  padding:4px 6px;\r\n  border-radius:8px;\r\n  white-space:nowrap;\r\n}\r\n\r\n/* estados */\r\n#shopping-selector-btn:hover{\r\n  background:#F8F6FF;\r\n  border-color:#D8CEFF;\r\n  box-shadow:0 4px 18px rgba(91,60,196,.12);\r\n}\r\n#shopping-selector-btn:active{\r\n  transform:translateY(1px);\r\n  box-shadow:0 2px 10px rgba(91,60,196,.10);\r\n}\r\n#shopping-selector-btn:focus-visible{\r\n  outline:3px solid rgba(123,93,251,.45);\r\n  outline-offset:2px;\r\n}\r\n\r\n/* menu recolhido: vers√£o compacta */\r\n.shops-menu-root.collapsed #shopping-selector-btn .ssb-sub,\r\n.shops-menu-root.collapsed #shopping-selector-btn .ssb-kbd{\r\n  display:none;\r\n}\r\n.shops-menu-root.collapsed #shopping-selector-btn .ssb-grid{\r\n  grid-template-columns: 36px auto;\r\n  justify-content:center;\r\n}\r\n\r\n/* Permitir que o nome do shopping quebre linha sem cortar */\r\n.ssb-text {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: flex-start;\r\n  line-height: 1.2;\r\n}\r\n\r\n/* Nome do shopping completo */\r\n#ssb-current-shopping {\r\n  font-size: 0.82rem;\r\n  color: #6A5ACD;\r\n  font-weight: 500;\r\n  white-space: normal;     /* ‚Üê remove o truncamento */\r\n  overflow: visible;\r\n  text-overflow: unset;\r\n  word-break: break-word;  /* ‚Üê quebra para caber bonito */\r\n  max-width: 140px;        /* ajuste fino para evitar empurrar o teclado */\r\n}\r\n\r\n/* Mant√©m o layout do bot√£o organizado */\r\n.shopping-selector-btn .ssb-grid {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  gap: 6px;\r\n}\r\n\r\n\r\n/* RFC-0085: Temperature Settings Button */\r\n#temp-settings-btn.temp-settings-btn {\r\n  width: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  padding: 12px;\r\n  border-radius: 14px;\r\n  border: 1px solid #E6E6EF;\r\n  background: #FFFFFF;\r\n  color: #2F2A3B;\r\n  box-shadow: 0 2px 10px rgba(31, 28, 53, 0.06);\r\n  cursor: pointer;\r\n  transition: transform 0.06s ease, box-shadow 0.15s ease, border-color 0.15s ease, background 0.15s ease;\r\n  font: 500 14px/1 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\r\n  box-sizing: border-box;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n#temp-settings-btn .temp-icon {\r\n  width: 36px;\r\n  height: 36px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  border-radius: 10px;\r\n  background: #FFF3E0;\r\n  color: #E65100;\r\n  font-size: 18px;\r\n  flex-shrink: 0;\r\n}\r\n\r\n#temp-settings-btn .temp-text {\r\n  font-size: 14px;\r\n  font-weight: 500;\r\n  color: #2F2A3B;\r\n}\r\n\r\n#temp-settings-btn:hover {\r\n  background: #FFF8E1;\r\n  border-color: #FFE0B2;\r\n  box-shadow: 0 4px 18px rgba(230, 81, 0, 0.12);\r\n}\r\n\r\n#temp-settings-btn:active {\r\n  transform: translateY(1px);\r\n  box-shadow: 0 2px 10px rgba(230, 81, 0, 0.10);\r\n}\r\n\r\n#temp-settings-btn:focus-visible {\r\n  outline: 3px solid rgba(255, 152, 0, 0.45);\r\n  outline-offset: 2px;\r\n}\r\n\r\n/* Collapsed state */\r\n.shops-menu-root.collapsed #temp-settings-btn .temp-text {\r\n  display: none;\r\n}\r\n\r\n.shops-menu-root.collapsed #temp-settings-btn {\r\n  justify-content: center;\r\n  padding: 10px;\r\n}\r\n\r\n/* Responsive adjustments */\r\n@media (max-width: 640px) {\r\n  .shopping-modal-content {\r\n    width: 95%;\r\n    max-width: none;\r\n  }\r\n\r\n  .shopping-modal-body {\r\n    padding: 16px;\r\n  }\r\n\r\n  .shopping-option {\r\n    padding: 16px;\r\n  }\r\n\r\n  .shopping-icon {\r\n    font-size: 28px;\r\n  }\r\n\r\n  .shopping-name {\r\n    font-size: 16px;\r\n  }\r\n}\r\n",
      "controllerScript": "/* global self, window, document, localStorage, sessionStorage, requestAnimationFrame */\r\n\r\n// RFC-0091: Use shared LogHelper from MAIN widget via window.MyIOUtils\r\nconst LogHelper = window.MyIOUtils?.LogHelper || {\r\n  log: (...args) => console.log(...args),\r\n  warn: (...args) => console.warn(...args),\r\n  error: (...args) => console.error(...args),\r\n};\r\n\r\nself.onInit = function () {\r\n  const settings = self.ctx.settings || {};\r\n  const scope = self.ctx.$scope;\r\n\r\n  scope.links = settings.links || [];\r\n\r\n  // guarda √∫ltimo nome v√°lido para reaproveitar em edge cases\r\n  const STORAGE_KEY = 'myio:current-shopping-name';\r\n\r\n  function updateShoppingLabel() {\r\n    const name = getCurrentDashboardTitle();\r\n    setShoppingButtonLabel(name);\r\n  }\r\n\r\n  // pega o t√≠tulo do dashboard de forma resiliente (v√°rias vers√µes do TB)\r\n  function getCurrentDashboardTitle() {\r\n    // Primeiro tenta pegar do dashboard (caso um dia algu√©m ative o t√≠tulo)\r\n    const name =\r\n      self.ctx?.dashboard?.title ||\r\n      self.ctx?.dashboard?.dashboard?.title ||\r\n      self.ctx?.dashboard?.config?.title ||\r\n      self.ctx?.dashboard?.configuration?.title ||\r\n      null;\r\n\r\n    if (name) return name;\r\n\r\n    // ‚úÖ Se n√£o estiver no dashboard, pega do datasource principal\r\n    try {\r\n      const ds = self.ctx?.datasources?.[0];\r\n      if (ds?.name) return ds.name.trim();\r\n    } catch {\r\n      // Ignore datasource access errors\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  function setShoppingButtonLabel(name) {\r\n    const el = document.getElementById('ssb-current-shopping');\r\n    if (!el) return;\r\n    const has = !!(name && name.trim());\r\n    el.textContent = has ? name.trim() : '';\r\n    el.style.display = has ? 'block' : 'none';\r\n  }\r\n\r\n  // chama e persiste o nome atual\r\n  function updateShoppingLabelFromDashboard() {\r\n    const title = getCurrentDashboardTitle();\r\n    if (title) {\r\n      setShoppingButtonLabel(title);\r\n      try {\r\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(title));\r\n      } catch {\r\n        // Ignore localStorage errors (quota exceeded, private mode, etc.)\r\n      }\r\n    } else {\r\n      setShoppingButtonLabel(null);\r\n    }\r\n  }\r\n\r\n  // Function to get icon for each menu item based on stateId\r\n  scope.getMenuIcon = function (stateId) {\r\n    const icons = {\r\n      telemetry_content: '‚ö°',\r\n      water_content: 'üíß',\r\n      temperature_content: 'üå°Ô∏è',\r\n      alarm_content: 'üîî',\r\n    };\r\n    return icons[stateId] || 'üìÑ';\r\n  };\r\n\r\n  // Hamburger menu toggle\r\n  const hamburgerBtn = document.querySelector('.hamburger-btn');\r\n  const menuRoot = document.querySelector('.shops-menu-root');\r\n  let isMenuCollapsed = false;\r\n\r\n  if (hamburgerBtn && menuRoot) {\r\n    hamburgerBtn.addEventListener('click', function (e) {\r\n      e.preventDefault();\r\n      isMenuCollapsed = !isMenuCollapsed;\r\n\r\n      if (isMenuCollapsed) {\r\n        menuRoot.classList.add('collapsed');\r\n        LogHelper.log('[MENU] Menu collapsed');\r\n      } else {\r\n        menuRoot.classList.remove('collapsed');\r\n        LogHelper.log('[MENU] Menu expanded');\r\n      }\r\n\r\n      // Emit event to notify other widgets (like MAIN_VIEW)\r\n      window.dispatchEvent(\r\n        new CustomEvent('myio:menu-toggle', {\r\n          detail: { collapsed: isMenuCollapsed },\r\n        })\r\n      );\r\n    });\r\n  }\r\n\r\n  // Fetch and display user info\r\n  fetchUserInfo();\r\n\r\n  async function fetchUserInfo() {\r\n    // helper local para montar headers sem enviar \"Bearer null\"\r\n    function buildAuthHeaders() {\r\n      const token = localStorage.getItem('jwt_token');\r\n      const headers = { 'Content-Type': 'application/json' };\r\n      if (token) headers['X-Authorization'] = 'Bearer ' + token;\r\n      return headers;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch('/api/auth/user', {\r\n        method: 'GET',\r\n        headers: buildAuthHeaders(),\r\n        credentials: 'include',\r\n      });\r\n\r\n      if (!response.ok) {\r\n        LogHelper.warn('[MENU] /api/auth/user status:', response.status);\r\n        if (response.status === 401) {\r\n          // token expirado/invalidado ‚Üí for√ßa login\r\n          localStorage.removeItem('jwt_token');\r\n          sessionStorage.clear();\r\n          window.location.href = '/login';\r\n          return;\r\n        }\r\n        throw new Error(`Failed to fetch user info: ${response.status}`);\r\n      }\r\n\r\n      const user = await response.json();\r\n      console.log('user >>>>>>>>>>>>>>>>', user);\r\n\r\n      // Atualiza UI do usu√°rio imediatamente (mesmo que a busca de atributos falhe)\r\n      const userNameEl = document.getElementById('user-name');\r\n      const userEmailEl = document.getElementById('user-email');\r\n\r\n      if (userNameEl) {\r\n        const fullName = `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.name || 'Usu√°rio';\r\n        userNameEl.textContent = fullName;\r\n      }\r\n      if (userEmailEl && user?.email) {\r\n        userEmailEl.textContent = user.email;\r\n      }\r\n\r\n      // RFC-0064: Check if user is TENANT_ADMIN first (skip attributes fetch)\r\n      let isUserAdmin = false;\r\n      if (user.authority === 'TENANT_ADMIN') {\r\n        LogHelper.log('[MENU] User is TENANT_ADMIN - granting admin access without attributes check');\r\n        isUserAdmin = true;\r\n      } else {\r\n        // Busca atributos do CUSTOMER (pode dar 400/404 quando n√£o existem atributos)\r\n        try {\r\n          const attrRes = await fetch(\r\n            `/api/plugins/telemetry/CUSTOMER/${user.customerId.id}/values/attributes/SERVER_SCOPE`,\r\n            {\r\n              method: 'GET',\r\n              headers: buildAuthHeaders(),\r\n              credentials: 'include',\r\n            }\r\n          );\r\n\r\n          if (attrRes.ok) {\r\n            // pode vir vazio ou n√£o-JSON em alguns casos; defenda o parse\r\n            const userAttributes = await attrRes.json().catch(() => []);\r\n            LogHelper.log('[MENU] User attributes received:', userAttributes);\r\n\r\n            if (Array.isArray(userAttributes)) {\r\n              for (const attr of userAttributes) {\r\n                if (attr && attr.key === 'isUserAdmin') {\r\n                  isUserAdmin = !!attr.value;\r\n                  break;\r\n                }\r\n              }\r\n            }\r\n          } else if (attrRes.status === 400 || attrRes.status === 404) {\r\n            // Sem atributos ‚Üí segue fluxo normal\r\n            LogHelper.warn('[MENU] CUSTOMER attributes not found (400/404). Proceeding without admin.');\r\n          } else if (attrRes.status === 401) {\r\n            // token expirado durante a segunda chamada\r\n            localStorage.removeItem('jwt_token');\r\n            sessionStorage.clear();\r\n            window.location.href = '/login';\r\n            return;\r\n          } else {\r\n            LogHelper.warn('[MENU] Unexpected attributes status:', attrRes.status);\r\n          }\r\n        } catch (attrErr) {\r\n          // N√£o quebre a exibi√ß√£o do usu√°rio por causa dos atributos\r\n          LogHelper.warn('[MENU] Ignoring attributes error:', attrErr);\r\n        }\r\n      } // End of else block (non-TENANT_ADMIN users)\r\n\r\n      // Habilita bot√£o de troca de shopping apenas para admin\r\n      if (isUserAdmin) {\r\n        LogHelper.log('[MENU] User admin detected - enabling shopping selector and temperature settings');\r\n        addShoppingSelectorButton();\r\n        addTemperatureSettingsButton(user);\r\n        updateShoppingLabel();\r\n      }\r\n    } catch (err) {\r\n      LogHelper.error('[MENU] Error fetching user info:', err);\r\n\r\n      // Fallback UI\r\n      const userNameEl = document.getElementById('user-name');\r\n      const userEmailEl = document.getElementById('user-email');\r\n\r\n      if (userNameEl) userNameEl.textContent = 'Usu√°rio';\r\n      if (userEmailEl) userEmailEl.textContent = '';\r\n    }\r\n  }\r\n\r\n  // RFC-0042: State ID to Domain mapping\r\n  const DOMAIN_BY_STATE = {\r\n    telemetry_content: 'energy',\r\n    water_content: 'water',\r\n    temperature_content: 'temperature',\r\n    alarm_content: null, // No domain for alarms\r\n  };\r\n\r\n  scope.changeDashboardState = function (e, stateId, index) {\r\n    e.preventDefault();\r\n\r\n    // Marca o link selecionado e desmarca os outros\r\n    scope.links.forEach((link, i) => (link.enableLink = i === index));\r\n\r\n    // RFC-0042: Notify orchestrator of tab change\r\n    const domain = DOMAIN_BY_STATE[stateId];\r\n\r\n    // ALWAYS dispatch event, even for null domain (alarms, etc)\r\n    // This ensures HEADER can disable buttons for unsupported domains\r\n    //LogHelper.log(`[MENU] Tab changed to domain: ${domain || 'null (unsupported)'}`);\r\n    window.dispatchEvent(\r\n      new CustomEvent('myio:dashboard-state', {\r\n        detail: { tab: domain },\r\n      })\r\n    );\r\n\r\n    // RFC-0053: Navega√ß√£o via Estados do ThingsBoard (preferido)\r\n    try {\r\n      if (self.ctx?.dashboard && typeof self.ctx.dashboard.openDashboardState === 'function') {\r\n        LogHelper.log(`[MENU] RFC-0053: Navegando para estado TB: ${stateId}`);\r\n        self.ctx.dashboard.openDashboardState(stateId);\r\n        return; // j√° navegou via TB; n√£o usar fallback\r\n      }\r\n    } catch (err) {\r\n      LogHelper.warn('[MENU] RFC-0053: openDashboardState indispon√≠vel:', err);\r\n    }\r\n\r\n    // RFC-0053: Use content containers with show/hide logic (no iframes!)\r\n    try {\r\n      const main = document.getElementsByTagName('main')[0];\r\n      if (!main) {\r\n        LogHelper.error('[MENU] <main> element not found in DOM');\r\n        return;\r\n      }\r\n\r\n      // Find all content containers with data-content-state attribute\r\n      const allContents = main.querySelectorAll('[data-content-state]');\r\n\r\n      if (allContents.length === 0) {\r\n        LogHelper.error('[MENU] No content containers found with data-content-state attribute');\r\n        main.innerHTML = `<div style=\"padding: 20px; text-align: center; color: #666;\">\r\n          <p><strong>Error: Content containers not configured</strong></p>\r\n          <p>Expected containers with data-content-state attribute in MAIN_VIEW template.html</p>\r\n        </div>`;\r\n        return;\r\n      }\r\n\r\n      // Hide all content containers\r\n      allContents.forEach((content) => {\r\n        content.style.display = 'none';\r\n      });\r\n\r\n      // Show target container\r\n      const targetContent = main.querySelector(`[data-content-state=\"${stateId}\"]`);\r\n      if (targetContent) {\r\n        targetContent.style.display = 'block';\r\n        LogHelper.log(`[MENU] ‚úÖ RFC-0053: Showing content container for ${stateId} (no iframe!)`);\r\n      } else {\r\n        LogHelper.warn(`[MENU] Content container not found for ${stateId}`);\r\n        main.innerHTML = `<div style=\"padding: 20px; text-align: center; color: #ff6b6b;\">\r\n          <p><strong>State \"${stateId}\" not configured</strong></p>\r\n          <p>Available containers: ${Array.from(allContents)\r\n            .map((c) => c.getAttribute('data-content-state'))\r\n            .join(', ')}</p>\r\n        </div>`;\r\n      }\r\n    } catch (err) {\r\n      LogHelper.error('[MENU] RFC-0053: Failed to switch content container:', err);\r\n    }\r\n  };\r\n\r\n  // Logout handler\r\n  scope.handleLogout = async function (e) {\r\n    e.preventDefault();\r\n\r\n    //LogHelper.log(\"[MENU] Logout button clicked\");\r\n\r\n    // Confirm before logout\r\n    const confirmed = window.confirm('Tem certeza que deseja sair?');\r\n    if (!confirmed) {\r\n      LogHelper.log('[MENU] Logout cancelled by user');\r\n      return;\r\n    }\r\n\r\n    const logoutBtn = document.getElementById('logout-btn');\r\n    if (logoutBtn) {\r\n      logoutBtn.disabled = true;\r\n      logoutBtn.querySelector('.logout-text').textContent = 'Saindo...';\r\n    }\r\n\r\n    try {\r\n      //LogHelper.log(\"[MENU] Sending logout request to /api/auth/logout\");\r\n\r\n      const response = await fetch('/api/auth/logout', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'X-Authorization': 'Bearer ' + localStorage.getItem('jwt_token'),\r\n        },\r\n        credentials: 'include',\r\n      });\r\n\r\n      //LogHelper.log(\"[MENU] Logout response status:\", response.status);\r\n\r\n      if (response.ok || response.status === 200 || response.status === 401) {\r\n        // Clear local storage\r\n        LogHelper.log('[MENU] Clearing local storage and session data');\r\n        localStorage.removeItem('jwt_token');\r\n        sessionStorage.clear();\r\n\r\n        // Clear orchestrator cache if available\r\n        if (window.MyIOOrchestrator) {\r\n          try {\r\n            window.MyIOOrchestrator.invalidateCache('*');\r\n            LogHelper.log('[MENU] Orchestrator cache cleared');\r\n          } catch (err) {\r\n            LogHelper.warn('[MENU] Failed to clear orchestrator cache:', err);\r\n          }\r\n        }\r\n\r\n        LogHelper.log('[MENU] Redirecting to login page');\r\n\r\n        // Redirect to login page\r\n        window.location.href = '/login';\r\n      } else {\r\n        throw new Error(`Logout failed with status: ${response.status}`);\r\n      }\r\n    } catch (err) {\r\n      LogHelper.error('[MENU] Logout error:', err);\r\n      window.alert('Erro ao fazer logout. Voc√™ ser√° redirecionado para a tela de login.');\r\n\r\n      // Force redirect even on error\r\n      localStorage.removeItem('jwt_token');\r\n      sessionStorage.clear();\r\n      window.location.href = '/login';\r\n    } finally {\r\n      if (logoutBtn) {\r\n        logoutBtn.disabled = false;\r\n        logoutBtn.querySelector('.logout-text').textContent = 'Sair';\r\n      }\r\n    }\r\n  };\r\n\r\n  // RFC-0055: Add shopping selector button for sacavalcante.com.br users\r\n  function addShoppingSelectorButton() {\r\n    if (document.getElementById('shopping-selector-btn')) {\r\n      LogHelper.log('[MENU] Shopping selector button already exists');\r\n      return;\r\n    }\r\n\r\n    const menuFooter = document.querySelector('.shops-menu-root .menu-footer');\r\n    const logoutBtn = document.getElementById('logout-btn');\r\n    if (!menuFooter) {\r\n      LogHelper.error('[MENU] Menu footer not found - cannot add shopping selector');\r\n      return;\r\n    }\r\n\r\n    const shoppingSelectorBtn = document.createElement('button');\r\n    shoppingSelectorBtn.id = 'shopping-selector-btn';\r\n    shoppingSelectorBtn.className = 'shopping-selector-btn';\r\n    shoppingSelectorBtn.type = 'button';\r\n    shoppingSelectorBtn.setAttribute('aria-label', 'Trocar Shopping');\r\n\r\n    // detecta Mac uma vez e injeta direto no template\r\n    const isMac = /mac/i.test(navigator.userAgent);\r\n    shoppingSelectorBtn.innerHTML = `\r\n    <div class=\"ssb-grid\">\r\n      <span class=\"ssb-icon\" aria-hidden=\"true\">üè¨</span>\r\n      <div class=\"ssb-text\">\r\n        <span class=\"ssb-title\" style=\"display: none;\">Trocar Shopping</span>\r\n        <span class=\"ssb-sub\" id=\"ssb-current-shopping\"></span>\r\n      </div>\r\n      <span class=\"ssb-kbd\" aria-hidden=\"true\" style=\"display: none;\">${isMac ? '‚åòK' : 'Ctrl+K'}</span>\r\n    </div>\r\n  `;\r\n\r\n    if (logoutBtn) menuFooter.insertBefore(shoppingSelectorBtn, logoutBtn);\r\n    else menuFooter.appendChild(shoppingSelectorBtn);\r\n\r\n    // r√≥tulo inicial\r\n    updateShoppingLabelFromDashboard();\r\n\r\n    // clique\r\n    shoppingSelectorBtn.addEventListener('click', () => {\r\n      LogHelper.log('[MENU] Shopping selector clicked');\r\n      //showShoppingModal();\r\n    });\r\n\r\n    LogHelper.log('[MENU] Shopping selector button added successfully');\r\n  }\r\n\r\n  // RFC-0085: Add temperature settings button for admin users\r\n  function addTemperatureSettingsButton(user) {\r\n    if (document.getElementById('temp-settings-btn')) {\r\n      LogHelper.log('[MENU] Temperature settings button already exists');\r\n      return;\r\n    }\r\n\r\n    const menuFooter = document.querySelector('.shops-menu-root .menu-footer');\r\n    const logoutBtn = document.getElementById('logout-btn');\r\n    if (!menuFooter) {\r\n      LogHelper.error('[MENU] Menu footer not found - cannot add temperature settings');\r\n      return;\r\n    }\r\n\r\n    const tempSettingsBtn = document.createElement('button');\r\n    tempSettingsBtn.id = 'temp-settings-btn';\r\n    tempSettingsBtn.className = 'temp-settings-btn';\r\n    tempSettingsBtn.type = 'button';\r\n    tempSettingsBtn.setAttribute('aria-label', 'Configurar Temperatura');\r\n    // Styling handled by CSS in style.css (#temp-settings-btn.temp-settings-btn)\r\n\r\n    tempSettingsBtn.innerHTML = `\r\n      <span class=\"temp-icon\">üå°Ô∏è</span>\r\n      <span class=\"temp-text\">Config. Temperatura</span>\r\n    `;\r\n\r\n    // Insert before logout button\r\n    if (logoutBtn) menuFooter.insertBefore(tempSettingsBtn, logoutBtn);\r\n    else menuFooter.appendChild(tempSettingsBtn);\r\n\r\n    // Click handler\r\n    tempSettingsBtn.addEventListener('click', () => {\r\n      LogHelper.log('[MENU] Temperature settings clicked');\r\n\r\n      const MyIOLibrary = window.MyIOLibrary;\r\n      if (!MyIOLibrary?.openTemperatureSettingsModal) {\r\n        LogHelper.error('[MENU] openTemperatureSettingsModal not available');\r\n        window.alert('Componente de configura√ß√£o de temperatura n√£o dispon√≠vel.');\r\n        return;\r\n      }\r\n\r\n      const jwtToken = localStorage.getItem('jwt_token');\r\n      if (!jwtToken) {\r\n        window.alert('Token de autentica√ß√£o n√£o encontrado. Fa√ßa login novamente.');\r\n        return;\r\n      }\r\n\r\n      // RFC-0085: Get customerTB_ID from MAIN_VIEW orchestrator (single source of truth)\r\n      const customerId = window.MyIOOrchestrator?.customerTB_ID;\r\n      const customerName =\r\n        user?.customerTitle || user?.customerName || getCurrentDashboardTitle() || 'Cliente';\r\n\r\n      if (!customerId) {\r\n        LogHelper.error(\r\n          '[MENU] customerTB_ID not found in MyIOOrchestrator - ensure MAIN_VIEW is configured'\r\n        );\r\n        window.alert('ID do cliente n√£o encontrado. Verifique configura√ß√£o do dashboard.');\r\n        return;\r\n      }\r\n\r\n      LogHelper.log('[MENU] Opening temperature settings for customer:', { customerId, customerName });\r\n\r\n      MyIOLibrary.openTemperatureSettingsModal({\r\n        token: jwtToken,\r\n        customerId: customerId,\r\n        customerName: customerName,\r\n        theme: 'dark',\r\n        onSave: (settings) => {\r\n          LogHelper.log('[MENU] Temperature settings saved:', settings);\r\n          // Dispatch event to notify other widgets\r\n          window.dispatchEvent(\r\n            new CustomEvent('myio:temperature-settings-updated', {\r\n              detail: settings,\r\n            })\r\n          );\r\n        },\r\n        onClose: () => {\r\n          LogHelper.log('[MENU] Temperature settings modal closed');\r\n        },\r\n      });\r\n    });\r\n\r\n    LogHelper.log('[MENU] Temperature settings button added successfully');\r\n  }\r\n\r\n  // RFC-0055: Show modal with shopping options\r\n  function showShoppingModal() {\r\n    // tenta usar o documento de n√≠vel mais alto (dashboard inteiro)\r\n    const topWin = window.top || window;\r\n    const topDoc = (() => {\r\n      try {\r\n        return topWin.document;\r\n      } catch {\r\n        // Cross-origin access may fail, fallback to current document\r\n        return document;\r\n      }\r\n    })();\r\n\r\n    const SCOPE = topDoc; // onde vamos injetar (top-level ou fallback)\r\n    const STYLE_ID = 'myio-shopping-modal-global-styles';\r\n    const MODAL_ID = 'myio-shopping-modal';\r\n\r\n    // remove se j√° existir\r\n    const old = SCOPE.getElementById(MODAL_ID);\r\n    if (old) old.remove();\r\n\r\n    // injeta css global uma √∫nica vez\r\n    if (!SCOPE.getElementById(STYLE_ID)) {\r\n      const style = SCOPE.createElement('style');\r\n      style.id = STYLE_ID;\r\n      style.textContent = `\r\n      /* overlay global, cobre a viewport toda */\r\n      .myio-modal {\r\n        position: fixed;\r\n        inset: 0;\r\n        z-index: 999999; /* bem alto pra passar por cima de tudo */\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        opacity: 0;\r\n        pointer-events: none;\r\n        transition: opacity .2s ease;\r\n        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;\r\n      }\r\n      .myio-modal.show { opacity: 1; pointer-events: auto; }\r\n      .myio-modal__overlay {\r\n        position: absolute; inset: 0;\r\n        background: rgba(0,0,0,.55);\r\n        backdrop-filter: blur(3px);\r\n      }\r\n      .myio-modal__window {\r\n        position: relative; z-index: 2;\r\n        background: #fff;\r\n        width: min(480px, 92vw);\r\n        border-radius: 18px;\r\n        box-shadow: 0 18px 60px rgba(0,0,0,.35);\r\n        overflow: hidden;\r\n        transform: translateY(12px) scale(.98);\r\n        transition: transform .25s ease;\r\n      }\r\n      .myio-modal.show .myio-modal__window {\r\n        transform: translateY(0) scale(1);\r\n      }\r\n      .myio-modal__header {\r\n        display:flex; align-items:center; justify-content:space-between;\r\n        padding: 14px 18px;\r\n        background: #5B3CC4; color: #fff;\r\n      }\r\n      .myio-modal__header h3 { margin: 0; font-size: 1.05rem; font-weight: 600; }\r\n      .myio-modal__close {\r\n        background: transparent; border: 0; color: #fff;\r\n        font-size: 22px; line-height: 1; cursor: pointer;\r\n      }\r\n      .myio-modal__body {\r\n        padding: 14px;\r\n        display: grid; gap: 10px;\r\n      }\r\n      .myio-shop {\r\n        display:flex; align-items:center; gap: 12px;\r\n        background: #fafafa; border: 1px solid #e6e6e6;\r\n        border-radius: 12px; padding: 12px 14px; cursor:pointer;\r\n        transition: background .15s, transform .15s, border-color .15s;\r\n      }\r\n      .myio-shop:hover { background:#f2ecff; border-color:#7b5dfb; transform: translateY(-1px); }\r\n      .myio-shop__icon { font-size: 26px; }\r\n      .myio-shop__title { margin:0; font-size: 1rem; color:#222; }\r\n      .myio-shop__sub { margin:0; font-size:.8rem; color:#666; }\r\n      @media (max-width: 480px){\r\n        .myio-modal__window{ width: 94vw; }\r\n      }\r\n    `;\r\n      SCOPE.head.appendChild(style);\r\n    }\r\n\r\n    // cria o modal no topo\r\n    const modal = SCOPE.createElement('div');\r\n    modal.id = MODAL_ID;\r\n    modal.className = 'myio-modal';\r\n    modal.innerHTML = `\r\n    <div class=\"myio-modal__overlay\" role=\"presentation\"></div>\r\n    <div class=\"myio-modal__window\" role=\"dialog\" aria-modal=\"true\" aria-labelledby=\"myio-modal-title\">\r\n      <div class=\"myio-modal__header\">\r\n        <h3 id=\"myio-modal-title\">Selecione o Shopping</h3>\r\n        <button class=\"myio-modal__close\" aria-label=\"Fechar\">&times;</button>\r\n      </div>\r\n      <div class=\"myio-modal__body\">\r\n        <div class=\"myio-shop\" data-url=\"https://dashboard.myio-bas.com/dashboards/all/ed5a0dd0-a3b7-11f0-afe1-175479a33d89\">\r\n          <div class=\"myio-shop__icon\">üè¢</div>\r\n          <div>\r\n            <p class=\"myio-shop__title\">Mestre √Ålvaro</p>\r\n            <p class=\"myio-shop__sub\">Vit√≥ria - ES</p>\r\n          </div>\r\n        </div>\r\n        <div class=\"myio-shop\" data-url=\"https://dashboard.myio-bas.com/dashboards/all/1e785950-af55-11f0-9722-210aa9448abc\">\r\n          <div class=\"myio-shop__icon\">üè¨</div>\r\n          <div>\r\n            <p class=\"myio-shop__title\">Mont Serrat</p>\r\n            <p class=\"myio-shop__sub\">Serra - ES</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n    SCOPE.body.appendChild(modal);\r\n\r\n    // bloqueia scroll do dashboard enquanto o modal est√° aberto\r\n    const prevOverflow = SCOPE.body.style.overflow;\r\n    SCOPE.body.style.overflow = 'hidden';\r\n\r\n    const overlay = modal.querySelector('.myio-modal__overlay');\r\n    const btnClose = modal.querySelector('.myio-modal__close');\r\n\r\n    const close = () => {\r\n      modal.classList.remove('show');\r\n      setTimeout(() => {\r\n        modal.remove();\r\n        SCOPE.body.style.overflow = prevOverflow || '';\r\n      }, 220);\r\n    };\r\n\r\n    overlay.addEventListener('click', close);\r\n    btnClose.addEventListener('click', close);\r\n    SCOPE.addEventListener('keydown', escCloseOnce, true);\r\n    function escCloseOnce(e) {\r\n      if (e.key === 'Escape') {\r\n        e.stopPropagation();\r\n        close();\r\n        SCOPE.removeEventListener('keydown', escCloseOnce, true);\r\n      }\r\n    }\r\n\r\n    modal.querySelectorAll('.myio-shop').forEach((el) => {\r\n      el.addEventListener('click', () => {\r\n        const url = el.getAttribute('data-url');\r\n        LogHelper.log('[MENU] Trocar shopping:', url);\r\n        close();\r\n        setTimeout(() => {\r\n          topWin.location.href = url;\r\n        }, 240);\r\n      });\r\n    });\r\n\r\n    // anima\r\n    requestAnimationFrame(() => modal.classList.add('show'));\r\n  }\r\n\r\n  // RFC-0056 FIX: Emit initial dashboard-state to prevent race condition\r\n  // The first link is usually the default (energy/telemetry)\r\n  // This ensures HEADER and other widgets know the initial domain immediately\r\n  setTimeout(() => {\r\n    const firstLink = scope.links && scope.links[0];\r\n    if (firstLink && firstLink.enableLink !== false) {\r\n      const firstStateId = firstLink.stateId || 'telemetry_content';\r\n      const firstDomain = DOMAIN_BY_STATE[firstStateId] || 'energy';\r\n\r\n      LogHelper.log(`[MENU] RFC-0056 FIX: Emitting initial dashboard-state for domain: ${firstDomain}`);\r\n\r\n      window.dispatchEvent(\r\n        new CustomEvent('myio:dashboard-state', {\r\n          detail: { tab: firstDomain },\r\n        })\r\n      );\r\n    } else {\r\n      // Fallback: emit energy as default\r\n      LogHelper.log(`[MENU] RFC-0056 FIX: No first link found, emitting default domain: energy`);\r\n\r\n      window.dispatchEvent(\r\n        new CustomEvent('myio:dashboard-state', {\r\n          detail: { tab: 'energy' },\r\n        })\r\n      );\r\n    }\r\n  }, 100); //Small delay to ensure HEADER is ready to listen\r\n\r\n  // === Atalho global para abrir o modal (Ctrl+K / ‚åòK) ===\r\n  (function attachGlobalHotkey() {\r\n    const topDoc = (window.top && window.top.document) || document;\r\n    const isEditable = (el) => el && (el.isContentEditable || /^(INPUT|TEXTAREA|SELECT)$/.test(el.tagName));\r\n\r\n    function onKeyDown(e) {\r\n      // Mac = meta (‚åò), Win/Linux = ctrl\r\n\r\n      const isMac = /mac/i.test(navigator.userAgent);\r\n      const meta = isMac ? e.metaKey : e.ctrlKey;\r\n\r\n      if (!meta) return;\r\n      // aceita 'k' min/mai√∫scula\r\n      if ((e.key && e.key.toLowerCase() === 'k') || e.code === 'KeyK') {\r\n        // n√£o acione se o foco estiver digitando em um campo\r\n        if (isEditable(e.target)) return;\r\n        e.preventDefault();\r\n        // TODO: showShoppingModal() disabled for now\r\n      }\r\n    }\r\n\r\n    topDoc.addEventListener('keydown', onKeyDown, true);\r\n\r\n    // garanta limpeza quando o widget sair\r\n    const oldDestroy = self.onDestroy;\r\n    self.onDestroy = function () {\r\n      try {\r\n        topDoc.removeEventListener('keydown', onKeyDown, true);\r\n      } catch {\r\n        // Ignore cleanup errors (topDoc may no longer be accessible)\r\n      }\r\n      if (typeof oldDestroy === 'function') oldDestroy();\r\n    };\r\n  })();\r\n};\r\n",
      "settingsSchema": "{\r\n    \"schema\": {\r\n        \"type\": \"object\",\r\n        \"title\": \"Settings\",\r\n        \"properties\": {\r\n            \"linkCount\": {\r\n                \"title\": \"N√∫mero de Links\",\r\n                \"type\": \"integer\",\r\n                \"minimum\": 1,\r\n                \"default\": 1\r\n            },\r\n            \"links\": {\r\n                \"type\": \"array\",\r\n                \"title\": \"Configura√ß√£o dos Links\",\r\n                \"items\": {\r\n                    \"type\": \"object\",\r\n                    \"properties\": {\r\n                        \"content\": {\r\n                            \"title\": \"Menu String\",\r\n                            \"type\": \"string\",\r\n                            \"default\": \"Menu Entry\"\r\n                        },\r\n                        \"stateId\": {\r\n                            \"title\": \"State ID\",\r\n                            \"type\": \"string\",\r\n                            \"default\": \"\"\r\n                        },\r\n                        \"enableLink\": {\r\n                            \"title\": \"Habilitar Link\",\r\n                            \"type\": \"boolean\",\r\n                            \"default\": false\r\n                        }\r\n                    }\r\n                },\r\n                \"minItems\": 1,\r\n                \"maxItems\": 5\r\n            }\r\n        }\r\n    }\r\n}",
      "dataKeySettingsSchema": "{}\n",
      "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{},\"title\":\"Attributes card\",\"decimals\":null}"
    },
    "externalId": null,
    "resources": null,
    "id": {
      "entityType": "WIDGET_TYPE",
      "id": "7dde51f0-a3b7-11f0-afe1-175479a33d89"
    },
    "scada": false,
    "tags": null
  },
  "relations": [],
  "attributes": {
    "SERVER_SCOPE": []
  }
}