<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MYIO Card Component Demo</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css" />
    <!-- Load MYIO Library from local dist -->
    <script src="../../../../../dist/myio-js-library.umd.min.js"></script>
  </head>
  <body>
    <div id="content"></div>
    <div id="selection-summary" style="margin: 20px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
      <strong>Selection Summary:</strong> <span id="summary-text">No items selected</span>
      <button id="compare-btn" disabled style="margin-left: 10px;">Compare Selected</button>
      <button id="clear-btn" style="margin-left: 10px;">Clear Selection</button>
    </div>

    <script>
      // Access components from global MyIOLibrary
      const { 
        renderCardComponent, 
        renderCardComponentEnhanced,
        MyIOSelectionStore, 
        MyIODraggableCard, 
        MyIOChartModal 
      } = MyIOLibrary;

      // Setup selection store with analytics
      if (MyIOSelectionStore) {
        MyIOSelectionStore.setAnalytics({
          track: (event, data) => {
            console.log('Analytics:', event, data);
          }
        });

        // Listen to selection changes
        MyIOSelectionStore.on('selection:change', (data) => {
          const summaryText = document.getElementById('summary-text');
          const compareBtn = document.getElementById('compare-btn');
          
          if (data.selectedIds.length === 0) {
            summaryText.textContent = 'No items selected';
            compareBtn.disabled = true;
          } else {
            const display = MyIOSelectionStore.getMultiUnitTotalDisplay();
            summaryText.textContent = `${data.selectedIds.length} items selected - ${display}`;
            compareBtn.disabled = data.selectedIds.length < 2;
          }
        });

        // Compare button handler
        document.getElementById('compare-btn').addEventListener('click', () => {
          MyIOSelectionStore.openComparison();
        });

        // Clear button handler
        document.getElementById('clear-btn').addEventListener('click', () => {
          MyIOSelectionStore.clear();
        });
      }

      // Mock de entidades (COM deviceIdentifier ADICIONADO)
      const mockEntities = [
        {
          entityId: "dev-001",
          labelOrName: "Bomba Giovani",
          deviceIdentifier: "MOT-001", // <-- ADICIONADO
          entityType: "DEVICE",
          deviceType: "MOTOR",
          slaveId: "01",
          ingestionId: "ing-aaa",
          val: 1250,
          centralId: "21.111.222.333",
          isOn: true,
          perc: 45,
          group: "adm",
          connectionStatus: "online",
          handInfo: true,
          valType: "ENERGY",
          centralName:"Campinas",
          connectionStatusTime: 1758308462000,
          timaVal: 1758308462000
        },
        {
          entityId: "dev-003",
          labelOrName: "Relógio Externo",
          deviceIdentifier: "REL-001", // <-- ADICIONADO
          entityType: "DEVICE",
          deviceType: "RELÓGIO",
          slaveId: "03",
          ingestionId: "ing-ccc",
          val: 1560,
          centralId: "21.111.222.335",
          isOn: true,
          perc: 75,
          group: "entrada",
          connectionStatus: "offline",
          valType: "ENERGY",
          centralName:"Mestre Álvare",
          connectionStatusTime: 1758308462000,
          timaVal: 1758308462000
        },
        {
          entityId: "dev-004",
          labelOrName: "Hidr. Cardeman",
          deviceIdentifier: "HID-001", // <-- ADICIONADO
          entityType: "DEVICE",
          deviceType: "HIDROMETRO",
          slaveId: "04",
          ingestionId: "ing-ccc",
          val: 1560,
          centralId: "21.111.222.335",
          isOn: true,
          perc: 85,
          group: "ambientes",
          connectionStatus: "online",
          valType: "WATER",
          centralName:"Teta",
          connectionStatusTime: 1758308462000,
          timaVal: 1758308462000
        },
        {
          entityId: "dev-005",
          labelOrName: "Loja do Vitinho",
          deviceIdentifier: "MED-001", // <-- ADICIONADO
          entityType: "DEVICE",
          deviceType: "3F_MEDIDOR",
          slaveId: "05",
          ingestionId: "ing-ccc",
          val: 1560,
          centralId: "21.111.222.335",
          isOn: true,
          perc: 85,
          group: "lojas",
          connectionStatus: "offline",
          valType: "ENERGY",
          centralName:"Ilha Plaza",
          connectionStatusTime: 1758308462000,
          timaVal: 1758308462000

        },
        {
          entityId: "dev-005",
          labelOrName: "Entrada Poderosa",
          deviceIdentifier: "ENT-001", // <-- ADICIONADO
          entityType: "DEVICE",
          deviceType: "ENTRADa",
          slaveId: "05",
          ingestionId: "ing-ccc",
          val: 1560,
          centralId: "21.111.222.335",
          isOn: true,
          perc: 85,
          group: "entrada",
          connectionStatus: "online",
          valType: "ENERGY",
          centralName:"Meir",
          connectionStatusTime: 1758308462000,
          timaVal: 1758308462000
        },
        {
          entityId: "dev-006",
          labelOrName: "Caixa D'TETA",
          deviceIdentifier: "CXA-001", // <-- ADICIONADO
          entityType: "DEVICE",
          deviceType: "CAIXA_DAGUA",
          slaveId: "05",
          ingestionId: "ing-ccc",
          val: 1560,
          centralId: "21.111.222.335",
          isOn: true,
          perc: 85,
          group: "entrada",
          connectionStatus: "offline",
          valType: "TANK",
          centralName:"BB Campos",
          connectionStatusTime: 1758308462000,
          timaVal: 1758308462000
        },
      ];

      // Mock de handlers
      function logHandler(type) {
        return (entity) => console.log(`[${type}]`, entity);
      }

      // Renderizar os cards
      mockEntities.forEach((entity) => {
        const $card = renderCardComponent({
          entityObject: entity,
          handleActionDashboard: () => console.log("dashboard"),
          handleActionReport: () => console.log("report"),
          handleActionSettings: () => console.log("settings"),
          handleSelect: () => console.log("select"),
          handInfo: true,
          handleClickCard: () => console.log("handleClickCard"),
        });

        // Use o método .append() do jQuery
        $("#content").append($card);
      });
    </script>
  </body>
</html>
